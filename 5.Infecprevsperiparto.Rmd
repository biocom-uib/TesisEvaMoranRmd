# Comparación de infectadas anteparto y periparto


```{r}
Casos=CasosTot
Controls=ControlsTot
Sint=Sint.Tot
CasosGM=CasosGMTot
ControlsGM=ControlsGMTot
```



Clasificamos en infección *anteparto* y *periparto* comparando las variables "EG_TOTAL_PARTO" (edad gestacional en el momento del parto) y "EDAD.GEST.TOTAL" (edad gestacional en el momento del diagnóstico):  diagnósticos realizados 3 o más días antes del parto se consideran **anteparto**, los diagnósticos realizados 2 días antes del parto en adelante se consideran **periparto**. Las diferencias se calculan usando las edades gestacionales.



```{r}
Casos$Dif=round((Casos$EG_TOTAL_PARTO-Casos$EDAD.GEST.TOTAL)*7)
Casos$PreP=rep(NA,n_I)
Casos$PreP[Casos$Dif>2]=1  #Diagnóstico de covid anteparto
Casos$PreP[Casos$Dif<=2]=0

n_IAP=table(Casos$PreP)[2]
n_IPP=table(Casos$PreP)[1]

ColumnesP=c("Infectadas anteparto (N)", "Infectadas anteparto (%)","Infectadas periparto (N)", "Infectadas periparto (%)","No infectadas (N)", "No infectadas (%)")

CasosGM$Dif=round((CasosGM$EG_TOTAL_PARTO-CasosGM$EDAD.GEST.TOTAL)*7)
CasosGM$PreP=rep(NA,dim(CasosGM)[1])
CasosGM$PreP[CasosGM$Dif>2]=1  #Diagnóstico de covid anteparto
CasosGM$PreP[CasosGM$Dif<=2]=0
```



## Diferencias entre edades gestacionales en el momento del parto y edades gestacionales en el momento del diagnóstico


```{r}
data =data.frame(
  name=rep("Infectadas",length(as.numeric(Casos$Dif))),
  Diferencias=as.numeric(Casos$Dif)
  )

data %>%
  ggplot( aes(x=name, y=Diferencias, fill=name)) +
    geom_violin(width=1) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    #theme_ipsum() +
    theme(
      legend.position="none",
      plot.title = element_text(size=11)
    ) +
    xlab("")+
  ylab("Diferencias (días)")
```

```{r}
I=as.numeric(Casos$Dif)
Dades=rbind(c(min(I,na.rm=TRUE),max(I,na.rm=TRUE), round(mean(I,na.rm=TRUE),1),round(median(I,na.rm=TRUE),1),round(quantile(I,c(0.25,0.75),na.rm=TRUE),1),  round(sd(I,na.rm=TRUE),1)))

colnames(Dades)=c("Mínima","Máxima","Media","Mediana", "1er cuartil", "3er cuartil",  "Desv. típica")
rownames(Dades)=c("Diferencias (días)")

Dades %>%
  kbl() %>%
  kable_styling()


```


Hay:

* `r n_IAP` casos diagnosticadas **anteparto** (al menos 3 días antes del parto), 

* `r n_IPP` diagnosticadas **periparto** (de 2 días antes del parto en adelante)

* `r n_I-n_IAP-n_IPP` pérdidas (la edad gestacional de diagnóstico o de parto son desconocidas)

## Comparación de antecedentes según momento de infección



### Edades



```{r}
I=Casos$Edad._años_
I.AP=I[Casos$PreP==1]
I.PP=I[Casos$PreP==0]

```



```{r 1-appp,fig.cap="\\s"}
data =data.frame(
  name=c(rep("Inf. Anteparto",length(I.AP)), rep("Inf. Periparto",length(I.PP))),
  Edades=c(I.AP,I.PP)
  )

sample_size = data %>% group_by(name) %>% summarize(num=n())

data %>%
 left_join(sample_size) %>%
  mutate(myaxis = paste0(name, "\n", "n=", num)) %>%
  ggplot( aes(x=myaxis, y=Edades, fill=name)) +
    geom_violin(width=1) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    theme(
      legend.position="none",
      plot.title = element_text(size=11)
    ) +
    xlab("")+
  ylab("Edades (años)")
```





```{r}
Dades=rbind(c(min(I.AP,na.rm=TRUE),max(I.AP,na.rm=TRUE), round(mean(I.AP,na.rm=TRUE),1),round(median(I.AP,na.rm=TRUE),1),round(quantile(I.AP,c(0.25,0.75),na.rm=TRUE),1), round(sd(I.AP,na.rm=TRUE),1)),
            c(min(I.PP,na.rm=TRUE),max(I.PP,na.rm=TRUE), round(mean(I.PP,na.rm=TRUE),1),round(median(I.PP,na.rm=TRUE),1),round(quantile(I.PP,c(0.25,0.75),na.rm=TRUE),1),round(sd(I.PP,na.rm=TRUE),1)))

colnames(Dades)=c("Edad mínima","Edad máxima","Edad media", "Edad mediana", "1er cuartil", "3er cuartil", "Desv. típica")
rownames(Dades)=c("Inf. Anteparto","Inf. Periparto")

Dades %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")


```


* Ajuste de las edades de infectadas y no infectadas a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I.AP)$p.value,1)`$ y $`r 
signif(shapiro.test(I.PP)$p.value,1)`$, respectivamente

* Igualdad de edades medias: test t, p-valor `r round(t.test(I.AP,I.PP)$p.value,2)`, IC del 95% para la diferencia de medias [`r round(t.test(I.AP,I.PP)$conf.int,2)`] años

* Igualdad de desviaciones típicas: test de Fligner-Killeen, p-valor $`r round(fligner.test(list(I.AP,I.PP))$p.value,5)`$

En las tablas como la que sigue:

* Los porcentajes se han calculado en la muestra sin pérdidas
* OR: la odds ratio univariante estimada de infectarse periparto (entre las infectadas) relativa a la franja de edad
* IC: el intervalo de confianza del 95% para la OR
* p-valor ajustado: p-valores de tests de Fisher bilaterales ajustados por Bonferroni calculados para la muestra sin pérdidas


```{r}
I.cut=cut(I,breaks=c(0,30,40,100),labels=c("18-30","31-40",">40"))
TablaAntePeriOR.m(I.cut,c("18-30","31-40",">40"))
```


```{r 2-appp,fig.cap="\\s"}
df =data.frame(
  Factor=c(rep("Inf. Anteparto",length(I.AP)), rep("Inf. Periparto",length(I.PP))),
  Edades=c( I.cut[Casos$PreP==1],I.cut[Casos$PreP==0] )
)

base=ordered(rep(c("18-30","31-40",">40"), each=2),levels=c("18-30", "31-40",   ">40"))
Grupo=rep(c("Inf. Anteparto","Inf. Periparto") , length(levels(I.cut)))
valor=as.vector(prop.table(table(df), margin=1))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=base , y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  scale_fill_brewer(palette = "Accent")+
  labs(fill = "Grupo de edad")

```


```{r 3-appp,fig.cap="\\s"}
df =data.frame(
  Factor=c(rep("Inf. Anteparto",length(I.AP)), rep("Inf. Periparto",length(I.PP))),
  Edades=c( I.cut[Casos$PreP==1],I.cut[Casos$PreP==0] )
)

base=ordered(rep(c("18-30","31-40",">40"), each=2),levels=c("18-30", "31-40",   ">40"))
Grupo=rep(c("Inf. Anteparto","Inf. Periparto") , length(levels(I.cut)))
valor=as.vector(prop.table(table(df), margin=2))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=Grupo, y=valor, x=base)) + 
  geom_bar(position="dodge", stat="identity")+
xlab("Grupos de edad")+
  ylab("")
```


* Igualdad de composiciones por edades de los grupos de infectadas anteparto y periparto: test $\chi^2$, p-valor `r round(chisq.test(rbind(as.vector(table(I.cut[Casos$PreP==1])),
         as.vector(table(I.cut[Casos$PreP==0]))))$p.value,4)`. 




### Etnias

```{r}
I=Casos$Etnia
I[I=="Asia"]="Asiática"
I=factor(I)
TablaAntePeriOR.m(I,c("Árabe", "Asiática", "Blanca", "Latinoamericana","Negra"),r=6)

```

 

```{r 4-appp,fig.cap="\\s"}
df =data.frame(
  Factor=c(rep("Inf. Anteparto",length(I.AP)), rep("Inf. Periparto",length(I.PP))),
  Etnias=c(I[Casos$PreP==1],I[Casos$PreP==0] )
)
base=rep(levels(I) , each=2)
Grupo=rep(c("Inf. Anteparto","Inf. Periparto")  , length(levels(I)))
valor=as.vector(prop.table(table(df), margin=1))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=base , y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  scale_fill_brewer(palette = "Accent")+
  labs(fill = "Etnia")

```

```{r 5-appp,fig.cap="\\s"}
df =data.frame(
  Factor=c(rep("Inf. Anteparto",length(I.AP)), rep("Inf. Periparto",length(I.PP))),
  Etnias=c(I[Casos$PreP==1],I[Casos$PreP==0] )
)
base=rep(levels(I) , each=2)
Grupo=rep(c("Inf. Anteparto","Inf. Periparto") , length(levels(I)))
valor=as.vector(prop.table(table(df), margin=2))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=Grupo, y=valor, x=base)) + 
  geom_bar(position="dodge", stat="identity")+
xlab("Etnias")+
  ylab("")

```


* Igualdad de composiciones por edades de los grupos de infectadas anteparto y periparto: test $\chi^2$, p-valor `r round(chisq.test(rbind(as.vector(table(I[Casos$PreP==1])),
         as.vector(table(I[Casos$PreP==0]))))$p.value,4)`. 







### Hábito tabáquico

En las tablas como la que sigue (para antecedentes):

* Los porcentajes se calculan para la muestra sin pérdidas
* La OR es la de infección periparto (entre las infectadas) relativa al antecedente
* El IC es el IC 95% para la OR
* El p-valor es el del test de Fisher bilateral sin tener en cuenta los datos perdidos

```{r}
I=Casos$FUMADORA_CAT
TablaAntePeriOR(I,"No fumadora","Fumadora")
```




### Obesidad 


```{r}
I=Casos$Obesidad
TablaAntePeriOR(I,"No obesa","Obesa")
```



### Hipertensión pregestacional


```{r}
I=Casos$Hipertensión.pregestacional
TablaAntePeriOR(I,"No HTA","HTA")
```



### Diabetes Mellitus 

```{r}
I=Casos$DIABETES
TablaAntePeriOR(I,"No DM","DM")
```



### Enfermedades cardíacas crónicas 

```{r}
I=Casos$Enfermedad.cardiaca.crónica
TablaAntePeriOR(I,"No ECC","ECC")
```




### Enfermedades pulmonares crónicas (incluyendo asma)




```{r,warning=FALSE}
INA=Casos$Enfermedad.pulmonar.crónica.no.asma
IA=Casos$Diagnóstico.clínico.de.Asma

I=rep(NA,n_I)
for (i in 1:n_I){I[i]=max(INA[i],IA[i],na.rm=TRUE)}


TablaAntePeriOR(I,"No EPC","EPC")
```



### Paridad



```{r}
I=Casos$NULIPARA
TablaAntePeriOR(I,"Multípara","Nulípara")
```


### Gestación múltiple



```{r}
I=Casos$Gestación.Múltiple
TablaAntePeriOR(I,"Gestación única","Gestación múltiple")
```





## Comparación de desenlaces según momento de infección



### Preeclampsia 

En las tablas como la que sigue:

* RA: la proporción de desenlaces entre las infectadas anteparto menos la proporción de desenlaces entre las infectadas periparto

* RR: la proporción de desenlaces entre las infectadas anteparto dividida por la proporción de desenlaces entre las infectadas periparto

* p-valor: p-valor del test de Fisher de igualdad de proporciones de desenlaces entre las infectadas anteparto y periparto

```{r}
I=Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL
TablaAntePeri(I, "PE", "No PE")
```


```{r,eval=FALSE,include=FALSE}
NI=Controls$PREECLAMPSIA_ECLAMPSIA_TOTAL
EE=rbind(as.vector(table(I[Casos$PreP==1]))[2:1],
         as.vector(table(I[Casos$PreP==0]))[2:1],
         as.vector(table(NI))[2:1])

Síntomas=rep(c("Inf. anteparto", "Inf. periparto", "No infectadas"), each=2)
Grupo=rep(c("Preeclampsia","No preeclampsia") , 3)
valor=as.vector(t(prop.table(EE, margin=1)))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Grupo, y=valor, x=Síntomas)) + 
  geom_bar(position="dodge", stat="identity")+
  xlab("Momento de diagnóstico")+
  ylab("")+
  scale_fill_brewer(palette = "Dark2") 
```


### Preeclampsia con CG


```{r}
I.AP=Casos$Preeclampsia.grave_HELLP_ECLAMPSIA[Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL==1 & Casos$PreP==1]
I.PP=Casos$Preeclampsia.grave_HELLP_ECLAMPSIA[Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL==1 & Casos$PreP==0]

TablaAntePeri.r(I.AP, I.PP, "PE con CG", "PE sin CG")
```



### Anomalías congénitas




```{r}
I=Casos$Diagnóstico.de.malformación.ecográfica._.semana.20._
TablaAntePeri(I,"Anomalías congénitas", "No anomalías congénitas")
```



### Retraso del crecimiento intrauterino 


```{r}
I=Casos$Defecto.del.crecimiento.fetal..en.tercer.trimestre._.CIR._.

TablaAntePeri(I,"RCIU","No RCIU")
```





### Diabetes gestacional 

```{r}
I=Casos$Diabetes.gestacional
TablaAntePeri(I,"DG","No DG")
```






### Hipertensión gestacional 


```{r}
I=Casos$Hipertensión.gestacional
TablaAntePeri(I,"HG","No HG")
```








### Rotura prematura de membranas 



```{r}
I=Casos$Bolsa.rota.anteparto
TablaAntePeri(I,"RPM","No RPM")
```

### Ingreso materno en  UCI



```{r}
I=Casos$UCI
TablaAntePeri(I,"UCI","No UCI")
```




### Ingreso materno en UCI según el momento del parto o cesárea



```{r}
I.AP=Casos$UCI_ANTES.DESPUES.DEL.PARTO[Casos$UCI==1 & Casos$PreP==1]
I.PP=Casos$UCI_ANTES.DESPUES.DEL.PARTO[Casos$UCI==1 & Casos$PreP==0]
TablaAntePeri.r(I.AP, I.PP,"Antes del parto", "Después del parto", )


```




### Feto muerto anteparto 

```{r}
I1.AP=Casos$Feto.muerto.intraútero[Casos$PreP==1]
I1.AP[I1.AP=="Sí"]=1
I1.AP[I1.AP=="No"]=0
I1.PP=Casos$Feto.muerto.intraútero[Casos$PreP==0]
I1.PP[I1.PP=="Sí"]=1
I1.PP[I1.PP=="No"]=0
I2.AP=CasosGM$Feto.vivo[CasosGM$PreP==1]
I2.AP[I2.AP=="Sí"]=0
I2.AP[I2.AP=="No"]=1
I2.PP=CasosGM$Feto.vivo[CasosGM$PreP==0]
I2.PP[I2.PP=="Sí"]=0
I2.PP[I2.PP=="No"]=1
I.AP=c(I1.AP,I2.AP)
I.PP=c(I1.PP,I2.PP)

TablaAntePeri.r(I.AP, I.PP,"Ningún feto muerto anteparto","Algún feto muerto anteparto")


```



### Prematurez 



```{r}
I=Casos$PREMATURO
TablaAntePeri(I,"Prematuro","A término")
```


### Eventos trombóticos



```{r}
I=Casos$EVENTOS_TROMBO_TOTALES
TablaAntePeri(I,"Eventos trombóticos","No eventos trombóticos")
```


### Eventos hemorrágicos


```{r}
I=Casos$EVENTOS_HEMORRAGICOS_TOTAL
TablaAntePeri(I,"Eventos hemorrágicos","No eventos hemorrágicos")
```



### Hemorragias potsparto



```{r}
I=Casos$Hemorragia.postparto

I.sino=I
I.sino[I.sino!="No" & !is.na(I.sino)]="Sí"

TablaAntePeri(I.sino,"HPP","No HPP")
```


```{r}
I=ordered(I,levels=names(table(I))[c(2,3,1,4)])

TablaAntePeri.m(I,L=c("Tto. médico",
"Tto. Qx. conservador","Histerectomía",
"No HPP"))
```



* Diferencia entre infectadas ante y periparto: test $\chi^2$ de Montecarlo, p-valor `r round(chisq.test(EE[c(1,2),],simulate.p.value=TRUE,B=10000)$p.value,3)`



### Inicio del parto


```{r}
I=Casos$Inicio.de.parto
I=factor(Casos$Inicio.de.parto,levels=c("Espontáneo", "Inducido", "Cesárea"),ordered=TRUE)

TablaAntePeri.m(I,c("Espontáneo", "Inducido", "Cesárea"))
```







```{r}
I.AP=Casos$Inicio.de.parto[Casos$PreP==1]
I.PP=Casos$Inicio.de.parto[Casos$PreP==0]
NI=Controls$Inicio.de.parto
NI[NI=="Cesárea programada"]="Cesárea"

df =data.frame(
  Factor=c( rep("Inf. anteparto",length(I.AP)), rep("Inf. periparto",length(I.PP)), rep("No infectadas",length(NI))),
  Inicios=ordered(c( I.AP,I.PP,NI ),levels=c("Espontáneo","Inducido","Cesárea"))
)

base=ordered(rep(c("Espontáneo","Inducido","Cesárea"), each=3),levels=c("Espontáneo","Inducido","Cesárea"))
Grupo=rep(c("Inf. anteparto","Inf. periparto","No infectada") , 3)
valor=c(as.vector(prop.table(table(df),margin=1))                 )
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=base, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+  
  xlab("")+
  ylab("")+
    scale_fill_brewer(palette = "Set3") +
  labs(fill = "Inicio")

```






* Diferencia entre infectadas ante y periparto: test $\chi^2$, p-valor `r round(chisq.test(EE[c(1,2),])$p.value,3)`



### Tipo de parto


```{r}
I.In=Casos$Inicio.de.parto
I.In[I.In=="Cesárea"]="Cesárea programada"
I=Casos$Tipo.de.parto
I[I.In=="Cesárea programada"]="Cesárea programada"
I[I=="Cesárea"]="Cesárea urgente"

I=factor(I,levels=c("Eutocico", "Instrumental", "Cesárea programada", "Cesárea urgente"),ordered=TRUE)
TablaAntePeri.m(I,c("Eutócico", "Instrumental", "Cesárea programada", "Cesárea urgente"))
```




```{r}
I.AP.In=Casos$Inicio.de.parto[Casos$PreP==1]
I.AP.In[I.AP.In=="Cesárea"]="Cesárea programada"
I.AP=Casos$Tipo.de.parto[Casos$PreP==1]
I.AP[I.AP.In=="Cesárea programada"]="Cesárea programada"
I.AP[I.AP=="Cesárea"]="Cesárea urgente"

I.PP.In=Casos$Inicio.de.parto[Casos$PreP==0]
I.PP.In[I.PP.In=="Cesárea"]="Cesárea programada"
I.PP=Casos$Tipo.de.parto[Casos$PreP==0]
I.PP[I.PP.In=="Cesárea programada"]="Cesárea programada"
I.PP[I.PP=="Cesárea"]="Cesárea urgente"

NI.In=Controls$Inicio.de.parto
NI=Controls$Tipo.de.parto
NI[NI.In=="Cesárea programada"]="Cesárea programada"
NI[NI=="Cesárea"]="Cesárea urgente"


df =data.frame(
  Factor=c( rep("Inf. anteparto",length(I.AP)), rep("Inf. periparto",length(I.PP)), rep("No infectadas",length(NI))),
  Inicios=ordered(c( I.AP,I.PP,NI ),levels=c("Eutocico", "Instrumental", "Cesárea programada", "Cesárea urgente"))
)

base=ordered(rep(c("Eutocico", "Instrumental", "Cesárea programada", "Cesárea urgente"), each=3),levels=c("Eutocico", "Instrumental", "Cesárea programada", "Cesárea urgente"))
Grupo=rep(c("Inf. anteparto","Inf. periparto","No infectada") , 4)
valor=c(as.vector(prop.table(table(df),margin=1))                 )
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=base, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+  
  xlab("")+
  ylab("")+
    scale_fill_brewer(palette = "Set3") +
  labs(fill = "Tipo")

```



* Diferencia entre infectadas ante y periparto: test $\chi^2$, p-valor `r round(chisq.test(EE[c(1,2),])$p.value,3)`




### Test de Apgar



```{r}
I.AP=c(Casos[Casos$PreP==1,]$APGAR.5...126,CasosGM[CasosGM$PreP==1,]$APGAR.5...150)
I.PP=c(Casos[Casos$PreP==0,]$APGAR.5...126,CasosGM[CasosGM$PreP==0,]$APGAR.5...150)
I.AP=cut(I.AP,breaks=c(-1,7,20),labels=c("0-7","8-10"))
I.PP=cut(I.PP,breaks=c(-1,7,20),labels=c("0-7","8-10"))
I.AP=ordered(I.AP,levels=c("8-10","0-7"))
I.PP=ordered(I.PP,levels=c("8-10","0-7"))

TablaAntePeri.r(I.AP,I.PP, "Apgar.5≥8","Apgar.5≤7")
```



### Ingreso del neonato en  UCI



```{r}
I.AP=c(Casos[Casos$Feto.muerto.intraútero=="No" & Casos$PreP==1,]$Ingreso.en.UCIN,CasosGM[CasosGM$Feto.vivo=="Sí" & CasosGM$PreP==1,]$Ingreso.en.UCI)
I.PP=c(Casos[Casos$Feto.muerto.intraútero=="No" & Casos$PreP==0,]$Ingreso.en.UCIN,CasosGM[CasosGM$Feto.vivo=="Sí" & CasosGM$PreP==0,]$Ingreso.en.UCI)

TablaAntePeri.r(I.AP,I.PP, "No UCIN", "UCIN")
```


### Peso de neonatos


```{r}
I=c(Casos[Casos$Feto.muerto.intraútero=="No",]$Peso._gramos_...125,CasosGM[CasosGM$Feto.vivo=="Sí",]$Peso._gramos_...247)
I.AP=I[Casos$PreP==1]
I.PP=I[Casos$PreP==0]
```


```{r}
Dades=rbind(c(round(min(I.AP,na.rm=TRUE),1),round(max(I.AP,na.rm=TRUE),1), round(mean(I.AP,na.rm=TRUE),1),round(median(I.AP,na.rm=TRUE),1),round(quantile(I.AP,c(0.25,0.75),na.rm=TRUE),1), round(sd(I.AP,na.rm=TRUE),1)),
            c(round(min(I.PP,na.rm=TRUE),1),round(max(I.PP,na.rm=TRUE),1), round(mean(I.PP,na.rm=TRUE),1),round(median(I.PP,na.rm=TRUE),1),round(quantile(I.PP,c(0.25,0.75),na.rm=TRUE),1), round(sd(I.PP,na.rm=TRUE),1)))

colnames(Dades)=c("Peso mínimo","Peso máximo","Peso medio", "Peso mediano", "1er cuartil", "3er cuartil", "Desv. típica")
rownames(Dades)=c("Infectadas anteparto", "Infectadas periparto")

Dades %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")

```



```{r 426,fig.cap="\\s"}
data =data.frame(
  name=c( rep("Anteparto",length(I.AP)), rep("Periparto",length(I.PP))),
  Pesos=c( I.AP,I.PP))


data %>%
  ggplot( aes(x=name, y=Pesos, fill=name)) +
    geom_violin(width=1) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    theme(
      legend.position="none",
      plot.title=element_text(size=11)
    ) +
    xlab("")+
  ylab("Pesos (gramos)")+
  scale_fill_brewer(palette = "Dark2") 

```


```{r}
FK=fligner.test(list(I.AP, I.PP))$p.value
TT=t.test(I.AP, I.PP,var.equal=TRUE)$p.value
```



* p-valor del test t para los pesos medios de infectadas ante y periparto: p-valor `r round(TT[1],5)`


*Bajo peso*


```{r}
I.cut=cut(I,breaks=c(0,2500,10000),labels=c(1,0),right=FALSE)

I.cut=ordered(I.cut,levels=c(0,1))
TablaAntePeri(I.cut,"No bajo peso","Bajo peso")
```



## Comparación de desenlaces según momento de infección y sintomatología


**Porcentajes calculados por filas**

```{r}
I.AP=Casos$SINTOMAS_DIAGNOSTICO[Casos$PreP==1]
I.PP=Casos$SINTOMAS_DIAGNOSTICO[Casos$PreP==0]
NA_IAP=length(I.AP[is.na(I.AP)])
NA_IPP=length(I.PP[is.na(I.PP)])
EEExt=rbind(c(table(I.AP)[1],round(100*prop.table(table(I.AP)),2)[1],
              table(I.AP)[2],round(100*prop.table(table(I.AP)),2)[2],
              table(I.AP)[3],round(100*prop.table(table(I.AP)),2)[3],
              length(I.AP)),
            c(table(I.PP)[1],round(100*prop.table(table(I.PP)),2)[1],
              table(I.PP)[2],round(100*prop.table(table(I.PP)),2)[2],
              table(I.PP)[3],round(100*prop.table(table(I.PP)),2)[3],
              length(I.PP))
            )
EEE=EEExt[,c(1,3,5)]
colnames(EEE)=c("Asintomáticas", "Síntomas leves", "Neumonía")

colnames(EEExt)= c("Asintomáticas (N)", "Asintomáticas (%)","Síntomas leves (N)", "Síntomas leves (%)", "Neumonía (N)", "Neumonía (%)","Total")
rownames(EEExt)=c("Infectadas anteparto", "Infectadas periparto")
EEExt %>%
  kbl() %>%
  kable_styling()
```

**Porcentajes calculados por columnas**

```{r}
I.AP=Casos$SINTOMAS_DIAGNOSTICO[Casos$PreP==1]
I.PP=Casos$SINTOMAS_DIAGNOSTICO[Casos$PreP==0]
TT=table(Casos$PreP,Casos$SINTOMAS_DIAGNOSTICO)
p.TT=round(100*prop.table(TT,margin=2)[2:1,],1)
NA_IAP=length(I.AP[is.na(I.AP)])
NA_IPP=length(I.PP[is.na(I.PP)])
#table(I.AP)
#table(I.PP)
EEExt=rbind(c(TT[2,1],p.TT[1,1],
              TT[2,2],p.TT[1,2],
              TT[2,3],p.TT[1,3],
              length(I.AP)),
            c(TT[1,1],p.TT[2,1],
              TT[1,2],p.TT[2,2],
              TT[1,3],p.TT[2,3],
              length(I.PP))
            )
EEE=EEExt[,c(1,3,5)]
colnames(EEE)=c("Asintomáticas", "Síntomas leves", "Neumonía")

colnames(EEExt)= c("Asintomáticas (N)", "Asintomáticas (%)","Síntomas leves (N)", "Síntomas leves (%)", "Neumonía (N)", "Neumonía (%)","Total")
rownames(EEExt)=c("Infectadas anteparto", "Infectadas periparto")
EEExt %>%
  kbl() %>%
  kable_styling()
```


```{r}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=2),levels=c("Asintomática", "Leve", "Grave"))
Grupo=rep(c("Anteparto","Periparto") , 3)
valor1=as.vector(prop.table(EEE, margin=1))
data1 <- data.frame(Grupo,Síntomas,valor1)
valor2=as.vector(prop.table(EEE, margin=2))
data2 <- data.frame(Grupo,Síntomas,valor2)


ggplot(data1, aes(fill=Síntomas, y=valor1, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  xlab("Momento de diagnóstico")+
  ylab("")+
  scale_fill_brewer(palette = "Dark2") 

ggplot(data2, aes(fill=Grupo, y=valor2, x=Síntomas)) + 
  geom_bar(position="dodge", stat="identity")+
  xlab("Síntomas")+
  ylab("")+
  labs(fill = "Momento diag.")

```

* Asociación entre los grupos de sintomatología y el momento del diagnóstico: test $\chi^2$, p-valor $`r signif(chisq.test(EEE)$p.value,1)`$




### Preeclampsia 


```{r}
I=Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL
TablaAntePeriCasos(Casos,I, c("PE", "No PE"))
```




### Preeclampsia con CG


```{r}
Casos.PE=Casos[Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL==1,]
I=Casos.PE$Preeclampsia.grave_HELLP_ECLAMPSIA
Sint.PE=Casos.PE$SINTOMAS_DIAGNOSTICO

TablaAntePeriCasos(Casos.PE,I, c("PE con CG", "PE sin CG"),Sint.PE)
```



### Anomalías congénitas




```{r}
I=Casos$Diagnóstico.de.malformación.ecográfica._.semana.20._
TablaAntePeriCasos(Casos,I, c("Anomalías congénitas", "No anomalías congénitas"))
```



### Retraso del crecimiento intrauterino 


```{r}
I=Casos$Defecto.del.crecimiento.fetal..en.tercer.trimestre._.CIR._.

TablaAntePeriCasos(Casos,I, c("RCIU","No RCIU"))
```





### Diabetes gestacional 

```{r}
I=Casos$Diabetes.gestacional
TablaAntePeriCasos(Casos,I, c("DG","No DG"))
```






### Hipertensión gestacional 


```{r}
I=Casos$Hipertensión.gestacional
TablaAntePeriCasos(Casos,I, c("HG","No HG"))
```








### Rotura prematura de membranas 



```{r}
I=Casos$Bolsa.rota.anteparto
TablaAntePeriCasos(Casos,I, c("RPM","No RPM"))
```

### Ingreso materno en  UCI



```{r}
I=Casos$UCI
TablaAntePeriCasos(Casos,I, c("UCI","No UCI"))
```




### Ingreso materno en UCI según el momento del parto o cesárea



```{r}
Casos.UCIM=Casos[Casos$UCI==1,]
I=Casos.UCIM$UCI_ANTES.DESPUES.DEL.PARTO
Sint.UCIM=Casos.UCIM$SINTOMAS_DIAGNOSTICO
TablaAntePeriCasos(Casos.UCIM,I, c("Antes del parto", "Después del parto"),Sint.UCIM)
```




### Feto muerto anteparto 

```{r}
Casos.Fetos=rbind(Casos,CasosGM)
I1=Casos$Feto.muerto.intraútero
I1[I1=="Sí"]=1
I1[I1=="No"]=0
I2=CasosGM$Feto.vivo
I2[I2=="Sí"]=0
I2[I2=="No"]=1
I=c(I1,I2)
Sint.Fetos=Casos.Fetos$SINTOMAS_DIAGNOSTICO

#TablaAntePeriCasos(Casos.Fetos,c("Feto muerto anteparto","Feto vivo"), Sint.Fetos)

CasosX=Casos.Fetos
SintX=Sint.Fetos
L=c("Feto muerto anteparto","Feto vivo")

  I.AP.A=I[CasosX$PreP==1& Sint=="Asintomática"]
  I.AP.L=I[CasosX$PreP==1& SintX=="Leve"]
  I.AP.G=I[CasosX$PreP==1& SintX=="Grave"]
  I.PP.A=I[CasosX$PreP==0& SintX=="Asintomática"]
  I.PP.L=I[CasosX$PreP==0& SintX=="Leve"]
  I.PP.G=I[CasosX$PreP==0& SintX=="Asintomática"]
  
  NA_I.AP.A=length(I.AP.A[is.na(I.AP.A)])
  NA_I.AP.L=length(I.AP.L[is.na(I.AP.L)])
  NA_I.AP.G=length(I.AP.G[is.na(I.AP.G)])
  NA_I.PP.A=length(I.PP.A[is.na(I.PP.A)])
  NA_I.PP.L=length(I.PP.L[is.na(I.PP.L)])
  NA_I.PP.G=length(I.PP.G[is.na(I.PP.G)])
  
  
  
  EEExt=rbind(c(as.vector(table(I.AP.A))[2:1],NA_I.AP.A),
              c(round(100*as.vector(prop.table(table(I.AP.A)))[2:1],1),NA),
              c(as.vector(table(I.AP.L))[2:1],NA_I.AP.L),
              c(round(100*as.vector(prop.table(table(I.AP.L)))[2:1],1),NA),
              c(as.vector(table(I.AP.G))[2:1],NA_I.AP.G),
              c(round(100*as.vector(prop.table(table(I.AP.G)))[2:1],1),NA),
              c(as.vector(table(I.PP.A))[2:1],NA_I.PP.A),
              c(round(100*as.vector(prop.table(table(I.PP.A)))[2:1],1),NA),
              c(as.vector(table(I.PP.L))[2:1],NA_I.PP.L),
              c(round(100*as.vector(prop.table(table(I.PP.L)))[2:1],1),NA),
              c(as.vector(table(I.PP.G))[2:1],NA_I.PP.G),
              c(round(100*as.vector(prop.table(table(I.PP.G)))[2:1],1),NA)
  )
  
  colnames(EEExt)=c(L,"Datos perdidos")
  rownames(EEExt)=c("Inf. AP. Asintomáticas (N)", "Inf. AP. Asintomáticas (%)",
                    "Inf. AP. Leves (N)", "Inf. AP. Leves (%)",
                    "Inf. AP. Graves (N)", "Inf. AP. Graves (%)",
                    "Inf. PP. Asintomáticas (N)", "Inf. PP. Asintomáticas (%)",
                    "Inf. PP. Leves (N)", "Inf. PP. Leves (%)",
                    "Inf. PP. Graves (N)", "Inf. PP. Graves (%)")
  
  t(EEExt) %>%
    kbl() %>%
    kable_styling() %>%     
    scroll_box(width="100%", box_css="border: 0px;")  
```



### Prematurez 



```{r}
I=Casos$PREMATURO
TablaAntePeriCasos(Casos,I, c("Prematuro","A término"))
```


### Eventos trombóticos



```{r}
I=Casos$EVENTOS_TROMBO_TOTALES
TablaAntePeriCasos(Casos,I, c("Eventos trombóticos","No eventos trombóticos"))
```


### Eventos hemorrágicos


```{r}
I=Casos$EVENTOS_HEMORRAGICOS_TOTAL
TablaAntePeriCasos(Casos,I, c("Eventos hemorrágicos","No eventos hemorrágicos"))
```



### Hemorragias potsparto



```{r}
I=Casos$Hemorragia.postparto

I.sino=I
I.sino[I.sino!="No" & !is.na(I.sino)]="Sí"

TablaAntePeriCasos(Casos,I.sino, c("HPP","No HPP"))
```


```{r}
I=ordered(I,levels=names(table(I))[c(2,3,1,4)])

TablaAntePeriCasos.m(Casos,I,c("Tto. médico",
"Tto. Qx. conservador","Histerectomía",
"No HPP"))

```



* Diferencia entre infectadas ante y periparto: test $\chi^2$ de Montecarlo, p-valor `r round(chisq.test(EE[c(1,2),],simulate.p.value=TRUE,B=10000)$p.value,3)`



### Inicio del parto


```{r}
I=Casos$Inicio.de.parto
I=factor(Casos$Inicio.de.parto,levels=c("Espontáneo", "Inducido", "Cesárea"),ordered=TRUE)

TablaAntePeriCasos.m(Casos,I,c("Espontáneo", "Inducido", "Cesárea"))
```








### Tipo de parto


```{r}
I.In=Casos$Inicio.de.parto
I.In[I.In=="Cesárea"]="Cesárea programada"
I=Casos$Tipo.de.parto
I[I.In=="Cesárea programada"]="Cesárea programada"
I[I=="Cesárea"]="Cesárea urgente"

I=factor(I,levels=c("Eutocico", "Instrumental", "Cesárea programada", "Cesárea urgente"),ordered=TRUE)
TablaAntePeriCasos.m(Casos,I,c("Eutócico", "Instrumental", "Cesárea programada", "Cesárea urgente"))
```






### Test de Apgar



```{r}
I=c(Casos$APGAR.5...126,CasosGM$APGAR.5...150)
I.cut=cut(I,breaks=c(-1,7,20),labels=c("0-7","8-10"))
I.cut=ordered(I.cut,levels=c("8-10","0-7"))

TablaAntePeriCasos(Casos.Fetos,I.cut,c("Apgar.5≤7", "Apgar.5≥8"),Sint.Fetos)
```



### Ingreso del neonato en  UCI



```{r}
Casos.FetosVivos=rbind(Casos[Casos$Feto.muerto.intraútero=="No",],CasosGM[CasosGM$Feto.vivo=="Sí",])
Sint.FetosVivos=Casos.FetosVivos$SINTOMAS_DIAGNOSTICO
I=c(Casos[Casos$Feto.muerto.intraútero=="No",]$Ingreso.en.UCIN,CasosGM[CasosGM$Feto.vivo=="Sí",]$Ingreso.en.UCI)

TablaAntePeriCasos(Casos.FetosVivos,I,c("UCIN", "No UCIN"),Sint.FetosVivos)
```


### Peso de neonatos


```{r}
I=c(Casos[Casos$Feto.muerto.intraútero=="No",]$Peso._gramos_...125,CasosGM[CasosGM$Feto.vivo=="Sí",]$Peso._gramos_...247)
I.AP.A=I[Casos$PreP==1&Casos$SINTOMAS_DIAGNOSTICO=="Asintomática"]
I.AP.L=I[Casos$PreP==1&Casos$SINTOMAS_DIAGNOSTICO=="Leve"]
I.AP.G=I[Casos$PreP==1&Casos$SINTOMAS_DIAGNOSTICO=="Grave"]
I.PP.A=I[Casos$PreP==0&Casos$SINTOMAS_DIAGNOSTICO=="Asintomática"]
I.PP.L=I[Casos$PreP==0&Casos$SINTOMAS_DIAGNOSTICO=="Leve"]
I.PP.G=I[Casos$PreP==0&Casos$SINTOMAS_DIAGNOSTICO=="Grave"]
```


```{r}
Dades=rbind(c(round(min(I.AP.A,na.rm=TRUE),1),round(max(I.AP.A,na.rm=TRUE),1), round(mean(I.AP.A,na.rm=TRUE),1),round(median(I.AP.A,na.rm=TRUE),1),round(quantile(I.AP.A,c(0.25,0.75),na.rm=TRUE),1), round(sd(I.AP.A,na.rm=TRUE),1)),
 c(round(min(I.AP.L,na.rm=TRUE),1),round(max(I.AP.L,na.rm=TRUE),1), round(mean(I.AP.L,na.rm=TRUE),1),round(median(I.AP.L,na.rm=TRUE),1),round(quantile(I.AP.L,c(0.25,0.75),na.rm=TRUE),1), round(sd(I.AP.L,na.rm=TRUE),1)),           
      c(round(min(I.AP.G,na.rm=TRUE),1),round(max(I.AP.G,na.rm=TRUE),1), round(mean(I.AP.G,na.rm=TRUE),1),round(median(I.AP.G,na.rm=TRUE),1),round(quantile(I.AP.G,c(0.25,0.75),na.rm=TRUE),1), round(sd(I.AP.G,na.rm=TRUE),1)),           
c(round(min(I.PP.A,na.rm=TRUE),1),round(max(I.PP.A,na.rm=TRUE),1), round(mean(I.PP.A,na.rm=TRUE),1),round(median(I.PP.A,na.rm=TRUE),1),round(quantile(I.PP.A,c(0.25,0.75),na.rm=TRUE),1), round(sd(I.PP.A,na.rm=TRUE),1)),
 c(round(min(I.PP.L,na.rm=TRUE),1),round(max(I.PP.L,na.rm=TRUE),1), round(mean(I.PP.L,na.rm=TRUE),1),round(median(I.PP.L,na.rm=TRUE),1),round(quantile(I.PP.L,c(0.25,0.75),na.rm=TRUE),1), round(sd(I.PP.L,na.rm=TRUE),1)),           
      c(round(min(I.PP.G,na.rm=TRUE),1),round(max(I.PP.G,na.rm=TRUE),1), round(mean(I.PP.G,na.rm=TRUE),1),round(median(I.PP.G,na.rm=TRUE),1),round(quantile(I.PP.G,c(0.25,0.75),na.rm=TRUE),1), round(sd(I.PP.G,na.rm=TRUE),1)))

colnames(Dades)=c("Peso mínimo","Peso máximo","Peso medio", "Peso mediano", "1er cuartil", "3er cuartil", "Desv. típica")
rownames(Dades)=c("Inf. AP. asintómaticas", "Inf. AP. leves", "Inf. AP. graves","Inf. PP. asintómaticas", "Inf. PP. leves", "Inf. PP. graves")

Dades %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")

```







*Bajo peso*


```{r}
I.cut=cut(I,breaks=c(0,2500,10000),labels=c(1,0),right=FALSE)
I.cut=ordered(I.cut,levels=c(0,1))

TablaAntePeriCasos(Casos.FetosVivos,I.cut,c("Bajo peso", "No bajo peso"),Sint.FetosVivos)

```


