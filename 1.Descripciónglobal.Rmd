# Descripción de la muestra global




## Madres

Hay `r n_I` infectadas y `r n_NI` no infectadas. 

### Edades



```{r}
I=Casos$Edad._años_
NI=Controls$Edad._años_
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
```

```{r 1,fig.cap="\\s"}
data =data.frame(
  name=c(rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Edades=c(I,NI)
  )

sample_size = data %>% group_by(name) %>% summarize(num=n())

data %>%
 left_join(sample_size) %>%
  mutate(myaxis = paste0(name, "\n", "n=", num)) %>%
  ggplot( aes(x=myaxis, y=Edades, fill=name)) +
    geom_violin(width=1) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    theme(
      legend.position="none",
      plot.title = element_text(size=11)
    ) +
    xlab("")+
  ylab("Edades (años)")
```





```{r}
Dades=rbind(c(min(I,na.rm=TRUE),max(I,na.rm=TRUE), round(mean(I,na.rm=TRUE),1),round(median(I,na.rm=TRUE),1),round(quantile(I,c(0.25,0.75),na.rm=TRUE),1), round(sd(I,na.rm=TRUE),1)),
            c(min(NI,na.rm=TRUE),max(NI,na.rm=TRUE), round(mean(NI,na.rm=TRUE),1),round(median(NI,na.rm=TRUE),1),round(quantile(NI,c(0.25,0.75),na.rm=TRUE),1),round(sd(NI,na.rm=TRUE),1)))

colnames(Dades)=c("Edad mínima","Edad máxima","Edad media", "Edad mediana", "1er cuartil", "3er cuartil", "Desv. típica")
rownames(Dades)=c("Infectadas", "No infectadas")

Dades %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")


```



```{r}
I.cut=cut(I,breaks=c(0,30,40,100),labels=c("18-30","31-40",">40"))
NI.cut=cut(NI,breaks=c(0,30,40,100),labels=c("18-30","31-40",">40"))

EE=rbind(as.vector(table(I.cut)),as.vector(table(NI.cut)))
EEExt=rbind(c(as.vector(table(I.cut)),NA_I),
            round(100*c(as.vector(table(I.cut)),NA_I)/n_I,1),
            c(as.vector(table(NI.cut)),NA_NI),
            round(100*c(as.vector(table(NI.cut)),NA_NI)/n_NI,1)
            )
EEExt=cbind(EEExt,c(n_I,100,n_NI,100))

colnames(EEExt)=c("18-30","31-40",">40","Pérdidas","Total")
rownames(EEExt)=c("Infectadas (N)", "Infectadas (%)","No infectadas (N)", "No infectadas (%)")

t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r 2,fig.cap="\\s"}
df =data.frame(
  Factor=c(rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Edades=c( I.cut,NI.cut )
)

base=ordered(rep(c("18-30","31-40",">40"), each=2),levels=c("18-30", "31-40",   ">40"))
Grupo=rep(c("Infectada","No infectada") , length(levels(I.cut)))
valor=as.vector(prop.table(table(df), margin=1))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=base , y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  scale_fill_brewer(palette = "Accent")+
  labs(fill = "Grupo de edad")

```


```{r 3,fig.cap="\\s"}
df =data.frame(
  Factor=c(rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Edades=c( I.cut,NI.cut )
)

base=ordered(rep(c("18-30","31-40",">40"), each=2),levels=c("18-30", "31-40",   ">40"))
Grupo=rep(c("Infectada","No infectada") , length(levels(I.cut)))
valor=as.vector(prop.table(table(df), margin=2))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=Grupo, y=valor, x=base)) + 
  geom_bar(position="dodge", stat="identity")+
xlab("Grupos de edad")+
  ylab("")
```


Tests:


* Ajuste de las edades de infectadas y no infectadas a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I)$p.value,1)`$ y $`r 
signif(shapiro.test(NI)$p.value,1)`$, respectivamente

* Igualdad de edades medias: test t, p-valor `r round(t.test(I,NI)$p.value,2)`, IC del 95% para la diferencia de medias [`r round(t.test(I,NI)$conf.int,2)`] años

* Igualdad de desviaciones típicas: test de Fligner-Killeen, p-valor $`r round(fligner.test(list(I,NI))$p.value,5)`$

* Igualdad de composiciones por edades de los grupos de casos y de controles: test $\chi^2$, p-valor `r round(chisq.test(EE)$p.value,4)`. 

En la tabla que sigue:

* p-valor ajustado: p-valores de tests de Fisher bilateral ajustados por Bonferroni calculados para la muestra sin pérdidas
* OR: la odds ratio univariante estimada de infectarse relativa a la franja de dead
* IC: el intervalo de confianza del 95% para la OR

```{r}
pp=rep(0,dim(EE)[2])
for (i in 1:dim(EE)[2]){
pp[i]=prop.test(c(EE[1,i],sum(EE[1,-i])),
                c(sum(EE[,i]),sum(EE[,-i])))$p.value
}
pp=p.adjust(pp,method="bonferroni")
OR=rep(0,dim(EE)[2])
CI1=rep(0,dim(EE)[2])
CI2=rep(0,dim(EE)[2])

for (i in 1:dim(EE)[2]){
FT=fisher.test(rbind(c(EE[1,i],sum(EE[1,-i])),
                  c(EE[2,i],sum(EE[2,-i]))))
OR[i]=round(FT$estimate,2)
CI1[i]=round(FT$conf.int[1],2)
CI2[i]=round(FT$conf.int[2],2)
                }
dt=data.frame(franja=c("18-30","31-40",">40"),pp,OR,CI1,CI2)
names(dt)=c("Franja", "p-valor ajustado","OR","Extremo inferior de IC", "Extremo superior de IC")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



### Etnias

```{r}
I=Casos$Etnia
I[I=="Asia"]="Asiática"
I=factor(I)
NI=factor(Controls$Etnia)
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
```


```{r}
EE=rbind(as.vector(table(I)),
         as.vector(table(NI)))
EEExt=rbind(c(as.vector(table(I)),NA_I),
            round(100*c(as.vector(table(I)),NA_I)/n_I,1),
            c(as.vector(table(NI)),NA_NI),
            round(100*c(as.vector(table(NI)),NA_NI)/n_NI,1))
colnames(EEExt)=c("Árabe", "Asia", "Blanca", "Latinoamericana","Negra","Pérdidas")
rownames(EEExt)=Columnes

t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```

```{r 4,fig.cap="\\s"}
df =data.frame(
  Factor=c(rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Etnias=c(I,NI)
)
base=rep(levels(I) , each=2)
Grupo=rep(c("Infectada","No infectada") , length(levels(I)))
valor=as.vector(prop.table(table(df), margin=1))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=base , y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  scale_fill_brewer(palette = "Accent")+
  labs(fill = "Etnia")

```

```{r 5,fig.cap="\\s"}
df =data.frame(
  Factor=c(rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Etnias=c(I,NI)
)
base=rep(levels(I) , each=2)
Grupo=rep(c("Infectada","No infectada") , length(levels(I)))
valor=as.vector(prop.table(table(df), margin=2))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=Grupo, y=valor, x=base)) + 
  geom_bar(position="dodge", stat="identity")+
xlab("Etnias")+
  ylab("")

```


* Composiciones por edades de los grupos de casos y de controles: test $\chi^2$, p-valor  $`r signif(chisq.test(EE)$p.value,1)`$


En la tabla que sigue:

* p-valor ajustado: p-valores de tests de Fisher bilateral ajustados por Bonferroni calculados para la muestra sin pérdidas
* OR: la odds ratio univariante estimada de infectarse relativa a la etnia
* IC: el intervalo de confianza del 95% para la OR

```{r}
pp=rep(0,dim(EE)[2])
OR=rep(0,dim(EE)[2])
CI1=rep(0,dim(EE)[2])
CI2=rep(0,dim(EE)[2])

for (i in 1:dim(EE)[2]){
FT=fisher.test(rbind(c(EE[1,i],sum(EE[1,-i])),
                  c(EE[2,i],sum(EE[2,-i]))))
pp[i]=FT$p.value
OR[i]=round(FT$estimate,2)
CI1[i]=round(FT$conf.int[1],2)
CI2[i]=round(FT$conf.int[2],2)
                  }
pp=p.adjust(pp,method="bonferroni")
dt=data.frame(franja=c("Árabe", "Asia", "Blanca", "Latinoamericana","Negra"),pp,OR,CI1,CI2)
names(dt)=c("Franja","p-valor ajustado","OR","Extremo inferior de IC", "Extremo superior de IC")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```





### Hábito tabáquico (juntando fumadoras y ex-fumadoras en una sola categoría)



```{r}
I=Casos$FUMADORA_CAT
NI=Controls$Fumadora_cat
Tabla.DMG(I,NI,"No fumadora","Fumadora")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```


* Comparación de proporciones de fumadoras en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a ser fumadora, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]

<!--

### Tabaco v2: Separando fumadoras y ex-fumadoras


```{r}
I=Casos$Fumadora
NI=Controls$Fumadora
NI[NI=="0"]="No"
NI[NI=="1"]="Sí"
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
I=factor(I,levels=c("No","Ex-fumadora","Sí"))
NI=factor(NI,levels=c("No","Ex-fumadora","Sí"))


```

```{r}
dtbp=data.frame(c(rep("Infectadas",n_I-NA_I),rep("No infectadas",n_NI-NA_NI)),c(I[!is.na(I)],NI[!is.na(NI)]))
barplot(prop.table(table(dtbp), margin=1),beside=TRUE,col=c("pink","light blue"),legend.text=TRUE, main="Diagrama de barras de estatus de fumadora",ylab="Proporción",ylim=c(0,1))
```



```{r}
EE=rbind(as.vector(table(I)),
         as.vector(table(NI)))
EEExt=rbind(c(as.vector(table(I)),NA_I),
            round(100*c(as.vector(table(I)),NA_I)/n_I,1),
            c(as.vector(table(NI)),NA_NI),
            round(100*c(as.vector(table(NI)),NA_NI)/n_NI,1))

colnames(EEExt)=c("No fumadora", "Ex-fumadora","Fumadora", "Pérdidas")
rownames(EEExt)=Columnes

t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```

```{r}
FT=chisq.test(EE)
```

Hay diferencia estadísticamente significativa entre las distribuciones (test $\chi^2$, p-valor `r round(FT$p.value,3)`)


En la tabla que sigue:

* p-valor ajustado: el p-valor del test de Fisher ajustado por Bonferroni
* OR: la odds ratio univariante estimada de infectarse relativa al estatus de fumador
* IC: el intervalo de confianza del 95% para la OR


```{r}
pp=rep(0,dim(EE)[2])
OR=rep(0,dim(EE)[2])
CI1=rep(0,dim(EE)[2])
CI2=rep(0,dim(EE)[2])

for (i in 1:dim(EE)[2]){
FT=fisher.test(rbind(c(EE[2,i],sum(EE[2,-i])),
                  c(EE[1,i],sum(EE[1,-i]))))
pp[i]=round(FT$p.value,4)
OR[i]=round(FT$estimate,4)
CI1[i]=round(FT$conf.int[1],4)
CI2[i]=round(FT$conf.int[2],4)
                  }
pp=p.adjust(pp,method="bonferroni")
dt=data.frame(franja=c("No fumadora", "Ex-fumadora","Fumadora"),round(pp,4),OR,CI1,CI2)
names(dt)=c("Franja","p-valor ajustado","OR","Extremo inferior de IC", "Extremo superior de IC")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```

Diferencias estadísticamente significativas en fumadoras y en no fumadoras, pero no en ex-fumadoras


-->

### Obesidad 


```{r}
I=Casos$Obesidad
NI=Controls$Obesidad
Tabla.DMG(I,NI,"No obesa","Obesa")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```

* Comparación de proporciones de obesas en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a ser obesa, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]



### Hipertensión pregestacional


```{r}
I=Casos$Hipertensión.pregestacional
NI=Controls$Hipertensión.pregestacional
Tabla.DMG(I,NI,"No HTA","HTA")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```


* Comparación de proporciones de hipertensas en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a hipertensión pregestacional, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]



### Diabetes Mellitus 

```{r}
I=Casos$DIABETES
NI=Controls$Diabetes
Tabla.DMG(I,NI,"No DM","DM")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```


* Comparación de proporciones de diabéticas en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a diabetes mellitus, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]



### Enfermedades cardíacas crónicas 

```{r}
I=Casos$Enfermedad.cardiaca.crónica
NI=Controls$ENF.CARDIACA.TODO
Tabla.DMG(I,NI,"No ECC","ECC")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```

* Comparación de proporciones de ECC en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a enfermedades cardíacas crónicas , `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]



### Enfermedades pulmonares crónicas (incluyendo asma)

<!--

#### No Asma

```{r}
I=Casos$Enfermedad.pulmonar.crónica.no.asma
NI=Controls$Enfermedad.pulmonar.crónica.no.asma
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])


```


```{r}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
EEExt=rbind(c(as.vector(table(I))[2:1],NA_I),
            round(100*c(as.vector(table(I))[2:1],NA_I)/n_I,1),
            c(as.vector(table(NI))[2:1],NA_NI),
            round(100*c(as.vector(table(NI))[2:1],NA_NI)/n_NI,1))
rownames(EEExt)=Columnes
colnames(EEExt)=c("EPC", "No EPC","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r}
FT=fisher.test(EE)
```

* test de Fisher, p-valor `r round(FT$p.value,3)`; No hay diferencia estadísticamente significativa
* OR univariante estimada de infección relativa a  enfermedad pulmonar crónica  no asma `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]

#### Asma


```{r}
I=Casos$Diagnóstico.clínico.de.Asma
NI=Controls$Diagnóstico.clínico.de.Asma
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])


```


```{r}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
EEExt=rbind(c(as.vector(table(I))[2:1],NA_I),
            round(100*c(as.vector(table(I))[2:1],NA_I)/n_I,1),
            c(as.vector(table(NI))[2:1],NA_NI),
            round(100*c(as.vector(table(NI))[2:1],NA_NI)/n_NI,1))
rownames(EEExt)=Columnes
colnames(EEExt)=c("Asma", "No Asma","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r}
FT=fisher.test(EE)
```

* test de Fisher, p-valor `r round(FT$p.value,3)`; No hay diferencia estadísticamente significativa
* OR univariante estimada de infección relativa a  asma, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]


#### Total

-->


```{r,warning=FALSE}
INA=Casos$Enfermedad.pulmonar.crónica.no.asma
NINA=Controls$Enfermedad.pulmonar.crónica.no.asma
NINA[NINA==0]="No"
NINA[NINA==1]="Sí"
IA=Casos$Diagnóstico.clínico.de.Asma
NIA=Controls$Diagnóstico.clínico.de.Asma
NIA[NIA==0]="No"
NIA[NIA==1]="Sí"

I=rep(NA,n_I)
for (i in 1:n_I){I[i]=max(INA[i],IA[i],na.rm=TRUE)}
NI=rep(NA,n_NI)
for (i in 1:n_NI){NI[i]=max(NINA[i],NIA[i],na.rm=TRUE)}
NI[NI==-Inf]=NA
```

```{r}
Tabla.DMG(I,NI,"No EPC","EPC")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```


* Comparación de proporciones de ECP en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a enfermedad pulmonar crónica (incluyendo asma), `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]



### Paridad



```{r}
I=Casos$NULIPARA
NI=Controls$Nuliparous
Tabla.DMG(I,NI,"Multípara","Nulípara")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```


* Comparación de proporciones de nulíparas en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a ser nulípara, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]

<!--

**Cuidado**: La distribución de nulíparas-multíparas varía con la edad, las mayores son más frecuentemente multíparas, así que no concluyas que las multíparas en la población tienen mayor probabilidad de infección

```{r}
DFCa=data.frame(Casos[,c("Edad._años_","NULIPARA")])
names(DFCa)=c("Edad","Nuliparidad")
DFCa$FranjaEdad=cut(DFCa$Edad,breaks=c(0,30,40,100),labels=c("18-30","31-40",">40"))
DFCa$Infectada=1
DFCo=Controls[,c("Edad._años_","Nuliparous")]
names(DFCo)=c("Edad","Nuliparidad")
DFCo$FranjaEdad=cut(DFCo$Edad,breaks=c(0,30,40,100),labels=c("18-30","31-40",">40"))
DFCo$Infectada=0
DF=rbind(DFCa,DFCo)
DF$Nuliparidad[DF$Nuliparidad==0]="Multípara"
DF$Nuliparidad[DF$Nuliparidad==1]="Nulípara"
table(DF[,2:3]) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")

```


Hay diferencia estadísticamente dignificativa en las distribuciones por edades de nulíparas y multíparas (test $\chi^2$, p-valor $`r chisq.test(table(DF[,2:3]))$p.value`$)

--> 


## Embarazos



### Gestación múltiple



```{r}
I=Casos$Gestación.Múltiple
NI=Controls$Gestación.Múltiple
Tabla.DMG(I,NI,"Gestación única","Gestación múltiple")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```


* Comparación de proporciones de gestaciones múltiples en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a gestación múltiple, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]



### Anomalías congénitas


```{r}
I=Casos$Diagnóstico.de.malformación.ecográfica._.semana.20._
NI=Controls$Diagnóstico.de.malformación.ecográfica._.semana.20._
Tabla.DMG(I,NI,"No anomalía congénita","Anomalía congénita")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgos de anomalía congénita en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de anomalía congénita relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]



### Retraso del crecimiento intrauterino 


```{r}
I=Casos$Defecto.del.crecimiento.fetal..en.tercer.trimestre._.CIR._.
NI=Controls$Defecto.del.crecimiento.fetal..en.tercer.trimestre._.CIR._.
Tabla.DMG(I,NI,"No RCIU","RCIU")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgos de retraso del crecimiento intrauterino  en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de retraso del crecimiento intrauterino  relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]


### Diabetes gestacional 

```{r}
I=Casos$Diabetes.gestacional
NI=Controls$Diabetes.gestacional
Tabla.DMG(I,NI,"No DG","DG")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgo de diabetes gestacional en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de diabetes gestacional relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]



### Hipertensión gestacional 


```{r}
I=Casos$Hipertensión.gestacional
NI=Controls$Hipertensión.gestacional
Tabla.DMG(I,NI,"No HG","HG")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgo de hipertensión gestacional en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de hipertensión gestacional  relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]



### Preeclampsia 



```{r}
I=Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL
NI=Controls$PREECLAMPSIA
Tabla.DMG(I,NI,"No PE","PE")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgo de preeclampsia en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de preeclampsia relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]


### Preeclampsia con criterios de gravedad


```{r}
n_PI=sum(Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL)
n_PNI=sum(Controls$PREECLAMPSIA)
I=Casos[Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL==1,]$Preeclampsia.grave_HELLP_ECLAMPSIA

NI1=Controls[Controls$PREECLAMPSIA==1,]$preeclampsia_severa
NI2=Controls[Controls$PREECLAMPSIA==1,]$Preeclampsia.grave.No.HELLP 
NI=rep(NA,n_PNI)
for (i in 1:n_PNI){NI[i]=max(NI1[i],NI2[i],na.rm=TRUE)}

NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])

EEExt=rbind(c(as.vector(table(I)),NA_I),
            round(100*c(as.vector(table(I)),NA_I)/length(I),1),
            c(as.vector(table(NI)),NA_NI),
            round(100*c(as.vector(table(NI)),NA_NI)/length(I),1))
rownames(EEExt)=Columnes

colnames(EEExt)=c("PE sin CG", "PE con CG","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo preeclampsia con CG en preeclámpsicas infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de preeclampsia con CG en preeclámpsicas relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]



### Rotura prematura de membranas 



```{r}
I=Casos$Bolsa.rota.anteparto
NI=Controls$Bolsa.rota.anteparto
Tabla.DMG(I,NI,"No RPM","RPM")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgo de  rotura prematura de membranas en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de rotura prematura de membranas relativa a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(riskscoreci(544,1641,487,1594,conf.level=0.95)$conf.int,2)`]



### Edad gestacional en el momento del parto 


```{r}
I=Casos$EG_TOTAL_PARTO
NI=Controls$EDAD_GEST   
```


```{r}
Dades=rbind(c(min(I,na.rm=TRUE),max(I,na.rm=TRUE), round(mean(I,na.rm=TRUE),1),round(median(I,na.rm=TRUE),1),round(quantile(I,c(0.25,0.75),na.rm=TRUE),1), round(sd(I,na.rm=TRUE),1)),
            c(min(NI,na.rm=TRUE),max(NI,na.rm=TRUE), round(mean(NI,na.rm=TRUE),1),round(median(NI,na.rm=TRUE),1),round(quantile(NI,c(0.25,0.75),na.rm=TRUE),1),round(sd(NI,na.rm=TRUE),1)))

colnames(Dades)=c("Edad gest. mínima","Edad gest. máxima","Edad gest. media", "Edad gest. mediana", "1er cuartil", "3er cuartil", "Desv. típica")
rownames(Dades)=c("Infectadas", "No infectadas")

Dades %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")


```



```{r 6,fig.cap="\\s"}
data =data.frame(
  name=c( rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Edades=c( I,NI )
)

data %>%
  ggplot( aes(x=name, y=Edades, fill=name)) +
    geom_violin(width=1) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    theme(
      legend.position="none",
      plot.title = element_text(size=11)
    ) +
    xlab("")+
  ylab("Edades gestacionales (semanas)")
```




```{r,include=FALSE}
shapiro.test(I)$p.value
shapiro.test(NI)$p.value
fligner.test(list(I,NI))
ttest=t.test(I,NI)
```

* Ajuste de las edades gestacionales de infectadas y no infectadas a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I)$p.value,1)`$ y $`r 
signif(shapiro.test(NI)$p.value,1)`$, respectivamente

* Edades gestacionales medias: test t, p-valor $`r signif(ttest$p.value,1)`$, IC del 95% para la diferencia de medias [`r round(ttest$conf.int,2)`]

* Desviaciones típicas: test de Fligner-Killeen, p-valor $`r signif(fligner.test(list(I,NI))$p.value,1)`$


```{r,include=FALSE}
I=I[I>20]
shapiro.test(I)$p.value
shapiro.test(NI)$p.value
fligner.test(list(I,NI))
ttest=t.test(I,NI)
```

**Nota**: Como vemos en los boxplot, hay dos casos de infectadas con edades gestacionales incompatibles con la definición de "parto" (y que además luego tienen información incompatible con esto). Son `00133-00046` y `00268-00008`. Si las quitamos, las conclusiones son las mismas:

* Ajuste de las edades gestacionales de infectadas y no infectadas a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I)$p.value,1)`$ y $`r 
signif(shapiro.test(NI)$p.value,1)`$, respectivamente


* Edades medias: test t, p-valor $`r signif(ttest$p.value,1)`$, IC del 95% para la diferencia de medias [`r round(ttest$conf.int,2)`]

* Desviaciones típicas: test de Fligner-Killeen, p-valor $`r signif(fligner.test(list(I,NI))$p.value,1)`$





### Ingreso materno en  UCI



```{r}
I=Casos$UCI
NI=Controls$UCI...9
Tabla.DMG(I,NI,"No UCI","UCI")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgo de ingreso materno en UCI en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de UCI relativa a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]


### Ingreso materno en UCI según el momento del parto o cesárea


```{r}
UCI.I=sum(Casos$UCI,na.rm=TRUE)
UCI.NI=sum(Controls$UCI...9,na.rm=TRUE)
I=Casos$UCI_ANTES.DESPUES.DEL.PARTO
NI=Controls$UCI.ANTES.DEL.PARTO  #Vacía

EE=rbind(as.vector(table(I)),
         c(0,UCI.NI))
EEExt=rbind(c(as.vector(table(I)),0),
            round(100*c(as.vector(table(I)),0)/UCI.I,1),
            c(0,UCI.NI,0),
            c(0,100,0))
rownames(EEExt)=Columnes

colnames(EEExt)=c("UCI antes del parto", " UCI después del parto","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r,include=FALSE}
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo de UCI antes del parto en las ingresadas en UCI infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de UCI antes del parto en las ingresadas en UCI relativa a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: $`r round(PT$estimate[1]/PT$estimate[2],2)`$

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [$`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`$]


### Embarazos con algún feto muerto anteparto 


```{r,include=FALSE}
IGM=Casos[Casos$Gestación.Múltiple=="Sí", c("Feto.muerto.intraútero","Feto.vivo") ]
table(IGM)
# En todas las infectadas con parto múltiple de las que tenemos datos los dos estaban vivos
NIGM=Controls[Controls$Gestación.Múltiple==1, c("Feto.vivo...194","Feto.vivo...245") ]
table(NIGM)
# En las controles hubo un caso de gestación múltiple con un feto muerto
```



```{r}
I=Casos$Feto.muerto.intraútero
I[I=="Sí"]=1
I[I=="No"]=0
NI1=Controls$Feto.vivo...194
NI1[NI1=="Sí"]=0
NI1[NI1=="No"]=1
NI2=Controls$Feto.vivo...245
NI2[NI2=="Sí"]=0
NI2[NI2=="No"]=1
NI=NI1
for (i in 1:length(NI1)){NI[i]=max(NI1[i],NI2[i],na.rm=TRUE)}

Tabla.DMG(I,NI,"Ningún feto muerto anteparto","Algún feto muerto anteparto")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgo de algún feto muerto anteparto en infectadas y no infectadas: test de Fisher bilateral, p-valor $`r round(FT$p.value,4)`$; 

* RA estimado de algún feto muerto anteparto relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]





### Inicio del parto


```{r}
I=factor(Casos$Inicio.de.parto)
NI=Controls$Inicio.de.parto
NI[NI=="Cesárea programada"]="Cesárea"
NI=factor(NI)

NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
```

```{r}
EE=rbind(as.vector(table(I)),
         as.vector(table(NI)))
EEExt=rbind(c(as.vector(table(I))[c(2,3,1)],NA_I),
            round(100*c(as.vector(table(I))[c(2,3,1)],NA_I)/n_I,1),
            c(as.vector(table(NI))[c(2,3,1)],NA_NI),
            round(100*c(as.vector(table(NI))[c(2,3,1)],NA_NI)/n_NI,1))
colnames(EEExt)=c("Espontáneo", "Inducido", "Cesárea programada","Pérdidas")
rownames(EEExt)=Columnes

t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



```{r 7,fig.cap="\\s"}
df =data.frame(
  Factor=c( rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Inicios=ordered(c( I,NI ),levels=c("Espontáneo","Inducido","Cesárea"))
)

base=ordered(rep(c("Espontáneo","Inducido","Cesárea"), each=2),levels=c("Espontáneo","Inducido","Cesárea"))
Grupo=rep(c("Infectada","No infectada") , 3)
valor=c(as.vector(prop.table(table(df),margin=1))                 )
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=base, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+  
  ylab("")+
  scale_fill_brewer(palette = "Set3")+
  labs(fill = "Inicio de parto")
```


```{r 8,fig.cap="\\s"}
df =data.frame(
  Factor=c( rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Inicios=ordered(c( I,NI ),levels=c("Espontáneo","Inducido","Cesárea"))
)

base=ordered(rep(c("Espontáneo","Inducido","Cesárea"), each=2),levels=c("Espontáneo","Inducido","Cesárea"))
Grupo=rep(c("Infectada","No infectada") , 3)
valor=c(as.vector(prop.table(table(df),margin=2))                 )
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=Grupo, y=valor, x=base)) + 
  geom_bar(position="dodge", stat="identity")+  
  xlab("Inicios de parto")+
  ylab("")
```

```{r,include=FALSE}
FT=chisq.test(EE)
```


* Distribuciones de los inicios de parto en los grupos de infectadas y no infectadas: test $\chi^2$, p-valor $`r signif(chisq.test(EE)$p.value,1)`$


En la tabla que sigue:

* p-valor ajustado: p-valores de tests de Fisher bilateral ajustados por Bonferroni calculados para la muestra sin pérdidas
* RA y RR: riesgos absoluto y relativo estimados del inicio de parto relativos a la infección
* IC-RA e IC-RR: sus intervalos de confianza del 95% respectivos

```{r}
pp=rep(0,dim(EE)[2])
RA=rep(0,dim(EE)[2])
RR=rep(0,dim(EE)[2])
CIRA1=rep(0,dim(EE)[2])
CIRA2=rep(0,dim(EE)[2])
CIRR1=rep(0,dim(EE)[2])
CIRR2=rep(0,dim(EE)[2])

for (i in 1:dim(EE)[2]){
EE.temp=rbind(c(EE[1,i],sum(EE[1,-i])),
                  c(EE[2,i],sum(EE[2,-i])))
FT=fisher.test(EE.temp)
PT=prop.test(EE.temp[,1],rowSums(EE.temp))
pp[i]=FT$p.value
RA[i]=round(PT$estimate[1]-PT$estimate[2],3)
RR[i]=round(PT$estimate[1]/PT$estimate[2],3)
CIRA1[i]=round(PT$conf.int,4)[1]
CIRA2[i]=round(PT$conf.int,4)[2]
CIRR1[i]=round(RelRisk(EE.temp,conf.level=0.95,method="wald"),3)[2]
CIRR2[i]=round(RelRisk(EE.temp,conf.level=0.95,method="wald"),3)[3]
            }
pp=p.adjust(pp,method="bonferroni")
#> pp[c(2,3,1)]
#[1] 3.046147e-08 5.563602e-03 1.110478e-06
dt=data.frame(franja=c("Espontáneo", "Inducido", "Cesárea programada"),pp[c(2,3,1)],RA[c(2,3,1)],RR[c(2,3,1)],CIRA1[c(2,3,1)],CIRA2[c(2,3,1)],CIRR1[c(2,3,1)],CIRR2[c(2,3,1)])
names(dt)=c("Inicio de parto","p-valor ajustado","RA", "RR", "Extr. inf. de ICRA", "Extr. sup. de ICRA", "Extr. inf. de ICRR", "Extr. sup. de ICRR")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


### Tipo de parto


```{r}
I.In=Casos$Inicio.de.parto
I.In[I.In=="Cesárea"]="Cesárea programada"
I=Casos$Tipo.de.parto
I[I.In=="Cesárea programada"]="Cesárea programada"
I[I=="Cesárea"]="Cesárea urgente"

NI.In=Controls$Inicio.de.parto
NI=Controls$Tipo.de.parto
NI[NI.In=="Cesárea programada"]="Cesárea programada"
NI[NI=="Cesárea"]="Cesárea urgente"

NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])


```

```{r}
EE=rbind(as.vector(table(I))[c(3,4,1,2)],
         as.vector(table(NI))[c(3,4,1,2)])
EEExt=rbind(c(as.vector(table(I))[c(3,4,1,2)],NA_I),
            round(100*c(as.vector(table(I))[c(3,4,1,2)],NA_I)/n_I,1),
            c(as.vector(table(NI))[c(3,4,1,2)],NA_NI),
            round(100*c(as.vector(table(NI))[c(3,4,1,2)],NA_NI)/n_NI,1))
colnames(EEExt)=c("Eutócico", "Instrumental", "Cesárea programada", "Cesárea urgente", "Pérdidas")
rownames(EEExt)=Columnes

t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```




```{r 9,fig.cap="\\s"}
df =data.frame(
  Factor=c( rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Inicios=ordered(c( I,NI ),levels=c("Eutócico", "Instrumental", "Cesárea programada", "Cesárea urgente"))
)

base=ordered(rep(c("Eutócico", "Instrumental", "Cesárea prog.", "Cesárea urg."), each=2),levels=c("Eutócico", "Instrumental", "Cesárea prog.", "Cesárea urg."))
Grupo=rep(c("Infectada","No infectada") , 4)
valor=c(as.vector(prop.table(table(df),margin=1))                 )
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=base, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+  
  ylab("")+
  scale_fill_brewer(palette = "Set3")+
  labs(fill = "Tipo de parto")
```

```{r 10,fig.cap="\\s"}
df =data.frame(
  Factor=c( rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Inicios=ordered(c( I,NI ),levels=c("Eutócico", "Instrumental", "Cesárea programada", "Cesárea urgente"))
)

base=ordered(rep(c("Eutócico", "Instrumental", "Cesárea prog.", "Cesárea urg."), each=2),levels=c("Eutócico", "Instrumental", "Cesárea prog.", "Cesárea urg."))
Grupo=rep(c("Infectada","No infectada") , 4)
valor=as.vector(prop.table(table(df), margin=2))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=Grupo, y=valor, x=base)) + 
  geom_bar(position="dodge", stat="identity")+  
  xlab("Tipos de parto")+
  ylab("")
```




```{r,include=FALSE}
FT=chisq.test(EE)
```

* Distribuciones de los tipos de parto en los grupos de infectadas y no infectadas: test $\chi^2$, p-valor $`r signif(chisq.test(EE)$p.value,1)`$



En la tabla que sigue:

* p-valor ajustado: p-valores de tests de Fisher bilateral ajustados por Bonferroni calculados para la muestra sin pérdidas
* RA y RR: riesgos absoluto y relativo estimados del tipo de parto relativos a la infección
* IC-RA e IC-RR: sus intervalos de confianza del 95% respectivos

```{r}
pp=rep(0,dim(EE)[2])
RA=rep(0,dim(EE)[2])
RR=rep(0,dim(EE)[2])
CIRA1=rep(0,dim(EE)[2])
CIRA2=rep(0,dim(EE)[2])
CIRR1=rep(0,dim(EE)[2])
CIRR2=rep(0,dim(EE)[2])

for (i in 1:dim(EE)[2]){
EE.temp=rbind(c(EE[1,i],sum(EE[1,-i])),
                  c(EE[2,i],sum(EE[2,-i])))
FT=fisher.test(EE.temp)
PT=prop.test(EE.temp[,1],rowSums(EE.temp))
pp[i]=FT$p.value
RA[i]=round(PT$estimate[1]-PT$estimate[2],3)
RR[i]=round(PT$estimate[1]/PT$estimate[2],3)
CIRA1[i]=round(PT$conf.int,4)[1]
CIRA2[i]=round(PT$conf.int,4)[2]
CIRR1[i]=round(RelRisk(EE.temp,conf.level=0.95,method="wald"),3)[2]
CIRR2[i]=round(RelRisk(EE.temp,conf.level=0.95,method="wald"),3)[3]
            }
pp=p.adjust(pp,method="bonferroni")
dt=data.frame(franja=c("Eutócico", "Instrumental", "Cesárea programada", "Cesárea urgente"),pp,RA,RR,CIRA1,CIRA2,CIRR1,CIRR2)
names(dt)=c("Tipo de parto","p-valor ajustado","RA", "RR", "Extr. inf. de ICRA", "Extr. sup. de ICRA", "Extr. inf. de ICRR", "Extr. sup. de ICRR")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


### Prematuridad 



```{r}
I=Casos$PREMATURO
NI=Controls$Preterm.deliveries
Tabla.DMG(I,NI,"No prematuro","Prematuro")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgo de prematuridad en infectadas y no infectadas: test de Fisher bilateral, p-valor $`r signif(FT$p.value,1)`$; 

* RA estimado de prematuridad relativa a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]





### Eventos trombóticos



```{r}
I=Casos$EVENTOS_TROMBO_TOTALES
NI1=Controls$DVT
NI2=Controls$PE
NI=rep(NA,n_NI)
for (i in 1:n_NI){NI[i]=max(NI1[i],NI2[i],na.rm=TRUE)}
Tabla.DMG(I,NI,"No eventos trombóticos","Eventos trombóticos")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgo de evento trombótico en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de evento trombótico relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [$`r round(PT$conf.int,4)`$] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]




### Eventos hemorrágicos




```{r}
I=Casos$EVENTOS_HEMORRAGICOS_TOTAL
NI=Controls$eventos_hemorragicos
Tabla.DMG(I,NI,"No eventos heomorrágicos","Eventos hemorrágicos")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgo de evento hemorrágico en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de evento hemorrágico relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]


### Hemorragias postparto



```{r}
I=Casos$Hemorragia.postparto
I.sino=I
I.sino[!is.na(I.sino)& I.sino!="No"]="Sí"
I=ordered(I,levels=names(table(I))[c(4,2,3,1)])


NI=Controls$Hemorragia.postparto
NI.sino=NI
NI.sino[!is.na(NI.sino)& NI.sino!="No"]="Sí"
NI=ordered(NI,levels=names(table(NI))[c(4,2,3,1)])
Tabla.DMG(I.sino,NI.sino,"No HPP","HPP")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo de hemorragia postparto en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de hemorragia postparto relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],4)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="wald")[2:3],2)`]




```{r}
EE=rbind(as.vector(table(I)),
         as.vector(table(NI)))
EEExt=rbind(c(as.vector(table(I)),NA_I),
            round(100*c(as.vector(table(I)),NA_I)/n_I,1),
            c(as.vector(table(NI)),NA_NI),
            round(100*c(as.vector(table(NI)),NA_NI)/n_NI,1))
colnames(EEExt)=c(names(table(I)), "Pérdidas")
rownames(EEExt)=Columnes

t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```

```{r 11,fig.cap="\\s"}
df =data.frame(
  Factor=c( rep("Infectadas",length(I[I!="No"])), rep("No infectadas",length(NI[NI!="No"]))),
  Hemos=ordered(c( I[I!="No"],NI[NI!="No"] ),levels=names(table(I))[-1])
)

base=ordered(rep(c("Tto. médico", "Tto. Qx conservador", "Histerectomía"), each=2),levels=c("Tto. médico", "Tto. Qx conservador", "Histerectomía"))
Grupo=rep(c("Infectada","No infectada") , 3)
valor=as.vector(prop.table(table(df), margin=1))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=Grupo, y=valor, x=base)) + 
  geom_bar(position="dodge", stat="identity")+  
  xlab("Tratamientos de hemorragia postparto")+
  ylab("")
```



```{r,include=FALSE}
FT1=chisq.test(EE,simulate.p.value=TRUE,B=10000)
I=Casos$Hemorragia.postparto
I=I[I!="No"]
I=I[!is.na(I)]
NI=Controls$Hemorragia.postparto
NI=NI[NI!="No"]
NI=NI[!is.na(NI)]
EE=rbind(as.vector(table(I)),
         as.vector(table(NI)))
FT2=chisq.test(EE,simulate.p.value=TRUE,B=10000)
```

* Distribuciones de los tipos de hemorragia postparto (incluyendo Noes) en los grupos de infectadas y no infectadas: test $\chi^2$ de Montercarlo, p-valor `r round(FT1$p.value,2)`

* Distribuciones de los tipos de hemorragia postparto en los grupos de infectadas y no infectadas que tuvieron hemorragia postparto:  test $\chi^2$ de Montercarlo, p-valor `r round(FT2$p.value,2)`







## Neonatos



### Fetos muertos anteparto 



```{r}
I1=Casos$Feto.muerto.intraútero
I1[I1=="Sí"]="Muerto"
I1[I1=="No"]="Vivo"
I2=CasosGM$Feto.vivo
I2[I2=="Sí"]="Vivo"
I2[I2=="No"]="Muerto"
I=c(I1,I2)

n_IFT=length(I)
n_VI=as.vector(table(I))[2]
```


```{r}
NI1=Controls$Feto.vivo...194
NI2=ControlsGM$Feto.vivo...245
NI=c(NI1,NI2)
NI[NI=="Sí"]="Vivo"
NI[NI=="No"]="Muerto"
n_NIFT=length(NI)
n_VNI=as.vector(table(NI))[2]
```


```{r}
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
EE=rbind(as.vector(table(I)),
         as.vector(table(NI)))
EEExt=rbind(c(as.vector(table(I)),NA_I,n_IFT),
            round(100*c(as.vector(table(I)),NA_I,n_IFT)/n_IFT,1),
            c(as.vector(table(NI)),NA_NI,n_NIFT),
            round(100*c(as.vector(table(NI)),NA_NI,n_NIFT)/n_NIFT,1))
rownames(EEExt)=Columnes

colnames(EEExt)=c("Feto muerto anteparto", "Feto vivo","Pérdidas", "Total Fetos")


t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r,include=FALSE}
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo de muerte anteparto en fetos de infectadas y de no infectadas: test de Fisher bilateral, p-valor $`r signif(FT$p.value,1)`$; 

* RA estimado de muerte anteparto relativo a infección de madre: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]




### Peso de neonatos al nacimiento




```{r}
I=c(Casos[Casos$Feto.muerto.intraútero=="No",]$Peso._gramos_...125,CasosGM[CasosGM$Feto.vivo=="Sí",]$Peso._gramos_...148)
NI=c(Controls[Controls$Feto.vivo...194=="Sí",]$Peso._gramos_...198,ControlsGM[ControlsGM$Feto.vivo...245=="Sí",]$Peso._gramos_...247)
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
```

```{r 12,fig.cap="\\s"}
data =data.frame(
  name=c(rep("Hijos de infectadas",length(I)), rep("Hijos de no infectadas",length(NI))),
  Pesos=c(I,NI)
  )

sample_size = data %>% group_by(name) %>% summarize(num=n())

data %>%
 left_join(sample_size) %>%
  mutate(myaxis = paste0(name, "\n", "n=", num)) %>%
  ggplot( aes(x=myaxis, y=Pesos, fill=name)) +
    geom_violin(width=0.9) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    theme(
      legend.position="none",
      plot.title = element_text(size=11)
    ) +
    xlab("")+
  ylab("Pesos (gramos)")
```



```{r}
Dades=rbind(c(min(I,na.rm=TRUE),max(I,na.rm=TRUE), round(mean(I,na.rm=TRUE),1),round(median(I,na.rm=TRUE),1),round(quantile(I,c(0.25,0.75),na.rm=TRUE),1), round(sd(I,na.rm=TRUE),1)),
            c(min(NI,na.rm=TRUE),max(NI,na.rm=TRUE), round(mean(NI,na.rm=TRUE),1),round(median(NI,na.rm=TRUE),1),round(quantile(NI,c(0.25,0.75),na.rm=TRUE),1),round(sd(NI,na.rm=TRUE),1)))

colnames(Dades)=c("Peso mínimo","Peso máximo","Peso medio", "Peso mediano", "1er cuartil", "3er cuartil", "Desv. típica")
rownames(Dades)=c("Infectadas", "No infectadas")

Dades %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")


```



```{r,include=FALSE}
shapiro.test(I)$p.value
shapiro.test(NI)$p.value
fligner.test(list(I,NI))
ttest=t.test(I,NI)
```

* Ajuste de los pesos de hijos de infectadas y no infectadas a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I)$p.value,1)`$ y $`r 
signif(shapiro.test(NI)$p.value,1)`$, respectivamente

* Pesos medios: test t, p-valor `r round(ttest$p.value,4)`, IC del 95% para la diferencia de medias [`r round(ttest$conf.int,2)`] 

* Desviaciones típicas: test de Fligner-Killeen, p-valor  `r round(fligner.test(list(I,NI))$p.value,4)`

Definimos **bajo peso** a peso menor o igual a 2500 g. Un `r round(100*length(c(I,NI)[!is.na(c(I,NI)) & c(I,NI)<2500])/length(c(I,NI)[!is.na(c(I,NI))]),2)`% del total de neonatos no muesrtos anteparto son  de bajo peso con esta definición.



```{r}
I=I[!is.na(I)]
NI=NI[!is.na(NI)]
I.cut=cut(I,breaks=c(0,2500,10000),labels=c(1,0),right=FALSE)
NI.cut=cut(NI,breaks=c(0,2500,10000),labels=c(1,0),right=FALSE)


EE=rbind(as.vector(table(I.cut)),
         as.vector(table(NI.cut)))
EEExt=rbind(c(as.vector(table(I.cut)),NA_I),
            round(100*c(as.vector(table(I.cut)),NA_I)/length(I),1),
            c(as.vector(table(NI.cut)),NA_NI),
            round(100*c(as.vector(table(NI.cut)),NA_NI)/length(NI),1))
rownames(EEExt)=Columnes

colnames(EEExt)=c("Bajo peso", "No bajo peso","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



```{r,include=FALSE}
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo de bajo peso en hijos de madres infectadas y  no infectadas: test de Fisher bilateral, p-valor $`r signif(FT$p.value,1)`$; 

* RA estimado de bajo peso relativo a infección de madre: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]









###  Apgar


```{r}
I=c(Casos$APGAR.5...126,CasosGM$APGAR.5...150)
I[I==19]=NA
NI=c(Controls$APGAR.5...200,ControlsGM$APGAR.5...249)
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])

I.5=cut(I,breaks=c(-1,7,20),labels=c("0-7","8-10"))
NI.5=cut(NI,breaks=c(-1,7,20),labels=c("0-7","8-10"))
EE=rbind(as.vector(table(I.5)),
         as.vector(table(NI.5)))
EEExt=rbind(c(as.vector(table(I.5)),NA_I),
            round(100*c(as.vector(table(I.5)),NA_I)/length(I),1),
            c(as.vector(table(NI.5)),NA_NI),
            round(100*c(as.vector(table(NI.5)),NA_NI)/length(NI),1))
rownames(EEExt)=Columnes

colnames(EEExt)=c("Apgar.5≤7", "Apgar.5≥8","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



```{r,include=FALSE}
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo de Apgar.5≤7  en hijos de madres infectadas y  no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,3)`; 

* RA estimado de Apgar.5≤7  relativo a infección de madre: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]





### Ingreso de neonatos vivos en UCIN

```{r}
I=c(Casos[Casos$Feto.muerto.intraútero=="No",]$Ingreso.en.UCIN,CasosGM[CasosGM$Feto.vivo=="Sí",]$Ingreso.en.UCI)
NI=c(Controls[Controls$Feto.vivo...194=="Sí",]$Ingreso.en.UCI...213,ControlsGM[ControlsGM$Feto.vivo...245=="Sí",]$Ingreso.en.UCI...260)
n_IU=length(I)
n_NIU=length(NI)
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])


```


```{r}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
EEExt=rbind(c(as.vector(table(I))[2:1],NA_I),
            round(100*c(as.vector(table(I))[2:1],NA_I)/n_IU,1),
            c(as.vector(table(NI))[2:1],NA_NI),
            round(100*c(as.vector(table(NI))[2:1],NA_NI)/n_NIU,1))
rownames(EEExt)=Columnes

colnames(EEExt)=c("UCIN", "No UCIN ","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



```{r,include=FALSE}
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo de ingreso en UCIN  en hijos de madres infectadas y  no infectadas: test de Fisher bilateral, p-valor $`r signif(FT$p.value,1)`$; 

* RA estimado de ingreso en UCIN relativo a infección de madre: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]

## Descripción de casos por sintomatología



### Trimestre de infección

```{r}
Trim=Casos$Trim.Diag
NA_T=length(Trim[is.na(Trim)])
NA_S=length(Sint[is.na(Sint)])

DF=data.frame(Trimestre=Trim,Síntomas=Sint)
taula=table(DF)[,1:3]
proptaula=round(100*prop.table(table(DF)),2)[,1:3]

EEExt=cbind(c(as.vector(taula[,1]),sum(taula[,1])),
            c(as.vector(proptaula[,1]), round(100*sum(taula[,1])/n_I,2)),
            c(as.vector(taula[,2]),sum(taula[,2])),
            c(as.vector(proptaula[,2]), round(100*sum(taula[,2])/n_I,2)),
            c(as.vector(taula[,3]),sum(taula[,3])),
            c(as.vector(proptaula[,3]), round(100*sum(taula[,3])/n_I,2))
            )
rownames(EEExt)=c("1er trimestre", "2o trimestre", "3er trimestre","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



```{r 13,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Síntomas leves", "Neumonía"), each=3),levels=c("Asintomática", "Síntomas leves", "Neumonía"))
Grupo=rep(c("1er trimestre", "2o trimestre", "3er trimestre") , 3)
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  xlab("Trimestre de infección")+
  ylab("")+
  scale_fill_brewer(palette = "Dark2") 
```



### Sintomatología vs edad



```{r}
I=Casos$Edad._años_
DF=data.frame(Edad=I,Sint=Casos$SINTOMAS_DIAGNOSTICO)



DF %>%
  ggplot( aes(x=Sint, y=Edad, fill=Sint)) +
    geom_violin(width=1) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    theme(
      legend.position="none",
      plot.title=element_text(size=11)
    ) +
    xlab("")+
  ylab("Edades (años)")+
 scale_fill_brewer(palette="Dark2")
```

```{r}
I1=I[Casos$SINTOMAS_DIAGNOSTICO=="Asintomática"]
I2=I[Casos$SINTOMAS_DIAGNOSTICO=="Síntomas leves"]
I3=I[Casos$SINTOMAS_DIAGNOSTICO=="Neumonía"]

Dades=rbind(c(round(min(I1,na.rm=TRUE),1),round(max(I1,na.rm=TRUE),1), round(mean(I1,na.rm=TRUE),1),round(median(I1,na.rm=TRUE),1),round(quantile(I1,c(0.25,0.75),na.rm=TRUE),1), round(sd(I1,na.rm=TRUE),1)),
            c(round(min(I2,na.rm=TRUE),1),round(max(I2,na.rm=TRUE),1), round(mean(I2,na.rm=TRUE),1),round(median(I2,na.rm=TRUE),1),round(quantile(I2,c(0.25,0.75),na.rm=TRUE),1), round(sd(I2,na.rm=TRUE),1)),
            c(round(min(I3,na.rm=TRUE),1),round(max(I3,na.rm=TRUE),1), round(mean(I3,na.rm=TRUE),1),round(median(I3,na.rm=TRUE),1),round(quantile(I3,c(0.25,0.75),na.rm=TRUE),1), round(sd(I3,na.rm=TRUE),1)))

colnames(Dades)=c("Edad mínima","Edad máxima","Edad  media", "Edad  mediana", "1er cuartil", "3er cuartil", "Desv. típica")
rownames(Dades)=c("Asintomáticas", "Síntomas leves","Neumonías")

Dades %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")


```


```{r,include=FALSE}

shapiro.test(I1)$p.value
shapiro.test(I2)$p.value
shapiro.test(I3)$p.value

kruskal.test(Edad~Sint,data=DF)$p.value

pairwise.wilcox.test(I,Sint,p.adjust.method = "bonferroni")$p.value
```

* Ajuste de las edades maternas a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I1)$p.value,1)`$, $`r 
signif(shapiro.test(I2)$p.value,1)`$ y `r 
round(shapiro.test(I3)$p.value,4)`, respectivamente




* Edades medias: test de Kruskal-Wallis, p-valor `r kruskal.test(Edad~Sint,data=DF)$p.value`


* Desviaciones típicas: test de Fligner-Killeen, p-valor  `r round(fligner.test(list(I,I2,I3))$p.value,3)`

* Contrastes post hoc por parejas

```{r}
Contraste=c("Asíntomatica vs Síntomas leves","Asíntomatica vs Neumonía", "Síntomas leves vs Neumonía")

pvals=round(3*c(t.test(I1,I2,var.equal=TRUE)$p.value, t.test(I1,I3,var.equal=TRUE)$p.value,
            t.test(I2,I3,var.equal=TRUE)$p.value),4)
dades=data.frame(Contraste=Contraste,"p-valor"=pvals)
dades %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")

```



```{r}
I.cut=cut(I,breaks=c(0,30,40,100),labels=c("18-30","31-40",">40"))
DF=data.frame(Edad=I.cut,Síntomas=Sint)

taula=table(DF)[,1:3]
proptaula=round(100*prop.table(taula,margin=2),2)
EEExt=cbind(
            c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1])))/n_AS,2),
            c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2])))/n_SL,2),
             c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3])))/n_NE,2)
           )
EEExt=rbind(EEExt,c(n_AS,100,n_SL,100,n_NE,100))

rownames(EEExt)=c("18-30", "31-40", ">40","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint
EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r 14,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Síntomas leves", "Neumonía"), each=3),levels=c("Asintomática", "Síntomas leves", "Neumonía"))
Grupo=ordered(rep(c("18-30","31-40",">40") , 3),levels=c("18-30","31-40",">40"))
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  xlab("Edad")+
  ylab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y las franjas de edad: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`

* Tabla de p-valores  ajustados por Bonferroni de tests de diferencia en la tendencia de la gravedad en cada franja de edad respecto del global: 


```{r}
EE=taula
ppTR=rep(0,dim(EE)[1])
for (i in 1:dim(EE)[1]){
ppTR[i]=prop.trend.test(EE[i,],colSums(EE),score=prop.table(table(Sint)))$p.value
}
ppTR=p.adjust(ppTR,method="bonferroni")
dt=data.frame(franja=c("18-30","31-40",">40"),ppTR)
names(dt)=c("Franja","p-valor trend test (ajustado)")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



### Sintomatología vs etnia 





```{r}
I=Casos$Etnia

DF=data.frame(Etnia=I,Síntomas=Sint)
taula=table(DF)[c(1,2,3,4,5),1:3]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1])))/n_AS,2),
            c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2])))/n_SL,2),
             c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3])))/n_NE,2)
           )
EEExt=rbind(EEExt,c(n_AS,100,n_SL,100,n_NE,100))
rownames(EEExt)=c("Árabe", "Asia", "Blanca", "Latinoamericana","Negra","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r 15,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Síntomas leves", "Neumonía"), each=5),levels=c("Asintomática", "Síntomas leves", "Neumonía"))
Grupo=ordered(rep(c("Árabe", "Asia", "Blanca", "Latinoamericana","Negra") , 3),levels=c("Árabe", "Asia", "Blanca", "Latinoamericana","Negra"))
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  xlab("Etnia")+
  ylab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y las etnias: test $\chi^2$, p-valor $`r signif(chisq.test(taula)$p.value,1)`$

* Tabla de p-valores  ajustados por Bonferroni de tests de diferencia en la tendencia de la gravedad en cada franja de edad respecto del global: 


```{r}
EE=taula
ppTR=rep(0,dim(EE)[1])
for (i in 1:dim(EE)[1]){
ppTR[i]=prop.trend.test(EE[i,],colSums(EE),score=prop.table(table(Sint)))$p.value
}
ppTR=p.adjust(ppTR,method="bonferroni")
dt=data.frame(franja=c("Árabe", "Asia", "Blanca", "Latinoamericana","Negra"),ppTR)
names(dt)=c("Etnia", "p-valor trend test (ajustado)")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```






### Sintomatología vs estatus de fumadora


```{r 16,fig.cap="\\s"}
taula=table(data.frame(Casos$FUMADORA_CAT,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$FUMADORA_CAT,"Fumadoras", "No fumadoras")
Barplot.DGS(Casos$FUMADORA_CAT,"Fumadoras", "No fumadoras")
```




* Asociación entre los grupos de sintomatología y el hábito tabáquico: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,4)`



### Sintomatología vs obesidad



```{r 17,fig.cap="\\s"}
taula=table(data.frame(Casos$Obesidad,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$Obesidad,"Obesas", "No obesas")
Barplot.DGS(Casos$Obesidad,"Obesas", "No obesas")
```




* Asociación entre los grupos de sintomatología y la obesidad: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,4)`



### Sintomatología vs hipertensión pregestacional



```{r 18,fig.cap="\\s"}
taula=table(data.frame(Casos$Hipertensión.pregestacional,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$Hipertensión.pregestacional,"HTA", "No HTA")
Barplot.DGS(Casos$Hipertensión.pregestacional,"HTA", "No HTA")
```


* Asociación entre los grupos de sintomatología y la HTA: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,4)`

### Sintomatología vs diabetes



```{r 19,fig.cap="\\s"}
taula=table(data.frame(Casos$DIABETES,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$DIABETES,"DM", "No DM")
Barplot.DGS(Casos$DIABETES,"DM", "No DM")
```




* Asociación entre los grupos de sintomatología y la diabetes: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,4)`

### Sintomatología vs cardiopatía



```{r 20,fig.cap="\\s"}
taula=table(data.frame(Casos$Enfermedad.cardiaca.crónica,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$Enfermedad.cardiaca.crónica,"ECC", "No ECC")
Barplot.DGS(Casos$Enfermedad.cardiaca.crónica,"ECC", "No ECC")
```



* Asociación entre los grupos de sintomatología y  ECC: test $\chi^2$ de Montecarlo, p-valor `r round(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,4)`


### Sintomatología vs enfermedad pulmonar crónica 



```{r 21,fig.cap="\\s"}
INA=Casos$Enfermedad.pulmonar.crónica.no.asma
IA=Casos$Diagnóstico.clínico.de.Asma
I.EPC=rep(NA,length(Sint))
for (i in 1:length(Sint)){I.EPC[i]=max(INA[i],IA[i],na.rm=TRUE)}
taula=table(data.frame(I.EPC,Sint))[c(2,1) ,1:3]
Tabla.DGS(I.EPC,"EPC", "No EPC")
Barplot.DGS(I.EPC,"EPC", "No EPC")
```



* Asociación entre los grupos de sintomatología y EPC: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,4)`


### Sintomatologia vs gestación múltiple



```{r 22,fig.cap="\\s"}
taula=table(data.frame(Casos$Gestación.Múltiple,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$Gestación.Múltiple,"Gestación múltiple", "Gestación única")
Barplot.DGS(Casos$Gestación.Múltiple,"Gestación múltiple", "Gestación única")
```


* Asociación entre los grupos de sintomatología y gestación múltiple: test $\chi^2$ , p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,4)`


### Sintomatologia vs paridad



```{r 23,fig.cap="\\s"}
taula=table(data.frame(Casos$NULIPARA,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$NULIPARA,"Multípara", "Nulípara")
Barplot.DGS(Casos$NULIPARA,"Multípara", "Nulípara")
```



* Asociación entre los grupos de sintomatología y paridad: test $\chi^2$ , p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,4)`


### Sintomatología vs anomalía congénita





```{r 24 ,fig.cap="\\s"}
taula=table(data.frame(Casos$Diagnóstico.de.malformación.ecográfica._.semana.20._,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$Diagnóstico.de.malformación.ecográfica._.semana.20._,"Anomalías congénitas", "No anomalías congénitas")
Barplot.DGS(Casos$Diagnóstico.de.malformación.ecográfica._.semana.20._,"Anomalías congénitas", "No anomalías congénitas")
```



* Asociación entre los grupos de sintomatología y anomalía congénita: test $\chi^2$ de Montecarlo, p-valor `r round(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,4)`

### Sintomatología vs retraso del crecimiento intrauterino 





```{r 25,fig.cap="\\s"}
taula=table(data.frame(Casos$Defecto.del.crecimiento.fetal..en.tercer.trimestre._.CIR._.,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$Defecto.del.crecimiento.fetal..en.tercer.trimestre._.CIR._.,"RCIU", "No RCIU")
Barplot.DGS(Casos$Defecto.del.crecimiento.fetal..en.tercer.trimestre._.CIR._.,"RCIU", "No RCIU")
```




* Asociación entre los grupos de sintomatología y retraso del crecimiento intrauterino : test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,4)`

### Sintomatología vs diabetes gestacional 




```{r 26,fig.cap="\\s"}
taula=table(data.frame(Casos$Diabetes.gestacional,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$Diabetes.gestacional,"DG", "No DG")
Barplot.DGS(Casos$Diabetes.gestacional,"DG", "No DG")
```




* Asociación entre los grupos de sintomatología y diabetes gestacional: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,4)`

### Sintomatología vs hipertensión gestacional



```{r 27,fig.cap="\\s"}
taula=table(data.frame(Casos$Hipertensión.gestacional,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$Hipertensión.gestacional,"HG", "No HG")
Barplot.DGS(Casos$Hipertensión.gestacional,"HG", "No HG")
```




* Asociación entre los grupos de sintomatología e hipertensión gestacional: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,4)`

### Sintomatología vs rotura prematura de membranas


```{r 28,fig.cap="\\s"}
taula=table(data.frame(Casos$Bolsa.rota.anteparto,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$Bolsa.rota.anteparto,"RPM", "No RPM")
Barplot.DGS(Casos$Bolsa.rota.anteparto,"RPM", "No RPM")
```




* Asociación entre los grupos de sintomatología y rotura prematura de membranas: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,4)`


### Sintomatología vs preeclampsia




```{r 29,fig.cap="\\s"}
taula=table(data.frame(Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL,Sint))[c(2,1) ,1:3]

Tabla.DGS(Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL,"PE", "No PE")
Barplot.DGS(Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL,"PE", "No PE")
```






* Asociación entre los grupos de sintomatología y preeclampsia: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,4)`


### Sintomatología vs preeclampsia con criterios de gravedad




```{r}
n_PI=sum(Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL)
I=Casos[Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL==1,]$Preeclampsia.grave_HELLP_ECLAMPSIA
DF=data.frame(Factor=I,Síntomas=Sint[Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL==1])

taula=table(DF)[c(2,1),1:3]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1])))/n_AS,2),
            c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2])))/n_SL,2),
             c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3])))/n_NE,2)
           )
EEExt=rbind(EEExt,c(n_AS,100,n_SL,100,n_NE,100))

rownames(EEExt)=c("PE con CG", "PE sin CG","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r 30,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Síntomas leves", "Neumonía"), each=2),levels=c("Asintomática", "Síntomas leves", "Neumonía"))
Grupo=ordered(rep(rownames(EEExt)[1:2] , 3),levels=rownames(EEExt)[1:2])
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y preeclampsia con CG en preeclampsia: test $\chi^2$, p-valor `r round(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,3)`

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint[Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL==1])))$p.value,4)`



### Sintomatología vs eventos hemorrágicos




```{r 31,fig.cap="\\s"}
taula=table(data.frame(Casos$EVENTOS_HEMORRAGICOS_TOTAL,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$EVENTOS_HEMORRAGICOS_TOTAL,"Eventos hemorrágicos", "No eventos hemorrágicos")
Barplot.DGS(Casos$EVENTOS_HEMORRAGICOS_TOTAL,"Eventos hemorrágicos", "No eventos hemorrágicos")
```




* Asociación entre los grupos de sintomatología y evento hemorrágico: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,4)`


### Sintomatología vs hemorragia postparto



```{r 59,fig.cap="\\s"}
I=Casos$Hemorragia.postparto
I.sino=I
I.sino[!is.na(I.sino)& I.sino!="No"]="Sí"
taula=table(data.frame(I.sino,Sint))[c(2,1) ,1:3]

Tabla.DGS(I.sino,"HPP", "No HPP")
Barplot.DGS(I.sino,"HPP", "No HPP")
```






* Asociación entre los grupos de sintomatología y evento hemorrágico: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,4)`





```{r}
I=Casos$Hemorragia.postparto
DF=data.frame(Factor=I,Síntomas=Sint)
taula=table(DF)[c(1,2,3,4) ,1:3]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1])))/n_AS,2),
            c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2])))/n_SL,2),
             c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3])))/n_NE,2)
           )
EEExt=rbind(EEExt,c(n_AS,100,n_SL,100,n_NE,100))

rownames(EEExt)=c("Histerectomía",       "Tto. médico",
  "Tto. Qx. conservador" , "No HPP","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r 32,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Síntomas leves", "Neumonía"), each=4),levels=c("Asintomática", "Síntomas leves", "Neumonía"))
Grupo=ordered(rep(rownames(EEExt)[1:4] , 3),levels=rownames(EEExt)[1:4])
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y el tipo de hemorragia postparto: test $\chi^2$ de Montecarlo, p-valor `r  round(chisq.test(taula[1:3,],simulate.p.value=TRUE,B=10000)$p.value,3)`




### Sintomatología vs eventos trombóticos




```{r 33,fig.cap="\\s"}
taula=table(data.frame(Casos$EVENTOS_TROMBO_TOTALES,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$EVENTOS_TROMBO_TOTALES,"Eventos trombóticos", "No eventos trombóticos")
Barplot.DGS(Casos$EVENTOS_TROMBO_TOTALES,"Eventos trombóticos", "No eventos trombóticos")
```



* Asociación entre los grupos de sintomatología y evento trombótico: test $\chi^2$ de Montecarlo, p-valor $`r signif(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,1)`$



* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor $`r signif(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,1)`$

### Sintomatología vs UCi madre (Sí-No)


```{r 34,fig.cap="\\s"}
taula=table(data.frame(Casos$UCI,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$UCI,"UCI", "No UCI")
Barplot.DGS(Casos$UCI,"UCI", "No UCI")
```





* Asociación entre los grupos de sintomatología e ingreso en UCI de la madre: test $\chi^2$ de Montecarlo, p-valor $`r signif(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,1)`$



* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor $`r signif(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,1)`$


### Sintomatología vs UCi madre (antes-después)


```{r}
UCI.I=sum(Casos$UCI,na.rm=TRUE)
I=Casos$UCI_ANTES.DESPUES.DEL.PARTO
DF=data.frame(Factor=I,Síntomas=Sint)
taula=table(DF)[c(2,1),1:3]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1])))/n_AS,2),
            c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2])))/n_SL,2),
             c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3])))/n_NE,2)
           )
EEExt=rbind(EEExt,c(n_AS,100,n_SL,100,n_NE,100))

rownames(EEExt)=c("UCI antes del parto", "UCI después del parto","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r 35,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Síntomas leves", "Neumonía"), each=2),levels=c("Asintomática", "Síntomas leves", "Neumonía"))
Grupo=ordered(rep(rownames(EEExt)[1:2] , 3),levels=rownames(EEExt)[1:2])
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y el momento de ingreso en UCI:  test $\chi^2$ de Montecarlo, p-valor `r round(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,3)`



* Test de diferencia en la tendencia de la gravedad respecto del global de UCI: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint[Casos$UCI==1])))$p.value,4)`


### Sintomatología vs prematuridad



```{r 36,fig.cap="\\s"}
taula=table(data.frame(Casos$PREMATURO,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$PREMATURO,"Prematuro", "A término")
Barplot.DGS(Casos$PREMATURO,"Prematuro", "A término")
```





* Asociación entre los grupos de sintomatología y prematures:  test $\chi^2$, p-valor $`r signif(chisq.test(taula)$p.value,1)`$


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor $`r signif(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,1)`$


### Sintomatología vs APGAR


```{r}
I=c(Casos$APGAR.5...126,CasosGM$APGAR.5...150)
I[I==19]=NA
I=cut(I,breaks=c(-1,7,20),labels=c("0-7","8-10"))

SintN=c(Casos$SINTOMAS_DIAGNOSTICO,CasosGM$SINTOMAS_DIAGNOSTICO)

F_AS=table(SintN)[1]
F_SL=table(SintN)[2]
F_NE=table(SintN)[3]

DF=data.frame(Factor=I,Síntomas=SintN)
taula=table(DF)
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),F_AS-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),F_AS-sum(as.vector(taula[,1])))/F_AS,2),
            c(as.vector(taula[,2]),F_SL-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),F_SL-sum(as.vector(taula[,2])))/F_SL,2),
             c(as.vector(taula[,3]),F_NE-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),F_NE-sum(as.vector(taula[,3])))/F_NE,2)
           )
EEExt=rbind(EEExt,c(F_AS,100,F_SL,100,F_NE,100))

rownames(EEExt)=c("Apgar.5≤7", "Apgar.5≥8 ","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r 37,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Síntomas leves", "Neumonía"), each=2),levels=c("Asintomática", "Síntomas leves", "Neumonía"))
Grupo=ordered(rep(rownames(EEExt)[1:2] , 3),levels=rownames(EEExt)[1:2])
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y APGAR bajo: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,4)`


### Sintomatología vs UCI neonato



```{r}
I=c(Casos[Casos$Feto.muerto.intraútero=="No",]$Ingreso.en.UCIN,CasosGM[CasosGM$Feto.vivo=="Sí",]$Ingreso.en.UCI)
SintN=c(Casos[Casos$Feto.muerto.intraútero=="No",]$SINTOMAS_DIAGNOSTICO,CasosGM[CasosGM$Feto.vivo=="Sí",]$SINTOMAS_DIAGNOSTICO)

DF=data.frame(Factor=I,Síntomas=SintN)
taula=table(DF)[c(2,1),c(1,2,3)]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),F_AS-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),F_AS-sum(as.vector(taula[,1])))/F_AS,2),
            c(as.vector(taula[,2]),F_SL-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),F_SL-sum(as.vector(taula[,2])))/F_SL,2),
             c(as.vector(taula[,3]),F_NE-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),F_NE-sum(as.vector(taula[,3])))/F_NE,2)
           )
EEExt=rbind(EEExt,c(F_AS,100,F_SL,100,F_NE,100))

rownames(EEExt)=c("UCIN", "No UCIN","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



```{r 38,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Síntomas leves", "Neumonía"), each=2),levels=c("Asintomática", "Síntomas leves", "Neumonía"))
Grupo=ordered(rep(rownames(EEExt)[1:2] , 3),levels=rownames(EEExt)[1:2])
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y ingreso en UCIN: test $\chi^2$, p-valor $`r signif(chisq.test(taula)$p.value,1)`$


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor $`r signif(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,1)`$



### Sintomatología vs Fetos muertos anteparto 



```{r}
I1=Casos$Feto.muerto.intraútero
I1[I1=="Sí"]="Muerto"
I1[I1=="No"]="Vivo"
I2=CasosGM$Feto.vivo
I2[I2=="Sí"]="Vivo"
I2[I2=="No"]="Muerto"
I=c(I1,I2)
SintN1=Casos$SINTOMAS_DIAGNOSTICO
SintN2=CasosGM$SINTOMAS_DIAGNOSTICO
SintN=c(SintN1,SintN2)

DF=data.frame(Factor=I,Síntomas=SintN)
taula=table(DF)[c(1,2),c(1,2,3)]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),table(SintN)[1]-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),table(SintN)[1]-sum(as.vector(taula[,1])))/table(SintN)[1],2),
            c(as.vector(taula[,2]),table(SintN)[2]-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),table(SintN)[2]-sum(as.vector(taula[,2])))/table(SintN)[2],2),
             c(as.vector(taula[,3]),table(SintN)[3]-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),table(SintN)[3]-sum(as.vector(taula[,3])))/table(SintN)[3],2)
           )
EEExt=rbind(EEExt,c(table(SintN)[1],100,table(SintN)[2],100,table(SintN)[3],100))

rownames(EEExt)=c("Feto muerto anteparto", "Feto vivo","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling()
```



```{r 45,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Síntomas leves", "Neumonía"), each=2),levels=c("Asintomática", "Síntomas leves", "Neumonía"))
Grupo=ordered(rep(rownames(EEExt)[1:2] , 3),levels=rownames(EEExt)[1:2])
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y muerte antepartio: test $\chi^2$ de Montecarlo, p-valor `r round(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,4)`

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,4)`





### Sintomatología vs inicio de parto



```{r}
I=Casos$Inicio.de.parto
DF=data.frame(Factor=I,Síntomas=Sint)
taula=table(DF)[c(2,3,1),1:3]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1])))/n_AS,2),
            c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2])))/n_SL,2),
             c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3])))/n_NE,2)
           )
EEExt=rbind(EEExt,c(n_AS,100,n_SL,100,n_NE,100))

rownames(EEExt)=c("Espontáneo", "Inducido","Cesárea programada","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r 39,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Síntomas leves", "Neumonía"), each=3),levels=c("Asintomática", "Síntomas leves", "Neumonía"))
Grupo=ordered(rep(rownames(EEExt)[1:3] , 3),levels=rownames(EEExt)[1:3])
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("Inicio de parto")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y el inicio de parto: test $\chi^2$, p-valor $`r signif(chisq.test(taula)$p.value,1)`$

* Tabla de p-valores  ajustados por Bonferroni de  tests de diferencia en la tendencia de la gravedad en cada franja de edad respecto del global: 


```{r}
EE=taula
ppTR=rep(0,dim(EE)[1])
for (i in 1:dim(EE)[1]){
ppTR[i]=prop.trend.test(EE[i,],colSums(EE),score=prop.table(table(Sint)))$p.value
}
ppTR=p.adjust(ppTR,method="bonferroni")
dt=data.frame(franja=c("Espontáneo", "Inducido","Cesárea programada"),ppTR)
names(dt)=c("Inicio de parto","p-valor trend test (ajustado)")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```




### Sintomatología vs tipo de parto



```{r}
I.In=Casos$Inicio.de.parto
I.In[I.In=="Cesárea"]="Cesárea programada"
I=Casos$Tipo.de.parto
I[I.In=="Cesárea programada"]="Cesárea programada"
I[I=="Cesárea"]="Cesárea urgente"

DF=data.frame(Factor=I,Síntomas=Sint)
taula=table(DF)[c(3,4,1,2),1:3]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1])))/n_AS,2),
            c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2])))/n_SL,2),
             c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3])))/n_NE,2)
           )
EEExt=rbind(EEExt,c(n_AS,100,n_SL,100,n_NE,100))

rownames(EEExt)=c("Eutócico", "Instrumental", "Cesárea programada", "Cesárea urgente","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



```{r 40,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Síntomas leves", "Neumonía"), each=4),levels=c("Asintomática", "Síntomas leves", "Neumonía"))
Grupo=ordered(rep(rownames(EEExt)[1:4] , 3),levels=rownames(EEExt)[1:4])
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("Tipo de parto")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y tipos de parto: test $\chi^2$, p-valor $`r signif(chisq.test(taula)$p.value,1)`$

* Tabla de p-valores  ajustados por Bonferroni de tests de diferencia en la tendencia de la gravedad en cada franja de edad respecto del global: 


```{r}
EE=taula
ppTR=rep(0,dim(EE)[1])
for (i in 1:dim(EE)[1]){
ppTR[i]=prop.trend.test(EE[i,],colSums(EE),score=prop.table(table(Sint)))$p.value
}
ppTR=p.adjust(ppTR,method="bonferroni")
dt=data.frame(franja=c("Eutócico", "Instrumental", "Cesárea programada", "Cesárea urgente"),ppTR)
names(dt)=c("Tipo de parto", "p-valor trend test (ajustado)")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


### Edades gestacionales




```{r 41,fig.cap="\\s"}
I=Casos$EG_TOTAL_PARTO
Síntomas=ordered(Sint,levels=c("Asintomática" ,"Síntomas leves",      "Neumonía"  ))
data =data.frame(
  Síntomas,
  Edades=I
)

data %>%
  ggplot( aes(x=Síntomas, y=Edades, fill=Síntomas)) +
    geom_violin(width=1) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    theme(
      legend.position="none",
      plot.title = element_text(size=11)
    ) +
    xlab("")+
   ylab("Edades gestacionales (semanas)")+
  scale_fill_brewer(palette = "Dark2") 

```


```{r}
Dades=rbind(c(round(min(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1),round(max(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1), round(mean(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1),
              round(median(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1),
              round(quantile(I[data$Síntomas=="Asintomática"],c(0.25,0.75),na.rm=TRUE),1),
              round(sd(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1)),
   c(round(min(I[data$Síntomas=="Síntomas leves"],na.rm=TRUE),1),round(max(I[data$Síntomas=="Síntomas leves"],na.rm=TRUE),1), round(mean(I[data$Síntomas=="Síntomas leves"],na.rm=TRUE),1),
       round(median(I[data$Síntomas=="Síntomas leves"],na.rm=TRUE),1),
              round(quantile(I[data$Síntomas=="Síntomas leves"],c(0.25,0.75),na.rm=TRUE),1),round(sd(I[data$Síntomas=="Síntomas leves"],na.rm=TRUE),1)),         
  c(round(min(I[data$Síntomas=="Neumonía"],na.rm=TRUE),1),round(max(I[data$Síntomas=="Neumonía"],na.rm=TRUE),1), round(mean(I[data$Síntomas=="Neumonía"],na.rm=TRUE),1),round(median(I[data$Síntomas=="Neumonía"],na.rm=TRUE),1),
              round(quantile(I[data$Síntomas=="Neumonía"],c(0.25,0.75),na.rm=TRUE),1),round(sd(I[data$Síntomas=="Neumonía"],na.rm=TRUE),1))          )

colnames(Dades)=c("Edad gest. mínima","Edad gest.  máxima","Edad gest.  media",
                  "Edad gest. mediana", "1er cuartil", "3er cuartil","Desv. típica")
rownames(Dades)=c("Asintomática" ,"Síntomas leves",      "Neumonía"  )

Dades %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")


```

```{r,include=FALSE}

shapiro.test(I)$p.value
kruskal.test(Factor~Síntomas,data=DF)$p.value

pairwise.wilcox.test(I,Sint,p.adjust.method = "bonferroni")$p.value
```

* Ajuste de las edades gestacionales de cada nivel a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I[Sint=="Asintomática"])$p.value,1)`$, $`r signif(shapiro.test(I[Sint=="Síntomas leves"])$p.value,1)`$, $`r signif(shapiro.test(I[Sint=="Neumonía"])$p.value,1)`$, respectivamente

* Homocedasticidad: Test de Fligner-Killeen, p-valor $`r signif(fligner.test(I~Sint)$p.value,1)`$ 

* Edades gestacionales medias: test de Kruskal-Wallis, p-valor  $`r signif(kruskal.test(I~Síntomas,data=DF)$p.value,1)`$

* Contrastes posteriores de edades gestacionales medias por parejas:  tests de Mann-Whitney,p-valores ajustados por Bonferroni:

    * Asintomáticas vs Síntomas leves: `r round(pairwise.wilcox.test(I,Sint,p.adjust.method = "bonferroni")$p.value[1,1],3)`
    * Asintomáticas vs Neumonía: $`r signif(pairwise.wilcox.test(I,Sint,p.adjust.method = "bonferroni")$p.value[2,1],1)`$
    * Síntomas leves  vs Neumonía: $`r signif(pairwise.wilcox.test(I,Sint,p.adjust.method = "bonferroni")$p.value[2,2],1)`$

    



### Pesos hijos infectadas


```{r 42,fig.cap="\\s"}
SintN=c(Casos[Casos$Feto.muerto.intraútero=="No",]$SINTOMAS_DIAGNOSTICO,CasosGM[CasosGM$Feto.vivo=="Sí",]$SINTOMAS_DIAGNOSTICO)
Síntomas=SintN[!is.na(SintN)]

I=c(Casos[Casos$Feto.muerto.intraútero=="No",]$Peso._gramos_...125,CasosGM[CasosGM$Feto.vivo=="Sí",]$Peso._gramos_...148)
I=I[!is.na(SintN)]

data =data.frame(
  Síntomas,
  Pesos=I
)

data %>%
  ggplot( aes(x=Síntomas, y=Pesos, fill=Síntomas)) +
    geom_violin(width=1) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    theme(
      legend.position="none",
      plot.title = element_text(size=11)
    ) +
    xlab("")+
   ylab("Pesos (gramos)")+
  scale_fill_brewer(palette = "Dark2") 
```



```{r}
Dades=rbind(c(round(min(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1),round(max(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1), round(mean(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1),
              round(median(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1),
              round(quantile(I[data$Síntomas=="Asintomática"],c(0.25,0.75),na.rm=TRUE),1),
              round(sd(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1)),
   c(round(min(I[data$Síntomas=="Síntomas leves"],na.rm=TRUE),1),round(max(I[data$Síntomas=="Síntomas leves"],na.rm=TRUE),1), round(mean(I[data$Síntomas=="Síntomas leves"],na.rm=TRUE),1),
       round(median(I[data$Síntomas=="Síntomas leves"],na.rm=TRUE),1),
              round(quantile(I[data$Síntomas=="Síntomas leves"],c(0.25,0.75),na.rm=TRUE),1),round(sd(I[data$Síntomas=="Síntomas leves"],na.rm=TRUE),1)),         
  c(round(min(I[data$Síntomas=="Neumonía"],na.rm=TRUE),1),round(max(I[data$Síntomas=="Neumonía"],na.rm=TRUE),1), round(mean(I[data$Síntomas=="Neumonía"],na.rm=TRUE),1),round(median(I[data$Síntomas=="Neumonía"],na.rm=TRUE),1),
              round(quantile(I[data$Síntomas=="Neumonía"],c(0.25,0.75),na.rm=TRUE),1),round(sd(I[data$Síntomas=="Neumonía"],na.rm=TRUE),1))          )
colnames(Dades)=c("Peso. mínimo","Peso.  máximo","Peso.  medio","Peso mediano", "1er cuartil", "3er cuartil","Desv. típica")
rownames(Dades)=c("Asintomática" ,"Síntomas leves",      "Neumonía"  )

Dades %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")


```

```{r,include=FALSE}

shapiro.test(I)$p.value
kruskal.test(I~Síntomas)$p.value
```

* Ajuste de los pesos de cada nivel a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I[Sint=="Asintomática"])$p.value,1)`$, $`r signif(shapiro.test(I[Sint=="Síntomas leves"])$p.value,1)`$, $`r signif(shapiro.test(I[Sint=="Neumonía"])$p.value,1)`$, respectivamente

* Homocedasticidad: Test de Fligner-Killeen, p-valor `r round(fligner.test(I~Síntomas)$p.value,3)`


* Pesos medios: test de Kruskal-Wallis, p-valor  `r round(kruskal.test(I~Síntomas)$p.value,3)`


### Bajo peso



```{r}
I.cut=cut(I,breaks=c(0,2500,10000),labels=c(1,0),right=FALSE)

DF=data.frame(Factor=I.cut,Síntomas=Síntomas)
taula=table(DF)[,c(1,2,3)]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),length(I.cut[Síntomas=="Asintomática"])-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),length(I.cut[Síntomas=="Asintomática"])-sum(as.vector(taula[,1])))/length(I.cut[Síntomas=="Asintomática"]),2),
            c(as.vector(taula[,2]),length(I.cut[Síntomas=="Síntomas leves"])-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),length(I.cut[Síntomas=="Síntomas leves"])-sum(as.vector(taula[,2])))/length(I.cut[Síntomas=="Síntomas leves"]),2),
             c(as.vector(taula[,3]),length(I.cut[Síntomas=="Neumonía"])-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),length(I.cut[Síntomas=="Neumonía"])-sum(as.vector(taula[,3])))/length(I.cut[Síntomas=="Neumonía"]),2)
           )
EEExt=rbind(EEExt,c(length(I.cut[Síntomas=="Asintomática"]),100,length(I.cut[Síntomas=="Síntomas leves"]),100,length(I.cut[Síntomas=="Neumonía"]),100))

rownames(EEExt)=c("Bajo peso", "No bajo peso","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



```{r 86,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Síntomas leves", "Neumonía"), each=2),levels=c("Asintomática", "Síntomas leves", "Neumonía"))
Grupo=ordered(rep(rownames(EEExt)[1:2] , 3),levels=rownames(EEExt)[1:2])
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y bajo peso: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(prop.trend.test(taula[1,],colSums(taula),score=prop.table(table(Sint)))$p.value,3)`


