--- 
title: "Tesis de Eva Morán. Análisis estadístico."
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
output: 
   bookdown::html_book:
    includes:
      in_header: style.css
documentclass: book
#bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
github-repo: AprendeR-UIB/TesisEva
---


```{r global_options,  include=FALSE}
rm(list = ls())
knitr::opts_chunk$set(
 echo=TRUE, 
  warning=FALSE, 
  message=FALSE,
   fig.width=7, 
  out.width="50%",
  fig.asp = 1,
  fig.align="center"
)
knitr::opts_knit$set(global.par=TRUE)
par(cex.main=0.9,cex.axis=0.8,cex.lab=0.8)
```


# Presentación {-}


El análisis tanto descriptivo como inferencial de los datos se ha llevado a cabo usando R versión 4.2.2. Para los gráficos se ha usado el paquete `ggplot2` de R. 

Este documento se ha escrito en *R Markdown*, usando *RStudio* como editor de textos y el paquete `bookdown` para compilar los ficheros *markdown* y producir el documento html final. Todos los valores que aparecen dentro del texto se han producido mediante bloques de código. Los ficheros *markdown* originales se encuentran en el repositorio https://github.com/biocom-uib/TesisEvaMoranRmd. 

**Variables numéricas**: Dado el gran tamaño de las muestras, se han usado tests de Shapiro-Wilks para contrastar si las distribuciones de las variables numéricas se ajustan a normalidad, y tests t (suponiendo varianzas iguales o diferentes, según correspondiera), para comparar pares de medias. Como nunca se ha podido aceptar la normalidad de las muestras, se han usado tests de Fligner-Killeen para contrastar la igualdad de dos o más varianzas y tests de Kruskall-Wallis para contrastar la igualdad de más de dos medias en análisis factoriales. Para los tests posteriores de parejas de medias en análisis factoriales se han usado tests t o tests de Mann-Whitney, según se considerara adecuado. 

**Variables categóricas**: Se ha usado sistemáticamente el test exacto de Fisher para la comparación bilateral de pares de proporciones o de odds ratios, según correspondiera a la naturaleza del contraste. Como el tamaño de las muestras siempre lo ha permitido, los intervalos de confianza para RA se han calculado con la función `prop.test` con ajuste de continuidad, y los intervalos para RR se han calculado con la función `RelRisk`del paquete `DescTools`. La comparación de pares de diferencias de proporciones se ha realizado por el método de marcas de Martin-Herranz-Álvarez; mientras que en la comparación de pares de cocientes de proporciones  (pares de RR) o de pares de OR se han usado los tests usuales basados en aproximaciones lognormales. Los tres métodos se han implementado en funciones de R. 


La igualdad de distribuciones de variables categóricas politómicas se ha contrastado sistemáticamente mediante tests ji cuadrado de bondad de ajuste, usando el método de Montecarlo (basado en 10000 simulaciones) cuando no se cumplían las condiciones teóricas para poder usar su versión paramétrica. A continuación fijamos la semilla de aleatoriedad (a 2022) para que los resultados de las simulaciones sean reproducibles.

```{r}
set.seed(2022)
```

El análisis multivariante de variables categóricas y el cálculo de odds ratios ajustadas se ha llevado a cabo mediante regresiones logísticas, binomiales o multinomiales según correspondiera al número de niveles (2 o más de 2) de la variable respuesta.

**Variables ordinales**: La igualdad de tendencia en distribuciones de variables ordinales se ha contrastado sistemáticamente mediante tests $\chi^2$.



### Paquetes usados

```{r paquetes}
library(knitr)
library(readxl)
library(kableExtra)
library(PropCIs)
library(epiR)
library(ExactCIdiff)
library(ggplot2)
library(dplyr)
library(hrbrthemes)
library(viridis)
library(ggmosaic)
library(rcompanion)
library(basecamb)
library(pscl)
library(caret)
library(car)
library(nnet)
library(ggeffects)
library(gtsummary)
library(rootSolve)
library(DescTools)
library(samplesizeCMH)
library(pwr)
```

### Importación de datos

```{r datos}
#Casos
#
Casos=read_excel("CasosTot.xlsx")
Casos=data.frame(Casos)
Casos=Casos[Casos$EntranTesis==1,]
Casos$SINTOMAS_DIAGNOSTICO=factor(Casos$SINTOMAS_DIAGNOSTICO,levels=c("Asintomatica", "Sintomas leves", "Neumonia"),ordered=TRUE)
Casos$SINTOMAS_DIAGNOSTICO=plyr::revalue(Casos$SINTOMAS_DIAGNOSTICO, c("Asintomatica"="Asintomática", "Sintomas leves"="Leve","Neumonia"="Grave"))
Sint=Casos$SINTOMAS_DIAGNOSTICO
#
#Controles
#
Controls=read_excel("ControlsTot.xlsx")
Controls=data.frame(Controls)
Controls=Controls[Controls$EntranTesis==1,]
Si.i.No=which(Controls$Feto.vivo...194=="Sí y No")
Controls[Si.i.No,]$Gestación.Múltiple=1
Controls[Si.i.No,]$Feto.vivo...194="Sí"
#
#Casos y controles con GM
#
CasosGM=Casos[Casos$Gestación.Múltiple=="Sí",]
ControlsGM=Controls[Controls$Gestación.Múltiple==1,]
#
#Casos y controles de la 1a ola
#
Casos1w=Casos[Casos$PRIMERA_OLA...3==1,]
Controls1w=Controls[Controls$PRIMERA_OLA...4==1,]
#
#Casos y controles de la 1a ola con GM
#
Casos1wGM=Casos1w[Casos1w$Gestación.Múltiple=="Sí",]
Controls1wGM=Controls1w[Controls1w$Gestación.Múltiple==1,]
#
#Casos y controles de la 2a ola
#
Casos2w=Casos[Casos$SEGUNDA_OLA...4==1,]
Controls2w=Controls[Controls$SEGUNDA_OLA...5==1,]
#
#Casos y controles de la 2a ola con GM
#
Casos2wGM=Casos2w[Casos2w$Gestación.Múltiple=="Sí",]
Controls2wGM=Controls2w[Controls2w$Gestación.Múltiple==1,]
```


Dimensiones


```{r}
n_I=dim(Casos)[1]
n_NI=dim(Controls)[1]
n_I1=dim(Casos1w)[1]
n_NI1=dim(Controls1w)[1]
n_I2=dim(Casos2w)[1]
n_NI2=dim(Controls2w)[1]
n_AS=length(Casos$SINTOMAS_DIAGNOSTICO[Casos$SINTOMAS_DIAGNOSTICO=="Asintomática"])
n_SL=length(Casos$SINTOMAS_DIAGNOSTICO[Casos$SINTOMAS_DIAGNOSTICO=="Leve"])
n_NE=length(Casos$SINTOMAS_DIAGNOSTICO[Casos$SINTOMAS_DIAGNOSTICO=="Grave"])
```


Vectores de nombres usados en las tablas y gráficos.

```{r definiciones}
Columnes=c("Infectadas (N)", "Infectadas (%)","No infectadas (N)", "No infectadas (%)")
Columnes.Sint=c("Asintomáticas (N)", "Asintomáticas (%)","Leves (N)", "Leves (%)", "Graves (N)", "Graves (%)")
ColumnesExt=c("Infectadas 1a ola (N)", "Infectadas 1a ola (%)","No infectadas 1a ola (N)", "No infectadas 1 ola (%)","Infectadas 2 ola (N)", "Infectadas 2 ola (%)","No infectadas 2 ola (N)", "No infectadas 2 ola (%)")
ColumnesOnes=c("Total 1a ola (N)", "Total 1a ola (%)","Total 2 ola (N)", "Total 2 ola (%)")
Columnes.OR=c("ORa","IC 95%: extremo inf.", "IC 95%: extremo sup.", "p-valor")
```


### Definición de grupos Robson

Defino para Casos y Controles la variable **Cesárea** (0 no cesárea, 1 sí cesárea, NA tipo de parto no especificado). 


```{r}
Casos$Cesárea=Casos$Tipo.de.parto
Casos$Cesárea[Casos$Cesárea=="Eutocico" | Casos$Cesárea=="Instrumental"]=0
Casos$Cesárea[Casos$Cesárea=="Cesárea"]=1
#
Controls$Cesárea=Controls$Tipo.de.parto
Controls$Cesárea[Controls$Cesárea=="Eutocico" | Controls$Cesárea=="Instrumental"]=0
Controls$Cesárea[Controls$Cesárea=="Cesárea"]=1
```


Defino para Casos y Controles la variable **CesAnt** (césarea anterior: 0 no, 1 sí) buscando las cesáreas previas en las variables "Indicación de cesárea" y "Especificar otra indicación".  El código indica específicamente cómo.


```{r}
Casos$CesAnt=rep(0,n_I)
Casos$CesAnt[Casos$Indicación.de.cesárea=="Cesárea anterior" | Casos$Indicación.de.cesárea=="Cesárea anterior,Otra" | Casos$Indicación.de.cesárea=="Nalgas,Cesárea anterior" | Casos$Indicación.de.cesárea=="Nalgas,Cesárea anterior,Miomectomía previa,Otra" |
Casos$Indicación.de.cesárea=="Nalgas,Patología materna no relacionada con COVID,Cesárea anterior" | 
Casos$Indicación.de.cesárea=="No progresión de parto,Cesárea anterior" | Casos$Indicación.de.cesárea=="Patología materna no relacionada con COVID,Cesárea anterior,Miomectomía previa" | 
Casos$Indicación.de.cesárea=="Patología materna no relacionada con COVID,Cesárea anterior,Otra" | 
Casos$Indicación.de.cesárea=="Patología materna relacionada con COVID,Cesárea anterior"]=1
#
Casos$CesAnt[Casos$Especificar.otra.indicación=="2 cesáreas anteriores" | 
Casos$Especificar.otra.indicación=="3 cesáreas anteriores" | 
Casos$Especificar.otra.indicación=="3 cesareas previas" | 
Casos$Especificar.otra.indicación=="C ITERATIVA" | 
Casos$Especificar.otra.indicación=="Cesárea anterior + cérvix desfavorable + no deseo materno inducción" | 
Casos$Especificar.otra.indicación=="cesárea anterior + gestación extrauterina previa en cicatriz de cesárea" | 
Casos$Especificar.otra.indicación=="Cesarea anterior y no deseo materno de parto" | 
Casos$Especificar.otra.indicación=="Cesarea anterior y RPM >12 con cervix desfavorable" | 
Casos$Especificar.otra.indicación=="Cesarea anterior, oligoamnios, cervix desfavorable y COVID-Positivo." | 
Casos$Especificar.otra.indicación=="Cesárea anterior, RPM y NO deseo materno de parto vaginal." | 
Casos$Especificar.otra.indicación=="cesarea iterativa" | 
Casos$Especificar.otra.indicación=="Cesarea iterativa" | 
Casos$Especificar.otra.indicación=="CESAREA ITERATIVA" | 
Casos$Especificar.otra.indicación=="cesárea iterativa" | 
Casos$Especificar.otra.indicación=="Cesárea iterativa" | 
Casos$Especificar.otra.indicación=="cesarea previa y no deseo parto vaginal" | 
Casos$Especificar.otra.indicación=="Dos cesáreas previas" | 
Casos$Especificar.otra.indicación=="iterativa" | 
Casos$Especificar.otra.indicación=="ITERATIVA" | 
Casos$Especificar.otra.indicación=="iterativa por 2 previas" | 
Casos$Especificar.otra.indicación=="iterativa: 2 cesáreas anteriores" | 
Casos$Especificar.otra.indicación=="Macrosoma + cesárea anterior." | 
Casos$Especificar.otra.indicación=="periodo intergenesico<5meses y cesarea anterior" | 
Casos$Especificar.otra.indicación=="PREECLAMPSIA LEVE+2CESÁREAS ANTERIORES+CÉRVIX DESFAVORABLE" | 
Casos$Especificar.otra.indicación=="PREECLAMPSIA SIN CRITERIOS DE GRAVEDAD+2 CESÁREAS ANT" | 
Casos$Especificar.otra.indicación=="RPM+CESÁREA ANTERIOR +NO DESEO DE PARTO VAGINAL"]=1 
```


```{r}
n_NI=dim(Controls)[1]
Controls$CesAnt=rep(0,n_NI)
Controls$CesAnt[Controls$Indicación.de.cesárea=="Cesárea anterior" |  Controls$Indicación.de.cesárea=="Cesárea anterior,Otra" |  Controls$Indicación.de.cesárea=="Nalgas,Cesárea anterior" | 
Controls$Indicación.de.cesárea=="No progresión de parto,Cesárea anterior" | Controls$Indicación.de.cesárea=="Patología materna no relacionada con COVID,Cesárea anterior" | 
Controls$Indicación.de.cesárea=="Riesgo de pérdida de bienestar fetal,Cesárea anterior" |
Controls$Indicación.de.cesárea=="Riesgo de pérdida de bienestar fetal,Cesárea anterior,Otra"]=1
#
Controls$CesAnt[Controls$Especificar.otra.indicación=="2 CESÁREAS ANTERIORES" |     
Controls$Especificar.otra.indicación=="2 CESÁREAS PREVIAS. INICIO CESÁREA ELECTIVA" |     
Controls$Especificar.otra.indicación=="3 CESAREAS PREVIAS" |     
Controls$Especificar.otra.indicación=="cesarea ant+pc99 y no deseo parto" |     
Controls$Especificar.otra.indicación=="CESÁREA ITERATIVA POR DOS CESÁREAS PREVIAS" |     
Controls$Especificar.otra.indicación=="Revoca prueba de parto. Cesárea anterior"]=1
```

Defino para Casos y Controles la variable **Nalgas** (0 de cara, 1 de pies, 2 transversal/oblícua, NA malposiciones no especificadas) buscando las malposiciones en las variables "Indicación de cesárea", "Especificar otra indicación" y "Especificar otra indicación parto instrumental".

```{r}
Casos$Nalgas=rep(0,n_I)
Casos$Nalgas[Casos$Indicación.de.cesárea=="Nalgas" | 
Casos$Indicación.de.cesárea=="Nalgas,Cesárea anterior" | 
Casos$Indicación.de.cesárea=="Nalgas,Cesárea anterior,Miomectomía previa,Otra" | 
Casos$Indicación.de.cesárea=="Nalgas,Otra" | 
Casos$Indicación.de.cesárea=="Nalgas,Patología materna no relacionada con COVID" | 
Casos$Indicación.de.cesárea=="Nalgas,Patología materna no relacionada con COVID,Cesárea anterior"]=1 
#
Casos$Nalgas[Casos$Especificar.otra.indicación=="CIR I de primer gemelo+presentación podálica." | 
Casos$Especificar.otra.indicación=="Gemelar condiscreancia de peso , segundo gemelo nalgas , preeclampsia leve" | 
Casos$Especificar.otra.indicación=="Gemelar Podálica-podálica" | 
Casos$Especificar.otra.indicación=="GEMELAR, 1er gemelo CIR 1 y PODÁLICA" | 
Casos$Especificar.otra.indicación=="NALGAS NO CUMPLE CRITERIOS PARA PARTO VAGINAL" | 
Casos$Especificar.otra.indicación=="PE tardia a termino en gestante con feto en podalica" | 
Casos$Especificar.otra.indicación=="Podálica+sospecha de nudo verdadero de cordón" | 
Casos$Especificar.otra.indicación=="RPM en primiparidad de nalgas"]=1
#
Casos$Nalgas[Casos$Especificar.otra.indicación=="Gemelar BCBA podalica-transversa" |
Casos$Especificar.otra.indicación=="Situación transversa" | 
Casos$Especificar.otra.indicación=="Versión espontánea fetal a situación transversa durante inducción"]=2 
```


```{r}
Controls$Nalgas=rep(0,n_NI)
Controls$Nalgas[Controls$Indicación.de.cesárea=="Nalgas" |  
Controls$Indicación.de.cesárea=="Nalgas,Cesárea anterior" | 
Controls$Indicación.de.cesárea=="Nalgas,Otra"]=1   
#
Controls$Nalgas[Controls$Especificar.otra.indicación=="2 gemelo en pelviana" | 
Controls$Especificar.otra.indicación=="2 gemelo en pelviana" | 
Controls$Especificar.otra.indicación=="CESAREA URGENTE POR TRABAJO DE PARTO GEMELAR PRIMERO NALGAS"  | 
Controls$Especificar.otra.indicación=="Electiva. Gemelar 2 feto en pelviana"   | 
Controls$Especificar.otra.indicación=="Gemelar.1º gemelo nalgas"   | 
Controls$Especificar.otra.indicación=="gestacion gemelar primero no cefalica. preeclampsia leve"  | 
Controls$Especificar.otra.indicación=="Podálica"   | 
Controls$Especificar.otra.indicación=="RPM en gestación gemelar con el primer gemelo en podálica y pretérmino de 28+3 sem. Trabajo de parto y procidencia de mano"  | 
Controls$Especificar.otra.indicación=="Segundo gemelo en pelviana"  | 
Controls$Especificar.otra.indicación.parto.instrumental=="Parto de nalgas, con fórceps de cabeza última"]=1                        
#
Controls$Nalgas[Controls$Especificar.otra.indicación=="Situación transversa. Mioma tumor de parto."]=2  
#
Controls$Nalgas[Controls$Especificar.otra.indicación=="Rechazo de versión cefálica externa"|
Controls$Especificar.otra.indicación=="MALPOSICION FETAL"]=NA

```

Defino la variable **Robson** para Casos y Controles siguiendo el algoritmo OMS:


```{r}
Casos$Robson=rep(0,n_I)
#
Casos$Robson[Casos$Gestación.Múltiple=="Sí"]=8
#
Casos$Robson[Casos$Gestación.Múltiple=="No"& Casos$Nalgas==2]=9
#
Casos$Robson[Casos$Gestación.Múltiple=="No"  & Casos$Nalgas==1 & Casos$NULIPARA==0 ]=7
#
Casos$Robson[Casos$Gestación.Múltiple=="No"  & Casos$Nalgas==1 & Casos$NULIPARA==1 ]=6
#
Casos$Robson[Casos$Gestación.Múltiple=="No"  & Casos$Nalgas==0 & Casos$PREMATURO==1 ]=10
#
Casos$Robson[Casos$Gestación.Múltiple=="No" & Casos$Nalgas==0 & Casos$PREMATURO==0 & Casos$NULIPARA==0 &  Casos$CesAnt==1 ]=5
#
Casos$Robson[Casos$Gestación.Múltiple=="No" & Casos$Nalgas==0 & Casos$PREMATURO==0 & Casos$NULIPARA==0 &  Casos$CesAnt==0 & !is.na(Casos$Inicio.de.parto) & Casos$Inicio.de.parto!="Espontáneo" ]=4
#
Casos$Robson[Casos$Gestación.Múltiple=="No" & Casos$Nalgas==0 & Casos$PREMATURO==0 & Casos$NULIPARA==0 &  Casos$CesAnt==0 &  Casos$Inicio.de.parto=="Espontáneo" ]=3
#
Casos$Robson[Casos$Gestación.Múltiple=="No" & Casos$Nalgas==0 & Casos$PREMATURO==0 & Casos$NULIPARA==1 &  !is.na(Casos$Inicio.de.parto) & Casos$Inicio.de.parto!="Espontáneo"]=2
#
Casos$Robson[Casos$Gestación.Múltiple=="No" & Casos$Nalgas==0 & Casos$PREMATURO==0 & Casos$NULIPARA==1 & Casos$Inicio.de.parto=="Espontáneo" ]=1
#
Casos$Robson=factor(Casos$Robson,levels=0:10) # 0 son los casos perdidos
```


```{r}
Controls$Robson=rep(0,n_NI)
#
Controls$Robson[Controls$Gestación.Múltiple==1]=8
#
Controls$Robson[Controls$Gestación.Múltiple==0& Controls$Nalgas==2]=9
#
Controls$Robson[Controls$Gestación.Múltiple==0  & Controls$Nalgas==1 & Controls$Nuliparous==0 ]=7
#
Controls$Robson[Controls$Gestación.Múltiple==0  & Controls$Nalgas==1 & Controls$Nuliparous==1 ]=6
#
Controls$Robson[Controls$Gestación.Múltiple==0  & Controls$Nalgas==0 & Controls$Preterm.deliveries==1 ]=10
#
Controls$Robson[Controls$Gestación.Múltiple==0 & Controls$Nalgas==0 & Controls$Preterm.deliveries==0 & Controls$Nuliparous==0 &  Controls$CesAnt==1 ]=5
#
Controls$Robson[Controls$Gestación.Múltiple==0 & Controls$Nalgas==0 & Controls$Preterm.deliveries==0 & Controls$Nuliparous==0 &  Controls$CesAnt==0 & !is.na(Controls$Inicio.de.parto) & Controls$Inicio.de.parto!="Espontáneo" ]=4
#
Controls$Robson[Controls$Gestación.Múltiple==0 & Controls$Nalgas==0 & Controls$Preterm.deliveries==0 & Controls$Nuliparous==0 &  Controls$CesAnt==0 &  Controls$Inicio.de.parto=="Espontáneo" ]=3
#
Controls$Robson[Controls$Gestación.Múltiple==0 & Controls$Nalgas==0 & Controls$Preterm.deliveries==0 & Controls$Nuliparous==1 &  !is.na(Controls$Inicio.de.parto) & Controls$Inicio.de.parto!="Espontáneo"]=2
#
Controls$Robson[Controls$Gestación.Múltiple==0 & Controls$Nalgas==0 & Controls$Preterm.deliveries==0 & Controls$Nuliparous==1 & Controls$Inicio.de.parto=="Espontáneo" ]=1
#
Controls$Robson=factor(Controls$Robson,levels=0:10)  # 0 son los casos perdidos
```



Restrinjo las variables **Cesárea** y **Robson** a Casos y Controles de las dos olas

```{r}
Casos1w$Cesárea=Casos[Casos$PRIMERA_OLA...3==1,]$Cesárea
Controls1w$Cesárea=Controls[Controls$PRIMERA_OLA...4==1,]$Cesárea
Casos2w$Cesárea=Casos[Casos$SEGUNDA_OLA...4==1,]$Cesárea
Controls2w$Cesárea=Controls[Controls$SEGUNDA_OLA...5==1,]$Cesárea

Casos1w$Robson=Casos[Casos$PRIMERA_OLA...3==1,]$Robson
Controls1w$Robson=Controls[Controls$PRIMERA_OLA...4==1,]$Robson
Casos2w$Robson=Casos[Casos$SEGUNDA_OLA...4==1,]$Robson
Controls2w$Robson=Controls[Controls$SEGUNDA_OLA...5==1,]$Robson
```



### Algunas funciones

Funciones definidas *ad hoc* para este estudio


#### Tests

```{r funciones}
#Test para diferencias de RA

RA.RA=function(M,conf.level=0.95){
beta=c(1,-1,-1,1)
B=sum(beta)
e=M[1,]
n=colSums(M)
p=e/n
q=1-2*p
N=sum(n)
L.b=sum(beta*p)
T=L.b+n[2]+n[3]
T0=4*L.b^2/sum(beta^2/n)
if (L.b>0){T1=T*L.b/2}
if (L.b<0){T1=(N-T)*L.b/(-2)}
if (L.b==0){T1=0}
y=function(x){N-sum(sqrt(n^2+((2*n*beta*q)/L.b)*x+(beta^2/L.b^2)*x^2))}
z2=rootSolve::multiroot(y,start=(T0+T1)/2,maxiter=1000,rtol = 1e-8, atol = 1e-10, ctol = 1e-10)$root
p.val=1-pchisq(z2,1)
zz=qnorm((1-conf.level)/2)^2
y=function(x){N+2*zz -2*L.b*x-sum(sqrt(n^2+2*n*beta*q*x+x^2))}
C1=rootSolve::multiroot(y,start=-100,maxiter=1000,rtol = 1e-8, atol = 1e-10, ctol = 1e-10)$root
C2=rootSolve::multiroot(y,start=100,maxiter=1000,rtol = 1e-8, atol = 1e-10, ctol = 1e-10)$root
IC=L.b-zz/c(C2,C1)
Res=rbind(c(p.val,IC))
colnames(Res)=c("p-valor","IC-inferior","IC-superior")
return(Res)
}


#Test para cociente de RR

RR.RR=function(M,conf.level=0.95){
e=M[1,]
n=colSums(M)
p=e/n

RR1=p[1]/p[2]
RR2=p[3]/p[4]
se.lnRR1=sqrt(1/e[1]+1/e[2]-1/n[1]-1/n[2])
se.lnRR2=sqrt(1/e[3]+1/e[4]-1/n[3]-1/n[4])

RRR=RR1/RR2
se.lnRRR=sqrt(se.lnRR1^2+se.lnRR2^2)

IC.1=exp(log(RRR)-se.lnRRR*qnorm((1+conf.level)/2))
IC.2=exp(log(RRR)+se.lnRRR*qnorm((1+conf.level)/2))
p.val=2-2*pnorm(abs(log(RRR))/se.lnRRR)
Res=rbind(c(RRR,p.val,IC.1,IC.2))
colnames(Res)=c("RRR", "p-valor","IC-inferior","IC-superior")
return(Res)
}

# Test para comparar OR

OR.OR=function(M,conf.level=0.95){
M1=M[,1:2]
M2=M[,3:4]
LOR1=log(fisher.test(M1)$estimate)
LOR2=log(fisher.test(M2)$estimate)
Z=abs(LOR1-LOR2)/sqrt(sum(1/M))
p.val=2*(1-pnorm(Z))
IC=exp(LOR1-LOR2+qnorm((1+conf.level)/2)*sqrt(sum(1/M))*c(-1,1))
Res=rbind(c(p.val,IC))
colnames(Res)=c("p-valor","IC-inferior","IC-superior")
return(Res)
}

# Test de tendencia

Prop.trend.test=function(x,X){
chisq.test(rbind(x,X))$p.value  
}
```

#### Tablas y gráficos

```{r}
#Tabla de RA y RR

Riesgos=function(M){
e=M[1,]
n=colSums(M)
p=e/n

RA=round(c(p[1]-p[2],p[3]-p[4]),4)
RR=round(c(p[1]/p[2],p[3]/p[4]),4)
Res=cbind(RA,RR)
rownames(Res)=c("1a ola", "2a ola")
return(Res)
}

# Tablas 2d Descripción casos-controles

Tabla.DMG=function(I,NI,L1,L2){
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
EEExt=rbind(c(as.vector(table(I)),NA_I),
            round(100*c(as.vector(table(I)),NA_I)/n_I,1),
            c(as.vector(table(NI)),NA_NI),
            round(100*c(as.vector(table(NI)),NA_NI)/n_NI,1))

colnames(EEExt)=c(L1, L2,"Pérdidas")
rownames(EEExt)=c("Infectadas (N)", "Infectadas (%)","No infectadas (N)", "No infectadas (%)")

t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
}

Tabla.DMG1=function(I,NI,L1,L2){
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
EEExt=rbind(c(as.vector(table(I))[2:1],NA_I),
            round(100*c(as.vector(table(I))[2:1],NA_I)/n_I1,1),
            c(as.vector(table(NI))[2:1],NA_NI),
            round(100*c(as.vector(table(NI)),NA_NI)/n_NI1,1))

colnames(EEExt)=c(L1, L2,"Pérdidas")
rownames(EEExt)=c("Infectadas (N)", "Infectadas (%)","No infectadas (N)", "No infectadas (%)")

t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
}

Tabla.DMG2=function(I,NI,L1,L2){
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
EEExt=rbind(c(as.vector(table(I))[2:1],NA_I),
            round(100*c(as.vector(table(I))[2:1],NA_I)/n_I2,1),
            c(as.vector(table(NI))[2:1],NA_NI),
            round(100*c(as.vector(table(NI))[2:1],NA_NI)/n_NI2,1))

colnames(EEExt)=c(L1, L2,"Pérdidas")
rownames(EEExt)=c("Infectadas (N)", "Infectadas (%)","No infectadas (N)", "No infectadas (%)")

t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
}

# Tablas 2d Descripción sintomatología

Tabla.DGS=function(I,L1,L2){
DF=data.frame(Factor=I,Síntomas=Sint)
taula=table(DF)[c(2,1) ,1:3]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1])))/n_AS,2),
            c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2])))/n_SL,2),
             c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3])))/n_NE,2)
           )
EEExt=rbind(EEExt,c(n_AS,100,n_SL,100,n_NE,100))

rownames(EEExt)=c(L1,L2,"Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
}


Tabla.DGSW=function(I,L1,L2){
DF=data.frame(Factor=I,Síntomas=Sint)
taula=table(DF)[c(2,1) ,]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(as.vector(taula[,1]),
            as.vector(proptaula[,1]),
            as.vector(taula[,2]),
            as.vector(proptaula[,2]),
            as.vector(taula[,3]),
            as.vector(proptaula[,3])
            )
rownames(EEExt)=c(L1,L2)
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling()
}


# Barplots descripción global sintomatología

Barplot.DGS=function(I,L1,L2){
taula=table(data.frame(Factor=I,Síntomas=Sint))[c(2,1) ,1:3]
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=2),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(c(L1, L2) , 3),levels=c(L1, L2))
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+  
  scale_fill_brewer(palette = "Dark2") 
}


Barplot.DGSW=function(I,L1,L2){
taula=table(data.frame(Factor=I,Síntomas=Sint))[c(2,1),]
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=2),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(c(L1,L2) , 3),levels=c(L1,L2))
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+  
  scale_fill_brewer(palette = "Dark2") 
}

# Tabla de comparación entre olas: Casos y controles

ComparOlasCC=function(I1,I2,NI1,NI2,L1,L2){
NA_I1=length(I1[is.na(I1)])
NA_NI1=length(NI1[is.na(NI1)])
NA_I2=length(I2[is.na(I2)])
NA_NI2=length(NI2[is.na(NI2)])
EEExt=cbind(c(as.vector(table(I1))[2:1],NA_I1),
            round(100*c(as.vector(table(I1))[2:1],NA_I1)/n_I1,1),
            c(as.vector(table(NI1))[2:1],NA_NI1),
            round(100*c(as.vector(table(NI1))[2:1],NA_NI1)/n_NI1,1),
            c(as.vector(table(I2))[2:1],NA_I2),
            round(100*c(as.vector(table(I2))[2:1],NA_I2)/n_I2,1),
            c(as.vector(table(NI2))[2:1],NA_NI2),
            round(100*c(as.vector(table(NI2))[2:1],NA_NI2)/n_NI2,1)
            )
colnames(EEExt)=ColumnesExt
rownames(EEExt)=c(L1, L2,"Pérdidas")
EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")  
}

GrComparOlasCC=function(I1,I2,NI1,NI2,L1){
base=c("1a ola","2a ola")
df=data.frame(
Factor=c(rep("Infectadas 1a ola",length(I1)), rep("No infectadas 1a ola",length(NI1)),rep("Infectadas 2a ola",length(I2)), rep("No infectadas 2a ola",length(NI2))),
Grupo=c(I1,NI1,I2,NI2 )
)
Grupo=ordered(rep(c("Infectadas","No infectadas"), 2),levels=c("Infectadas","No infectadas"))
Ola=ordered(rep(base , each=2),levels=base)
valor=as.vector(100*prop.table(table(df)[c(1,3,2,4),2:1], margin=1))[1:4]
data=data.frame(Grupo,Ola,valor)
data %>%
ggplot(aes(fill=Grupo, y=valor, x=Ola)) + 
  geom_bar(position="dodge", stat="identity")+
xlab("")+
  ylab(paste(L1,"(%)"))+
scale_fill_hue(c=100)+labs(fill="")}


# Tabla de comparación entre olas: Global

ComparOlasGl=function(Tot1w,Tot2w,L1,L2){
Tot1w=c(I1,NI1)
Tot2w=c(I2,NI2)
n_1=length(Tot1w)
n_2=length(Tot2w)

NA_1=length(Tot1w[is.na(Tot1w)])
NA_2=length(Tot2w[is.na(Tot2w)])

EEExt=cbind(c(as.vector(table(Tot1w))[2:1],NA_1),
            round(100*c(as.vector(table(Tot1w))[2:1],NA_1)/n_1,1),
            c(as.vector(table(Tot2w))[2:1],NA_2),
            round(100*c(as.vector(table(Tot2w))[2:1],NA_2)/n_2,1)
            )
colnames(EEExt)=ColumnesOnes
rownames(EEExt)=c(L1,L2,"Pérdidas")
EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
}

# Tabla de comparación Anteparto-Periparto

TablaAntePeri=function(I,NI,L1,L2){
I.AP=I[Casos$PreP==1]
I.PP=I[Casos$PreP==0]
NA_IAP=length(I.AP[is.na(I.AP)])
NA_IPP=length(I.PP[is.na(I.PP)])
NA_NI=length(NI[is.na(NI)])
EEExt=rbind(c(as.vector(table(I.AP))[2:1],NA_IAP),
            round(100*c(as.vector(table(I.AP))[2:1],NA_IAP)/n_IAP,1),
            c(as.vector(table(I.PP))[2:1],NA_IPP),
            round(100*c(as.vector(table(I.PP))[2:1],NA_IPP)/n_IPP,1),
            c(as.vector(table(NI))[2:1],NA_NI),
            round(100*c(as.vector(table(NI))[2:1],NA_NI)/n_NI,1))
rownames(EEExt)=ColumnesP
colnames(EEExt)=c(L1,L2,"Pérdidas")
t(EEExt) %>%
  kbl() %>%
  kable_styling()
}

# Tablas 2d Robson

TablaRobsonGlobal=function(TR1,TR2,x,y=x){
EE1=t(TR1)[2:1,2:11]
EE2=t(TR2)[2:1,2:11]
OR=rep(0,10)
pp=rep(0,10)
for (i in 1:10){
FT=fisher.test(cbind(EE1[,i],EE2[,i]))
OR[i]=FT$estimate
pp[i]=FT$p.value       }

dt=data.frame(1:10,colSums(EE1),EE1[1,],round(100*prop.table(EE1,margin=2)[1,],2),colSums(EE2),EE2[1,],round(100*prop.table(EE2,margin=2)[1,],2),round(OR,2),round(pp,3))
names(dt)=c("Grupo Robson", paste("Casos",x), "Cesáreas", "Porcentaje",  paste("Controles",y), "Cesáreas", "Porcentaje","OR","p-valor test de Fisher")
dt %>%
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")}
```



<!--chapter:end:index.Rmd-->

# Descripción de la muestra global




## Madres

Hay `r n_I` infectadas y `r n_NI` no infectadas. 

### Edades



```{r}
I=Casos$Edad._años_
NI=Controls$Edad._años_
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
```

```{r 1,fig.cap="\\s"}
data =data.frame(
  name=c(rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Edades=c(I,NI)
  )

sample_size = data %>% group_by(name) %>% summarize(num=n())

data %>%
 left_join(sample_size) %>%
  mutate(myaxis = paste0(name, "\n", "n=", num)) %>%
  ggplot( aes(x=myaxis, y=Edades, fill=name)) +
    geom_violin(width=1) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    theme(
      legend.position="none",
      plot.title = element_text(size=11)
    ) +
    xlab("")+
  ylab("Edades (años)")
```





```{r}
Dades=rbind(c(min(I,na.rm=TRUE),max(I,na.rm=TRUE), round(mean(I,na.rm=TRUE),1),round(median(I,na.rm=TRUE),1),round(quantile(I,c(0.25,0.75),na.rm=TRUE),1), round(sd(I,na.rm=TRUE),1)),
            c(min(NI,na.rm=TRUE),max(NI,na.rm=TRUE), round(mean(NI,na.rm=TRUE),1),round(median(NI,na.rm=TRUE),1),round(quantile(NI,c(0.25,0.75),na.rm=TRUE),1),round(sd(NI,na.rm=TRUE),1)))

colnames(Dades)=c("Edad mínima","Edad máxima","Edad media", "Edad mediana", "1er cuartil", "3er cuartil", "Desv. típica")
rownames(Dades)=c("Infectadas", "No infectadas")

Dades %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")


```



```{r}
I.cut=cut(I,breaks=c(0,30,40,100),labels=c("18-30","31-40",">40"))
NI.cut=cut(NI,breaks=c(0,30,40,100),labels=c("18-30","31-40",">40"))

EE=rbind(as.vector(table(I.cut)),as.vector(table(NI.cut)))
EEExt=rbind(c(as.vector(table(I.cut)),NA_I),
            round(100*c(as.vector(table(I.cut)),NA_I)/n_I,1),
            c(as.vector(table(NI.cut)),NA_NI),
            round(100*c(as.vector(table(NI.cut)),NA_NI)/n_NI,1)
            )
EEExt=cbind(EEExt,c(n_I,100,n_NI,100))

colnames(EEExt)=c("18-30","31-40",">40","Pérdidas","Total")
rownames(EEExt)=c("Infectadas (N)", "Infectadas (%)","No infectadas (N)", "No infectadas (%)")

t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r 2,fig.cap="\\s"}
df =data.frame(
  Factor=c(rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Edades=c( I.cut,NI.cut )
)

base=ordered(rep(c("18-30","31-40",">40"), each=2),levels=c("18-30", "31-40",   ">40"))
Grupo=rep(c("Infectada","No infectada") , length(levels(I.cut)))
valor=as.vector(prop.table(table(df), margin=1))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=base , y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  scale_fill_brewer(palette = "Accent")+
  labs(fill = "Grupo de edad")

```


```{r 3,fig.cap="\\s"}
df =data.frame(
  Factor=c(rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Edades=c( I.cut,NI.cut )
)

base=ordered(rep(c("18-30","31-40",">40"), each=2),levels=c("18-30", "31-40",   ">40"))
Grupo=rep(c("Infectada","No infectada") , length(levels(I.cut)))
valor=as.vector(prop.table(table(df), margin=2))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=Grupo, y=valor, x=base)) + 
  geom_bar(position="dodge", stat="identity")+
xlab("Grupos de edad")+
  ylab("")
```


Tests:


* Ajuste de las edades de infectadas y no infectadas a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I)$p.value,1)`$ y $`r 
signif(shapiro.test(NI)$p.value,1)`$, respectivamente

* Igualdad de edades medias: test t, p-valor `r round(t.test(I,NI)$p.value,2)`, IC del 95% para la diferencia de medias [`r round(t.test(I,NI)$conf.int,2)`] años

* Igualdad de desviaciones típicas: test de Fligner-Killeen, p-valor $`r round(fligner.test(list(I,NI))$p.value,5)`$

* Igualdad de composiciones por edades de los grupos de casos y de controles: test $\chi^2$, p-valor `r round(chisq.test(EE)$p.value,4)`. 

En la tabla que sigue:

* p-valor ajustado: p-valores de tests de Fisher bilateral ajustados por Bonferroni calculados para la muestra sin pérdidas
* OR: la odds ratio univariante estimada de infectarse relativa a la franja de dead
* IC: el intervalo de confianza del 95% para la OR

```{r}
pp=rep(0,dim(EE)[2])
for (i in 1:dim(EE)[2]){
pp[i]=prop.test(c(EE[1,i],sum(EE[1,-i])),
                c(sum(EE[,i]),sum(EE[,-i])))$p.value
}
pp=p.adjust(pp,method="bonferroni")
OR=rep(0,dim(EE)[2])
CI1=rep(0,dim(EE)[2])
CI2=rep(0,dim(EE)[2])

for (i in 1:dim(EE)[2]){
FT=fisher.test(rbind(c(EE[1,i],sum(EE[1,-i])),
                  c(EE[2,i],sum(EE[2,-i]))))
OR[i]=round(FT$estimate,2)
CI1[i]=round(FT$conf.int[1],2)
CI2[i]=round(FT$conf.int[2],2)
                }
dt=data.frame(franja=c("18-30","31-40",">40"),pp,OR,CI1,CI2)
names(dt)=c("Franja", "p-valor ajustado","OR","Extremo inferior de IC", "Extremo superior de IC")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



### Etnias

```{r}
I=Casos$Etnia
I[I=="Asia"]="Asiática"
I=factor(I)
NI=factor(Controls$Etnia)
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
```


```{r}
EE=rbind(as.vector(table(I)),
         as.vector(table(NI)))
EEExt=rbind(c(as.vector(table(I)),NA_I),
            round(100*c(as.vector(table(I)),NA_I)/n_I,1),
            c(as.vector(table(NI)),NA_NI),
            round(100*c(as.vector(table(NI)),NA_NI)/n_NI,1))
colnames(EEExt)=c("Árabe", "Asia", "Blanca", "Latinoamericana","Negra","Pérdidas")
rownames(EEExt)=Columnes

t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```

```{r 4,fig.cap="\\s"}
df =data.frame(
  Factor=c(rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Etnias=c(I,NI)
)
base=rep(levels(I) , each=2)
Grupo=rep(c("Infectada","No infectada") , length(levels(I)))
valor=as.vector(prop.table(table(df), margin=1))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=base , y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  scale_fill_brewer(palette = "Accent")+
  labs(fill = "Etnia")

```

```{r 5,fig.cap="\\s"}
df =data.frame(
  Factor=c(rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Etnias=c(I,NI)
)
base=rep(levels(I) , each=2)
Grupo=rep(c("Infectada","No infectada") , length(levels(I)))
valor=as.vector(prop.table(table(df), margin=2))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=Grupo, y=valor, x=base)) + 
  geom_bar(position="dodge", stat="identity")+
xlab("Etnias")+
  ylab("")

```


* Composiciones por edades de los grupos de casos y de controles: test $\chi^2$, p-valor  $`r signif(chisq.test(EE)$p.value,1)`$


En la tabla que sigue:

* p-valor ajustado: p-valores de tests de Fisher bilateral ajustados por Bonferroni calculados para la muestra sin pérdidas
* OR: la odds ratio univariante estimada de infectarse relativa a la etnia
* IC: el intervalo de confianza del 95% para la OR

```{r}
pp=rep(0,dim(EE)[2])
OR=rep(0,dim(EE)[2])
CI1=rep(0,dim(EE)[2])
CI2=rep(0,dim(EE)[2])

for (i in 1:dim(EE)[2]){
FT=fisher.test(rbind(c(EE[1,i],sum(EE[1,-i])),
                  c(EE[2,i],sum(EE[2,-i]))))
pp[i]=FT$p.value
OR[i]=round(FT$estimate,2)
CI1[i]=round(FT$conf.int[1],2)
CI2[i]=round(FT$conf.int[2],2)
                  }
pp=p.adjust(pp,method="bonferroni")
dt=data.frame(franja=c("Árabe", "Asia", "Blanca", "Latinoamericana","Negra"),pp,OR,CI1,CI2)
names(dt)=c("Franja","p-valor ajustado","OR","Extremo inferior de IC", "Extremo superior de IC")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```





### Hábito tabáquico (juntando fumadoras y ex-fumadoras en una sola categoría)



```{r}
I=Casos$FUMADORA_CAT
NI=Controls$Fumadora_cat
Tabla.DMG(I,NI,"No fumadora","Fumadora")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```


* Comparación de proporciones de fumadoras en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a ser fumadora, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]

<!--

### Tabaco v2: Separando fumadoras y ex-fumadoras


```{r}
I=Casos$Fumadora
NI=Controls$Fumadora
NI[NI=="0"]="No"
NI[NI=="1"]="Sí"
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
I=factor(I,levels=c("No","Ex-fumadora","Sí"))
NI=factor(NI,levels=c("No","Ex-fumadora","Sí"))


```

```{r}
dtbp=data.frame(c(rep("Infectadas",n_I-NA_I),rep("No infectadas",n_NI-NA_NI)),c(I[!is.na(I)],NI[!is.na(NI)]))
barplot(prop.table(table(dtbp), margin=1),beside=TRUE,col=c("pink","light blue"),legend.text=TRUE, main="Diagrama de barras de estatus de fumadora",ylab="Proporción",ylim=c(0,1))
```



```{r}
EE=rbind(as.vector(table(I)),
         as.vector(table(NI)))
EEExt=rbind(c(as.vector(table(I)),NA_I),
            round(100*c(as.vector(table(I)),NA_I)/n_I,1),
            c(as.vector(table(NI)),NA_NI),
            round(100*c(as.vector(table(NI)),NA_NI)/n_NI,1))

colnames(EEExt)=c("No fumadora", "Ex-fumadora","Fumadora", "Pérdidas")
rownames(EEExt)=Columnes

t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```

```{r}
FT=chisq.test(EE)
```

Hay diferencia estadísticamente significativa entre las distribuciones (test $\chi^2$, p-valor `r round(FT$p.value,3)`)


En la tabla que sigue:

* p-valor ajustado: el p-valor del test de Fisher ajustado por Bonferroni
* OR: la odds ratio univariante estimada de infectarse relativa al estatus de fumador
* IC: el intervalo de confianza del 95% para la OR


```{r}
pp=rep(0,dim(EE)[2])
OR=rep(0,dim(EE)[2])
CI1=rep(0,dim(EE)[2])
CI2=rep(0,dim(EE)[2])

for (i in 1:dim(EE)[2]){
FT=fisher.test(rbind(c(EE[2,i],sum(EE[2,-i])),
                  c(EE[1,i],sum(EE[1,-i]))))
pp[i]=round(FT$p.value,4)
OR[i]=round(FT$estimate,4)
CI1[i]=round(FT$conf.int[1],4)
CI2[i]=round(FT$conf.int[2],4)
                  }
pp=p.adjust(pp,method="bonferroni")
dt=data.frame(franja=c("No fumadora", "Ex-fumadora","Fumadora"),round(pp,4),OR,CI1,CI2)
names(dt)=c("Franja","p-valor ajustado","OR","Extremo inferior de IC", "Extremo superior de IC")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```

Diferencias estadísticamente significativas en fumadoras y en no fumadoras, pero no en ex-fumadoras


-->

### Obesidad 


```{r}
I=Casos$Obesidad
NI=Controls$Obesidad
Tabla.DMG(I,NI,"No obesa","Obesa")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```

* Comparación de proporciones de obesas en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a ser obesa, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]



### Hipertensión pregestacional


```{r}
I=Casos$Hipertensión.pregestacional
NI=Controls$Hipertensión.pregestacional
Tabla.DMG(I,NI,"No HTA","HTA")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```


* Comparación de proporciones de hipertensas en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a hipertensión pregestacional, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]



### Diabetes Mellitus 

```{r}
I=Casos$DIABETES
NI=Controls$Diabetes
Tabla.DMG(I,NI,"No DM","DM")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```


* Comparación de proporciones de diabéticas en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a diabetes mellitus, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]



### Enfermedades cardíacas crónicas 

```{r}
I=Casos$Enfermedad.cardiaca.crónica
NI=Controls$ENF.CARDIACA.TODO
Tabla.DMG(I,NI,"No ECC","ECC")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```

* Comparación de proporciones de ECC en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a enfermedades cardíacas crónicas , `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]



### Enfermedades pulmonares crónicas (incluyendo asma)

<!--

#### No Asma

```{r}
I=Casos$Enfermedad.pulmonar.crónica.no.asma
NI=Controls$Enfermedad.pulmonar.crónica.no.asma
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])


```


```{r}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
EEExt=rbind(c(as.vector(table(I))[2:1],NA_I),
            round(100*c(as.vector(table(I))[2:1],NA_I)/n_I,1),
            c(as.vector(table(NI))[2:1],NA_NI),
            round(100*c(as.vector(table(NI))[2:1],NA_NI)/n_NI,1))
rownames(EEExt)=Columnes
colnames(EEExt)=c("EPC", "No EPC","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r}
FT=fisher.test(EE)
```

* test de Fisher, p-valor `r round(FT$p.value,3)`; No hay diferencia estadísticamente significativa
* OR univariante estimada de infección relativa a  enfermedad pulmonar crónica  no asma `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]

#### Asma


```{r}
I=Casos$Diagnóstico.clínico.de.Asma
NI=Controls$Diagnóstico.clínico.de.Asma
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])


```


```{r}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
EEExt=rbind(c(as.vector(table(I))[2:1],NA_I),
            round(100*c(as.vector(table(I))[2:1],NA_I)/n_I,1),
            c(as.vector(table(NI))[2:1],NA_NI),
            round(100*c(as.vector(table(NI))[2:1],NA_NI)/n_NI,1))
rownames(EEExt)=Columnes
colnames(EEExt)=c("Asma", "No Asma","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r}
FT=fisher.test(EE)
```

* test de Fisher, p-valor `r round(FT$p.value,3)`; No hay diferencia estadísticamente significativa
* OR univariante estimada de infección relativa a  asma, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]


#### Total

-->


```{r,warning=FALSE}
INA=Casos$Enfermedad.pulmonar.crónica.no.asma
NINA=Controls$Enfermedad.pulmonar.crónica.no.asma
NINA[NINA==0]="No"
NINA[NINA==1]="Sí"
IA=Casos$Diagnóstico.clínico.de.Asma
NIA=Controls$Diagnóstico.clínico.de.Asma
NIA[NIA==0]="No"
NIA[NIA==1]="Sí"

I=rep(NA,n_I)
for (i in 1:n_I){I[i]=max(INA[i],IA[i],na.rm=TRUE)}
NI=rep(NA,n_NI)
for (i in 1:n_NI){NI[i]=max(NINA[i],NIA[i],na.rm=TRUE)}
NI[NI==-Inf]=NA
```

```{r}
Tabla.DMG(I,NI,"No EPC","EPC")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```


* Comparación de proporciones de ECP en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a enfermedad pulmonar crónica (incluyendo asma), `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]



### Paridad



```{r}
I=Casos$NULIPARA
NI=Controls$Nuliparous
Tabla.DMG(I,NI,"Multípara","Nulípara")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```


* Comparación de proporciones de nulíparas en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a ser nulípara, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]

<!--

**Cuidado**: La distribución de nulíparas-multíparas varía con la edad, las mayores son más frecuentemente multíparas, así que no concluyas que las multíparas en la población tienen mayor probabilidad de infección

```{r}
DFCa=data.frame(Casos[,c("Edad._años_","NULIPARA")])
names(DFCa)=c("Edad","Nuliparidad")
DFCa$FranjaEdad=cut(DFCa$Edad,breaks=c(0,30,40,100),labels=c("18-30","31-40",">40"))
DFCa$Infectada=1
DFCo=Controls[,c("Edad._años_","Nuliparous")]
names(DFCo)=c("Edad","Nuliparidad")
DFCo$FranjaEdad=cut(DFCo$Edad,breaks=c(0,30,40,100),labels=c("18-30","31-40",">40"))
DFCo$Infectada=0
DF=rbind(DFCa,DFCo)
DF$Nuliparidad[DF$Nuliparidad==0]="Multípara"
DF$Nuliparidad[DF$Nuliparidad==1]="Nulípara"
table(DF[,2:3]) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")

```


Hay diferencia estadísticamente dignificativa en las distribuciones por edades de nulíparas y multíparas (test $\chi^2$, p-valor $`r chisq.test(table(DF[,2:3]))$p.value`$)

--> 


## Embarazos



### Gestación múltiple



```{r}
I=Casos$Gestación.Múltiple
NI=Controls$Gestación.Múltiple
Tabla.DMG(I,NI,"Gestación única","Gestación múltiple")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```


* Comparación de proporciones de gestaciones múltiples en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a gestación múltiple, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]



### Anomalías congénitas


```{r}
I=Casos$Diagnóstico.de.malformación.ecográfica._.semana.20._
NI=Controls$Diagnóstico.de.malformación.ecográfica._.semana.20._
Tabla.DMG(I,NI,"No anomalía congénita","Anomalía congénita")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgos de anomalía congénita en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de anomalía congénita relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]



### Retraso del crecimiento intrauterino 


```{r}
I=Casos$Defecto.del.crecimiento.fetal..en.tercer.trimestre._.CIR._.
NI=Controls$Defecto.del.crecimiento.fetal..en.tercer.trimestre._.CIR._.
Tabla.DMG(I,NI,"No RCIU","RCIU")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgos de retraso del crecimiento intrauterino  en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de retraso del crecimiento intrauterino  relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]


### Diabetes gestacional 

```{r}
I=Casos$Diabetes.gestacional
NI=Controls$Diabetes.gestacional
Tabla.DMG(I,NI,"No DG","DG")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgo de diabetes gestacional en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de diabetes gestacional relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]



### Hipertensión gestacional 


```{r}
I=Casos$Hipertensión.gestacional
NI=Controls$Hipertensión.gestacional
Tabla.DMG(I,NI,"No HG","HG")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgo de hipertensión gestacional en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de hipertensión gestacional  relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]



### Preeclampsia 



```{r}
I=Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL
NI=Controls$PREECLAMPSIA
Tabla.DMG(I,NI,"No PE","PE")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgo de preeclampsia en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de preeclampsia relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]


### Preeclampsia con criterios de gravedad


```{r}
n_PI=sum(Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL)
n_PNI=sum(Controls$PREECLAMPSIA)
I=Casos[Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL==1,]$Preeclampsia.grave_HELLP_ECLAMPSIA

NI1=Controls[Controls$PREECLAMPSIA==1,]$preeclampsia_severa
NI2=Controls[Controls$PREECLAMPSIA==1,]$Preeclampsia.grave.No.HELLP 
NI=rep(NA,n_PNI)
for (i in 1:n_PNI){NI[i]=max(NI1[i],NI2[i],na.rm=TRUE)}

NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])

EEExt=rbind(c(as.vector(table(I)),NA_I),
            round(100*c(as.vector(table(I)),NA_I)/length(I),1),
            c(as.vector(table(NI)),NA_NI),
            round(100*c(as.vector(table(NI)),NA_NI)/length(NI),1))
rownames(EEExt)=Columnes

colnames(EEExt)=c("PE sin CG", "PE con CG","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo de PE con CG en preeclámpsicas infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de PE con CG en preeclámpsicas relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]



### Rotura prematura de membranas 



```{r}
I=Casos$Bolsa.rota.anteparto
NI=Controls$Bolsa.rota.anteparto
Tabla.DMG(I,NI,"No RPM","RPM")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgo de  rotura prematura de membranas en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de rotura prematura de membranas relativa a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(riskscoreci(544,1641,487,1594,conf.level=0.95)$conf.int,2)`]



### Edad gestacional en el momento del parto 


```{r}
I=Casos$EG_TOTAL_PARTO
NI=Controls$EDAD_GEST   
```


```{r}
Dades=rbind(c(min(I,na.rm=TRUE),max(I,na.rm=TRUE), round(mean(I,na.rm=TRUE),1),round(median(I,na.rm=TRUE),1),round(quantile(I,c(0.25,0.75),na.rm=TRUE),1), round(sd(I,na.rm=TRUE),1)),
            c(min(NI,na.rm=TRUE),max(NI,na.rm=TRUE), round(mean(NI,na.rm=TRUE),1),round(median(NI,na.rm=TRUE),1),round(quantile(NI,c(0.25,0.75),na.rm=TRUE),1),round(sd(NI,na.rm=TRUE),1)))

colnames(Dades)=c("Edad gest. mínima","Edad gest. máxima","Edad gest. media", "Edad gest. mediana", "1er cuartil", "3er cuartil", "Desv. típica")
rownames(Dades)=c("Infectadas", "No infectadas")

Dades %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")


```



```{r 6,fig.cap="\\s"}
data =data.frame(
  name=c( rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Edades=c( I,NI )
)

data %>%
  ggplot( aes(x=name, y=Edades, fill=name)) +
    geom_violin(width=1) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    theme(
      legend.position="none",
      plot.title = element_text(size=11)
    ) +
    xlab("")+
  ylab("Edades gestacionales (semanas)")
```




```{r,include=FALSE}
shapiro.test(I)$p.value
shapiro.test(NI)$p.value
fligner.test(list(I,NI))
ttest=t.test(I,NI)
```

* Ajuste de las edades gestacionales de infectadas y no infectadas a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I)$p.value,1)`$ y $`r 
signif(shapiro.test(NI)$p.value,1)`$, respectivamente

* Edades gestacionales medias: test t, p-valor $`r signif(ttest$p.value,1)`$, IC del 95% para la diferencia de medias [`r round(ttest$conf.int,2)`]

* Desviaciones típicas: test de Fligner-Killeen, p-valor $`r signif(fligner.test(list(I,NI))$p.value,1)`$


```{r,include=FALSE}
I=I[I>20]
shapiro.test(I)$p.value
shapiro.test(NI)$p.value
fligner.test(list(I,NI))
ttest=t.test(I,NI)
```

**Nota**: Como vemos en los boxplot, hay dos casos de infectadas con edades gestacionales incompatibles con la definición de "parto" (y que además luego tienen información incompatible con esto). Son `00133-00046` y `00268-00008`. Si las quitamos, las conclusiones son las mismas:

* Ajuste de las edades gestacionales de infectadas y no infectadas a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I)$p.value,1)`$ y $`r 
signif(shapiro.test(NI)$p.value,1)`$, respectivamente


* Edades medias: test t, p-valor $`r signif(ttest$p.value,1)`$, IC del 95% para la diferencia de medias [`r round(ttest$conf.int,2)`]

* Desviaciones típicas: test de Fligner-Killeen, p-valor $`r signif(fligner.test(list(I,NI))$p.value,1)`$





### Ingreso materno en  UCI



```{r}
I=Casos$UCI
NI=Controls$UCI...9
Tabla.DMG(I,NI,"No UCI","UCI")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgo de ingreso materno en UCI en infectadas y no infectadas: test de Fisher bilateral, p-valor $`r signif(FT$p.value,1)`; 

* RA estimado de UCI relativa a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]


### Ingreso materno en UCI según el momento del parto o cesárea


```{r}
UCI.I=sum(Casos$UCI,na.rm=TRUE)
UCI.NI=sum(Controls$UCI...9,na.rm=TRUE)
I=Casos$UCI_ANTES.DESPUES.DEL.PARTO
NI=Controls$UCI.ANTES.DEL.PARTO  #Vacía

EE=rbind(as.vector(table(I)),
         c(0,UCI.NI))
EEExt=rbind(c(as.vector(table(I)),0),
            round(100*c(as.vector(table(I)),0)/UCI.I,1),
            c(0,UCI.NI,0),
            c(0,100,0))
rownames(EEExt)=Columnes

colnames(EEExt)=c("UCI antes del parto", " UCI después del parto","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r,include=FALSE}
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo de UCI antes del parto en las ingresadas en UCI infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de UCI antes del parto en las ingresadas en UCI relativa a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: $`r round(PT$estimate[1]/PT$estimate[2],2)`$

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [$`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`$]


### Embarazos con algún feto muerto anteparto 


```{r,include=FALSE}
IGM=Casos[Casos$Gestación.Múltiple=="Sí", c("Feto.muerto.intraútero","Feto.vivo") ]
table(IGM)
# En todas las infectadas con parto múltiple de las que tenemos datos los dos estaban vivos
NIGM=Controls[Controls$Gestación.Múltiple==1, c("Feto.vivo...194","Feto.vivo...245") ]
table(NIGM)
# En las controles hubo un caso de gestación múltiple con un feto muerto
```



```{r}
I=Casos$Feto.muerto.intraútero
I[I=="Sí"]=1
I[I=="No"]=0
NI1=Controls$Feto.vivo...194
NI1[NI1=="Sí"]=0
NI1[NI1=="No"]=1
NI2=Controls$Feto.vivo...245
NI2[NI2=="Sí"]=0
NI2[NI2=="No"]=1
NI=NI1
for (i in 1:length(NI1)){NI[i]=max(NI1[i],NI2[i],na.rm=TRUE)}

Tabla.DMG(I,NI,"Ningún feto muerto anteparto","Algún feto muerto anteparto")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgo de algún feto muerto anteparto en infectadas y no infectadas: test de Fisher bilateral, p-valor $`r round(FT$p.value,5)`$; 

* RA estimado de algún feto muerto anteparto relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],4)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]





### Inicio del parto


```{r}
I=factor(Casos$Inicio.de.parto)
NI=Controls$Inicio.de.parto
NI[NI=="Cesárea programada"]="Cesárea"
NI=factor(NI)

NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
```

```{r}
EE=rbind(as.vector(table(I)),
         as.vector(table(NI)))
EEExt=rbind(c(as.vector(table(I))[c(2,3,1)],NA_I),
            round(100*c(as.vector(table(I))[c(2,3,1)],NA_I)/n_I,1),
            c(as.vector(table(NI))[c(2,3,1)],NA_NI),
            round(100*c(as.vector(table(NI))[c(2,3,1)],NA_NI)/n_NI,1))
colnames(EEExt)=c("Espontáneo", "Inducido", "Cesárea programada","Pérdidas")
rownames(EEExt)=Columnes

t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



```{r 7,fig.cap="\\s"}
df =data.frame(
  Factor=c( rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Inicios=ordered(c( I,NI ),levels=c("Espontáneo","Inducido","Cesárea"))
)

base=ordered(rep(c("Espontáneo","Inducido","Cesárea"), each=2),levels=c("Espontáneo","Inducido","Cesárea"))
Grupo=rep(c("Infectada","No infectada") , 3)
valor=c(as.vector(prop.table(table(df),margin=1))                 )
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=base, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+  
  ylab("")+
  scale_fill_brewer(palette = "Set3")+
  labs(fill = "Inicio de parto")
```


```{r 8,fig.cap="\\s"}
df =data.frame(
  Factor=c( rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Inicios=ordered(c( I,NI ),levels=c("Espontáneo","Inducido","Cesárea"))
)

base=ordered(rep(c("Espontáneo","Inducido","Cesárea"), each=2),levels=c("Espontáneo","Inducido","Cesárea"))
Grupo=rep(c("Infectada","No infectada") , 3)
valor=c(as.vector(prop.table(table(df),margin=2))                 )
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=Grupo, y=valor, x=base)) + 
  geom_bar(position="dodge", stat="identity")+  
  xlab("Inicios de parto")+
  ylab("")
```

```{r,include=FALSE}
FT=chisq.test(EE)
```


* Distribuciones de los inicios de parto en los grupos de infectadas y no infectadas: test $\chi^2$, p-valor $`r signif(chisq.test(EE)$p.value,1)`$


En la tabla que sigue:

* p-valor ajustado: p-valores de tests de Fisher bilateral ajustados por Bonferroni calculados para la muestra sin pérdidas
* RA y RR: riesgos absoluto y relativo estimados del inicio de parto relativos a la infección
* IC-RA e IC-RR: sus intervalos de confianza del 95% respectivos

```{r}
pp=rep(0,dim(EE)[2])
RA=rep(0,dim(EE)[2])
RR=rep(0,dim(EE)[2])
CIRA1=rep(0,dim(EE)[2])
CIRA2=rep(0,dim(EE)[2])
CIRR1=rep(0,dim(EE)[2])
CIRR2=rep(0,dim(EE)[2])

for (i in 1:dim(EE)[2]){
EE.temp=rbind(c(EE[1,i],sum(EE[1,-i])),
                  c(EE[2,i],sum(EE[2,-i])))
FT=fisher.test(EE.temp)
PT=prop.test(EE.temp[,1],rowSums(EE.temp))
pp[i]=FT$p.value
RA[i]=round(PT$estimate[1]-PT$estimate[2],3)
RR[i]=round(PT$estimate[1]/PT$estimate[2],3)
CIRA1[i]=round(PT$conf.int,4)[1]
CIRA2[i]=round(PT$conf.int,4)[2]
CIRR1[i]=round(RelRisk(EE.temp,conf.level=0.95,method="wald"),3)[2]
CIRR2[i]=round(RelRisk(EE.temp,conf.level=0.95,method="wald"),3)[3]
            }
pp=p.adjust(pp,method="bonferroni")
#> pp[c(2,3,1)]
#[1] 3.046147e-08 5.563602e-03 1.110478e-06
dt=data.frame(franja=c("Espontáneo", "Inducido", "Cesárea programada"),pp[c(2,3,1)],RA[c(2,3,1)],RR[c(2,3,1)],CIRA1[c(2,3,1)],CIRA2[c(2,3,1)],CIRR1[c(2,3,1)],CIRR2[c(2,3,1)])
names(dt)=c("Inicio de parto","p-valor ajustado","RA", "RR", "Extr. inf. de ICRA", "Extr. sup. de ICRA", "Extr. inf. de ICRR", "Extr. sup. de ICRR")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


### Tipo de parto


```{r}
I.In=Casos$Inicio.de.parto
I.In[I.In=="Cesárea"]="Cesárea programada"
I=Casos$Tipo.de.parto
I[I.In=="Cesárea programada"]="Cesárea programada"
I[I=="Cesárea"]="Cesárea urgente"
I[I=="Eutocico"]="Eutócico"

NI.In=Controls$Inicio.de.parto
NI=Controls$Tipo.de.parto
NI[NI.In=="Cesárea programada"]="Cesárea programada"
NI[NI=="Cesárea"]="Cesárea urgente"
NI[NI=="Eutocico"]="Eutócico"

NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])


```

```{r}
EE=rbind(as.vector(table(I))[c(3,4,1,2)],
         as.vector(table(NI))[c(3,4,1,2)])
EEExt=rbind(c(as.vector(table(I))[c(3,4,1,2)],NA_I),
            round(100*c(as.vector(table(I))[c(3,4,1,2)],NA_I)/n_I,1),
            c(as.vector(table(NI))[c(3,4,1,2)],NA_NI),
            round(100*c(as.vector(table(NI))[c(3,4,1,2)],NA_NI)/n_NI,1))
colnames(EEExt)=c("Eutócico", "Instrumental", "Cesárea programada", "Cesárea urgente", "Pérdidas")
rownames(EEExt)=Columnes

t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```




```{r 9,fig.cap="\\s"}
df =data.frame(
  Factor=c( rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Inicios=ordered(c( I,NI ),levels=c("Eutócico", "Instrumental", "Cesárea programada", "Cesárea urgente"))
)

base=ordered(rep(c("Eutócico", "Instrumental", "Cesárea prog.", "Cesárea urg."), each=2),levels=c("Eutócico", "Instrumental", "Cesárea prog.", "Cesárea urg."))
Grupo=rep(c("Infectada","No infectada") , 4)
valor=c(as.vector(prop.table(table(df),margin=1))                 )
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=base, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+  
  ylab("")+
  scale_fill_brewer(palette = "Set3")+
  labs(fill = "Tipo de parto")
```

```{r 10,fig.cap="\\s"}
df =data.frame(
  Factor=c( rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Inicios=ordered(c( I,NI ),levels=c("Eutócico", "Instrumental", "Cesárea programada", "Cesárea urgente"))
)

base=ordered(rep(c("Eutócico", "Instrumental", "Cesárea prog.", "Cesárea urg."), each=2),levels=c("Eutócico", "Instrumental", "Cesárea prog.", "Cesárea urg."))
Grupo=rep(c("Infectada","No infectada") , 4)
valor=as.vector(prop.table(table(df), margin=2))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=Grupo, y=valor, x=base)) + 
  geom_bar(position="dodge", stat="identity")+  
  xlab("Tipos de parto")+
  ylab("")
```




```{r,include=FALSE}
FT=chisq.test(EE)
```

* Distribuciones de los tipos de parto en los grupos de infectadas y no infectadas: test $\chi^2$, p-valor $`r signif(chisq.test(EE)$p.value,1)`$



En la tabla que sigue:

* p-valor ajustado: p-valores de tests de Fisher bilateral ajustados por Bonferroni calculados para la muestra sin pérdidas
* RA y RR: riesgos absoluto y relativo estimados del tipo de parto relativos a la infección
* IC-RA e IC-RR: sus intervalos de confianza del 95% respectivos

```{r}
pp=rep(0,dim(EE)[2])
RA=rep(0,dim(EE)[2])
RR=rep(0,dim(EE)[2])
CIRA1=rep(0,dim(EE)[2])
CIRA2=rep(0,dim(EE)[2])
CIRR1=rep(0,dim(EE)[2])
CIRR2=rep(0,dim(EE)[2])

for (i in 1:dim(EE)[2]){
EE.temp=rbind(c(EE[1,i],sum(EE[1,-i])),
                  c(EE[2,i],sum(EE[2,-i])))
FT=fisher.test(EE.temp)
PT=prop.test(EE.temp[,1],rowSums(EE.temp))
pp[i]=FT$p.value
RA[i]=round(PT$estimate[1]-PT$estimate[2],3)
RR[i]=round(PT$estimate[1]/PT$estimate[2],3)
CIRA1[i]=round(PT$conf.int,4)[1]
CIRA2[i]=round(PT$conf.int,4)[2]
CIRR1[i]=round(RelRisk(EE.temp,conf.level=0.95,method="wald"),3)[2]
CIRR2[i]=round(RelRisk(EE.temp,conf.level=0.95,method="wald"),3)[3]
            }
pp=p.adjust(pp,method="bonferroni")
dt=data.frame(franja=c("Eutócico", "Instrumental", "Cesárea programada", "Cesárea urgente"),pp,RA,RR,CIRA1,CIRA2,CIRR1,CIRR2)
names(dt)=c("Tipo de parto","p-valor ajustado","RA", "RR", "Extr. inf. de ICRA", "Extr. sup. de ICRA", "Extr. inf. de ICRR", "Extr. sup. de ICRR")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


### Prematuridad 



```{r}
I=Casos$PREMATURO
NI=Controls$Preterm.deliveries
Tabla.DMG(I,NI,"No prematuro","Prematuro")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgo de prematuridad en infectadas y no infectadas: test de Fisher bilateral, p-valor $`r signif(FT$p.value,1)`$; 

* RA estimado de prematuridad relativa a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]





### Eventos trombóticos



```{r}
I=Casos$EVENTOS_TROMBO_TOTALES
NI1=Controls$DVT
NI2=Controls$PE
NI=rep(NA,n_NI)
for (i in 1:n_NI){NI[i]=max(NI1[i],NI2[i],na.rm=TRUE)}
Tabla.DMG(I,NI,"No eventos trombóticos","Eventos trombóticos")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgo de evento trombótico en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de evento trombótico relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [$`r round(PT$conf.int,4)`$] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]




### Eventos hemorrágicos




```{r}
I=Casos$EVENTOS_HEMORRAGICOS_TOTAL
NI=Controls$eventos_hemorragicos
Tabla.DMG(I,NI,"No eventos heomorrágicos","Eventos hemorrágicos")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```


* Comparación de riesgo de evento hemorrágico en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de evento hemorrágico relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]


### Hemorragias postparto



```{r}
I=Casos$Hemorragia.postparto
I.sino=I
I.sino[!is.na(I.sino)& I.sino!="No"]="Sí"
I=ordered(I,levels=names(table(I))[c(4,2,3,1)])


NI=Controls$Hemorragia.postparto
NI.sino=NI
NI.sino[!is.na(NI.sino)& NI.sino!="No"]="Sí"
NI=ordered(NI,levels=names(table(NI))[c(4,2,3,1)])
Tabla.DMG(I.sino,NI.sino,"No HPP","HPP")
```


```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo de hemorragia postparto en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de hemorragia postparto relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],4)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="wald")[2:3],2)`]




```{r}
EE=rbind(as.vector(table(I)),
         as.vector(table(NI)))
EEExt=rbind(c(as.vector(table(I)),NA_I),
            round(100*c(as.vector(table(I)),NA_I)/n_I,1),
            c(as.vector(table(NI)),NA_NI),
            round(100*c(as.vector(table(NI)),NA_NI)/n_NI,1))
colnames(EEExt)=c(names(table(I)), "Pérdidas")
rownames(EEExt)=Columnes

t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```

```{r 11,fig.cap="\\s"}
df =data.frame(
  Factor=c( rep("Infectadas",length(I[I!="No"])), rep("No infectadas",length(NI[NI!="No"]))),
  Hemos=ordered(c( I[I!="No"],NI[NI!="No"] ),levels=names(table(I))[-1])
)

base=ordered(rep(c("Tto. médico", "Tto. Qx conservador", "Histerectomía"), each=2),levels=c("Tto. médico", "Tto. Qx conservador", "Histerectomía"))
Grupo=rep(c("Infectada","No infectada") , 3)
valor=as.vector(prop.table(table(df), margin=1))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=Grupo, y=valor, x=base)) + 
  geom_bar(position="dodge", stat="identity")+  
  xlab("Tratamientos de hemorragia postparto")+
  ylab("")
```



```{r,include=FALSE}
FT1=chisq.test(EE,simulate.p.value=TRUE,B=10000)
I=Casos$Hemorragia.postparto
I=I[I!="No"]
I=I[!is.na(I)]
NI=Controls$Hemorragia.postparto
NI=NI[NI!="No"]
NI=NI[!is.na(NI)]
EE=rbind(as.vector(table(I)),
         as.vector(table(NI)))
FT2=chisq.test(EE,simulate.p.value=TRUE,B=10000)
```

* Distribuciones de los tipos de hemorragia postparto (incluyendo Noes) en los grupos de infectadas y no infectadas: test $\chi^2$ de Montercarlo, p-valor `r round(FT1$p.value,2)`

* Distribuciones de los tipos de hemorragia postparto en los grupos de infectadas y no infectadas que tuvieron hemorragia postparto:  test $\chi^2$ de Montercarlo, p-valor `r round(FT2$p.value,2)`







## Neonatos



### Fetos muertos anteparto 



```{r}
I1=Casos$Feto.muerto.intraútero
I1[I1=="Sí"]="Muerto"
I1[I1=="No"]="Vivo"
I2=CasosGM$Feto.vivo
I2[I2=="Sí"]="Vivo"
I2[I2=="No"]="Muerto"
I=c(I1,I2)

n_IFT=length(I)
n_VI=as.vector(table(I))[2]
```


```{r}
NI1=Controls$Feto.vivo...194
NI2=ControlsGM$Feto.vivo...245
NI=c(NI1,NI2)
NI[NI=="Sí"]="Vivo"
NI[NI=="No"]="Muerto"
n_NIFT=length(NI)
n_VNI=as.vector(table(NI))[2]
```


```{r}
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
EE=rbind(as.vector(table(I)),
         as.vector(table(NI)))
EEExt=rbind(c(as.vector(table(I)),NA_I,n_IFT),
            round(100*c(as.vector(table(I)),NA_I,n_IFT)/n_IFT,1),
            c(as.vector(table(NI)),NA_NI,n_NIFT),
            round(100*c(as.vector(table(NI)),NA_NI,n_NIFT)/n_NIFT,1))
rownames(EEExt)=Columnes

colnames(EEExt)=c("Feto muerto anteparto", "Feto vivo","Pérdidas", "Total Fetos")


t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r,include=FALSE}
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo de muerte anteparto en fetos de infectadas y de no infectadas: test de Fisher bilateral, p-valor $`r signif(FT$p.value,1)`$; 

* RA estimado de muerte anteparto relativo a infección de madre: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]




### Peso de neonatos al nacimiento




```{r}
I=c(Casos[Casos$Feto.muerto.intraútero=="No",]$Peso._gramos_...125,CasosGM[CasosGM$Feto.vivo=="Sí",]$Peso._gramos_...148)
NI=c(Controls[Controls$Feto.vivo...194=="Sí",]$Peso._gramos_...198,ControlsGM[ControlsGM$Feto.vivo...245=="Sí",]$Peso._gramos_...247)
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
```

```{r 12,fig.cap="\\s"}
data =data.frame(
  name=c(rep("Hijos de infectadas",length(I)), rep("Hijos de no infectadas",length(NI))),
  Pesos=c(I,NI)
  )

sample_size = data %>% group_by(name) %>% summarize(num=n())

data %>%
 left_join(sample_size) %>%
  mutate(myaxis = paste0(name, "\n", "n=", num)) %>%
  ggplot( aes(x=myaxis, y=Pesos, fill=name)) +
    geom_violin(width=0.9) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    theme(
      legend.position="none",
      plot.title = element_text(size=11)
    ) +
    xlab("")+
  ylab("Pesos (gramos)")
```



```{r}
Dades=rbind(c(min(I,na.rm=TRUE),max(I,na.rm=TRUE), round(mean(I,na.rm=TRUE),1),round(median(I,na.rm=TRUE),1),round(quantile(I,c(0.25,0.75),na.rm=TRUE),1), round(sd(I,na.rm=TRUE),1)),
            c(min(NI,na.rm=TRUE),max(NI,na.rm=TRUE), round(mean(NI,na.rm=TRUE),1),round(median(NI,na.rm=TRUE),1),round(quantile(NI,c(0.25,0.75),na.rm=TRUE),1),round(sd(NI,na.rm=TRUE),1)))

colnames(Dades)=c("Peso mínimo","Peso máximo","Peso medio", "Peso mediano", "1er cuartil", "3er cuartil", "Desv. típica")
rownames(Dades)=c("Infectadas", "No infectadas")

Dades %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")


```



```{r,include=FALSE}
shapiro.test(I)$p.value
shapiro.test(NI)$p.value
fligner.test(list(I,NI))
ttest=t.test(I,NI)
```

* Ajuste de los pesos de hijos de infectadas y no infectadas a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I)$p.value,1)`$ y $`r 
signif(shapiro.test(NI)$p.value,1)`$, respectivamente

* Pesos medios: test t, p-valor `r round(ttest$p.value,4)`, IC del 95% para la diferencia de medias [`r round(ttest$conf.int,2)`] 

* Desviaciones típicas: test de Fligner-Killeen, p-valor  `r round(fligner.test(list(I,NI))$p.value,4)`

Definimos **bajo peso** a peso menor o igual a 2500 g. Un `r round(100*length(c(I,NI)[!is.na(c(I,NI)) & c(I,NI)<2500])/length(c(I,NI)[!is.na(c(I,NI))]),2)`% del total de neonatos no muesrtos anteparto son  de bajo peso con esta definición.



```{r}
I=I[!is.na(I)]
NI=NI[!is.na(NI)]
I.cut=cut(I,breaks=c(0,2500,10000),labels=c(1,0),right=FALSE)
NI.cut=cut(NI,breaks=c(0,2500,10000),labels=c(1,0),right=FALSE)


EE=rbind(as.vector(table(I.cut)),
         as.vector(table(NI.cut)))
EEExt=rbind(c(as.vector(table(I.cut)),NA_I),
            round(100*c(as.vector(table(I.cut)),NA_I)/length(I),1),
            c(as.vector(table(NI.cut)),NA_NI),
            round(100*c(as.vector(table(NI.cut)),NA_NI)/length(NI),1))
rownames(EEExt)=Columnes

colnames(EEExt)=c("Bajo peso", "No bajo peso","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



```{r,include=FALSE}
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo de bajo peso en hijos de madres infectadas y  no infectadas: test de Fisher bilateral, p-valor $`r signif(FT$p.value,1)`$; 

* RA estimado de bajo peso relativo a infección de madre: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]









###  Apgar


```{r}
I=c(Casos$APGAR.5...126,CasosGM$APGAR.5...150)
I[I==19]=NA
NI=c(Controls$APGAR.5...200,ControlsGM$APGAR.5...249)
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])

I.5=cut(I,breaks=c(-1,7,20),labels=c("0-7","8-10"))
NI.5=cut(NI,breaks=c(-1,7,20),labels=c("0-7","8-10"))
EE=rbind(as.vector(table(I.5)),
         as.vector(table(NI.5)))
EEExt=rbind(c(as.vector(table(I.5)),NA_I),
            round(100*c(as.vector(table(I.5)),NA_I)/length(I),1),
            c(as.vector(table(NI.5)),NA_NI),
            round(100*c(as.vector(table(NI.5)),NA_NI)/length(NI),1))
rownames(EEExt)=Columnes

colnames(EEExt)=c("Apgar.5≤7", "Apgar.5≥8","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



```{r,include=FALSE}
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo de Apgar.5≤7  en hijos de madres infectadas y  no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,3)`; 

* RA estimado de Apgar.5≤7  relativo a infección de madre: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]





### Ingreso de neonatos vivos en UCIN

```{r}
I=c(Casos[Casos$Feto.muerto.intraútero=="No",]$Ingreso.en.UCIN,CasosGM[CasosGM$Feto.vivo=="Sí",]$Ingreso.en.UCI)
NI=c(Controls[Controls$Feto.vivo...194=="Sí",]$Ingreso.en.UCI...213,ControlsGM[ControlsGM$Feto.vivo...245=="Sí",]$Ingreso.en.UCI...260)
n_IU=length(I)
n_NIU=length(NI)
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])


```


```{r}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
EEExt=rbind(c(as.vector(table(I))[2:1],NA_I),
            round(100*c(as.vector(table(I))[2:1],NA_I)/n_IU,1),
            c(as.vector(table(NI))[2:1],NA_NI),
            round(100*c(as.vector(table(NI))[2:1],NA_NI)/n_NIU,1))
rownames(EEExt)=Columnes

colnames(EEExt)=c("UCIN", "No UCIN ","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



```{r,include=FALSE}
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo de ingreso en UCIN  en hijos de madres infectadas y  no infectadas: test de Fisher bilateral, p-valor $`r signif(FT$p.value,1)`$; 

* RA estimado de ingreso en UCIN relativo a infección de madre: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]

## Descripción de casos por sintomatología


```{r sint,fig.cap="\\s"}
Síntomas=ordered(c("Asintomática", "Leve", "Grave"),levels=c("Asintomática", "Leve", "Grave"))
valor=as.vector(prop.table(table(Sint)))
data <- data.frame(Síntomas,valor)

ggplot(data, aes(x=Síntomas, y=valor,fill=Síntomas)) + 
  geom_bar(stat="identity")+
  xlab("")+
  ylab("")+
  scale_fill_brewer(palette = "Dark2") +
  theme(legend.position="none")
```




### Trimestre de infección

```{r}
Trim=Casos$Trim.Diag
NA_T=length(Trim[is.na(Trim)])
NA_S=length(Sint[is.na(Sint)])

DF=data.frame(Trimestre=Trim,Síntomas=Sint)
taula=table(DF)[,1:3]
proptaula=round(100*prop.table(table(DF)),2)[,1:3]

EEExt=cbind(c(as.vector(taula[,1]),sum(taula[,1])),
            c(as.vector(proptaula[,1]), round(100*sum(taula[,1])/n_I,2)),
            c(as.vector(taula[,2]),sum(taula[,2])),
            c(as.vector(proptaula[,2]), round(100*sum(taula[,2])/n_I,2)),
            c(as.vector(taula[,3]),sum(taula[,3])),
            c(as.vector(proptaula[,3]), round(100*sum(taula[,3])/n_I,2))
            )
rownames(EEExt)=c("1er trimestre", "2o trimestre", "3er trimestre","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



```{r 13,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=3),levels=c("Asintomática", "Leve", "Grave"))
Grupo=rep(c("1er trimestre", "2o trimestre", "3er trimestre") , 3)
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  xlab("Trimestre de infección")+
  ylab("")+
  scale_fill_brewer(palette = "Dark2") 
```



### Sintomatología vs edad



```{r}
I=Casos$Edad._años_
DF=data.frame(Edad=I,Sint=Casos$SINTOMAS_DIAGNOSTICO)



DF %>%
  ggplot( aes(x=Sint, y=Edad, fill=Sint)) +
    geom_violin(width=1) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    theme(
      legend.position="none",
      plot.title=element_text(size=11)
    ) +
    xlab("")+
  ylab("Edades (años)")+
 scale_fill_brewer(palette="Dark2")
```

```{r}
I1=I[Casos$SINTOMAS_DIAGNOSTICO=="Asintomática"]
I2=I[Casos$SINTOMAS_DIAGNOSTICO=="Leve"]
I3=I[Casos$SINTOMAS_DIAGNOSTICO=="Grave"]

Dades=rbind(c(round(min(I1,na.rm=TRUE),1),round(max(I1,na.rm=TRUE),1), round(mean(I1,na.rm=TRUE),1),round(median(I1,na.rm=TRUE),1),round(quantile(I1,c(0.25,0.75),na.rm=TRUE),1), round(sd(I1,na.rm=TRUE),1)),
            c(round(min(I2,na.rm=TRUE),1),round(max(I2,na.rm=TRUE),1), round(mean(I2,na.rm=TRUE),1),round(median(I2,na.rm=TRUE),1),round(quantile(I2,c(0.25,0.75),na.rm=TRUE),1), round(sd(I2,na.rm=TRUE),1)),
            c(round(min(I3,na.rm=TRUE),1),round(max(I3,na.rm=TRUE),1), round(mean(I3,na.rm=TRUE),1),round(median(I3,na.rm=TRUE),1),round(quantile(I3,c(0.25,0.75),na.rm=TRUE),1), round(sd(I3,na.rm=TRUE),1)))

colnames(Dades)=c("Edad mínima","Edad máxima","Edad  media", "Edad  mediana", "1er cuartil", "3er cuartil", "Desv. típica")
rownames(Dades)=c("Asintomática", "Leve","Grave")

Dades %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")


```


```{r,include=FALSE}

shapiro.test(I1)$p.value
shapiro.test(I2)$p.value
shapiro.test(I3)$p.value

kruskal.test(Edad~Sint,data=DF)$p.value

pairwise.wilcox.test(I,Sint,p.adjust.method = "bonferroni")$p.value
```

* Ajuste de las edades maternas a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I1)$p.value,1)`$, $`r 
signif(shapiro.test(I2)$p.value,1)`$ y `r 
round(shapiro.test(I3)$p.value,4)`, respectivamente




* Edades medias: test de Kruskal-Wallis, p-valor `r kruskal.test(Edad~Sint,data=DF)$p.value`


* Desviaciones típicas: test de Fligner-Killeen, p-valor  `r round(fligner.test(list(I,I2,I3))$p.value,3)`

* Contrastes post hoc por parejas

```{r}
Contraste=c("Asíntomatica vs Leve","Asíntomatica vs Grave", "Leve vs Grave")

pvals=round(3*c(t.test(I1,I2,var.equal=TRUE)$p.value, t.test(I1,I3,var.equal=TRUE)$p.value,
            t.test(I2,I3,var.equal=TRUE)$p.value),4)
dades=data.frame(Contraste=Contraste,"p-valor"=pvals)
dades %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")

```



```{r}
I.cut=cut(I,breaks=c(0,30,40,100),labels=c("18-30","31-40",">40"))
DF=data.frame(Edad=I.cut,Síntomas=Sint)

taula=table(DF)[,1:3]
proptaula=round(100*prop.table(taula,margin=2),2)
EEExt=cbind(
            c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1])))/n_AS,2),
            c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2])))/n_SL,2),
             c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3])))/n_NE,2)
           )
EEExt=rbind(EEExt,c(n_AS,100,n_SL,100,n_NE,100))

rownames(EEExt)=c("18-30", "31-40", ">40","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint
EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r 14,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=3),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(c("18-30","31-40",">40") , 3),levels=c("18-30","31-40",">40"))
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  xlab("Edad")+
  ylab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y las franjas de edad: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`

* Tabla de p-valores  ajustados por Bonferroni de tests de diferencia en la tendencia de la gravedad en cada franja de edad respecto del global: 


```{r}
EE=taula
ppTR=rep(0,dim(EE)[1])
for (i in 1:dim(EE)[1]){
ppTR[i]=Prop.trend.test(EE[i,],colSums(EE))
}
ppTR=p.adjust(ppTR,method="bonferroni")
dt=data.frame(franja=c("18-30","31-40",">40"),ppTR)
names(dt)=c("Franja","p-valor trend test (ajustado)")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



### Sintomatología vs etnia 





```{r}
I=Casos$Etnia

DF=data.frame(Etnia=I,Síntomas=Sint)
taula=table(DF)[c(1,2,3,4,5),1:3]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1])))/n_AS,2),
            c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2])))/n_SL,2),
             c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3])))/n_NE,2)
           )
EEExt=rbind(EEExt,c(n_AS,100,n_SL,100,n_NE,100))
rownames(EEExt)=c("Árabe", "Asia", "Blanca", "Latinoamericana","Negra","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r 15,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=5),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(c("Árabe", "Asia", "Blanca", "Latinoamericana","Negra") , 3),levels=c("Árabe", "Asia", "Blanca", "Latinoamericana","Negra"))
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  xlab("Etnia")+
  ylab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y las etnias: test $\chi^2$, p-valor $`r signif(chisq.test(taula)$p.value,1)`$

* Tabla de p-valores  ajustados por Bonferroni de tests de diferencia en la tendencia de la gravedad en cada franja de edad respecto del global: 


```{r}
EE=taula
ppTR=rep(0,dim(EE)[1])
for (i in 1:dim(EE)[1]){
ppTR[i]=chisq.test(rbind(EE[i,],colSums(EE)))$p.value
}
ppTR=p.adjust(ppTR,method="bonferroni")
dt=data.frame(franja=c("Árabe", "Asia", "Blanca", "Latinoamericana","Negra"),ppTR)
names(dt)=c("Etnia", "p-valor trend test (ajustado)")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```






### Sintomatología vs estatus de fumadora


```{r 16,fig.cap="\\s"}
taula=table(data.frame(Casos$FUMADORA_CAT,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$FUMADORA_CAT,"Fumadoras", "No fumadoras")
Barplot.DGS(Casos$FUMADORA_CAT,"Fumadoras", "No fumadoras")
```




* Asociación entre los grupos de sintomatología y el hábito tabáquico: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`


### Sintomatología vs obesidad



```{r 17,fig.cap="\\s"}
taula=table(data.frame(Casos$Obesidad,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$Obesidad,"Obesas", "No obesas")
Barplot.DGS(Casos$Obesidad,"Obesas", "No obesas")
```




* Asociación entre los grupos de sintomatología y la obesidad: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`


### Sintomatología vs hipertensión pregestacional



```{r 18,fig.cap="\\s"}
taula=table(data.frame(Casos$Hipertensión.pregestacional,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$Hipertensión.pregestacional,"HTA", "No HTA")
Barplot.DGS(Casos$Hipertensión.pregestacional,"HTA", "No HTA")
```


* Asociación entre los grupos de sintomatología y la HTA: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`

### Sintomatología vs diabetes



```{r 19,fig.cap="\\s"}
taula=table(data.frame(Casos$DIABETES,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$DIABETES,"DM", "No DM")
Barplot.DGS(Casos$DIABETES,"DM", "No DM")
```




* Asociación entre los grupos de sintomatología y la diabetes: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`

### Sintomatología vs cardiopatía



```{r 20,fig.cap="\\s"}
taula=table(data.frame(Casos$Enfermedad.cardiaca.crónica,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$Enfermedad.cardiaca.crónica,"ECC", "No ECC")
Barplot.DGS(Casos$Enfermedad.cardiaca.crónica,"ECC", "No ECC")
```



* Asociación entre los grupos de sintomatología y  ECC: test $\chi^2$ de Montecarlo, p-valor `r round(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`

### Sintomatología vs enfermedad pulmonar crónica 



```{r 21,fig.cap="\\s"}
INA=Casos$Enfermedad.pulmonar.crónica.no.asma
IA=Casos$Diagnóstico.clínico.de.Asma
I.EPC=rep(NA,length(Sint))
for (i in 1:length(Sint)){I.EPC[i]=max(INA[i],IA[i],na.rm=TRUE)}
taula=table(data.frame(I.EPC,Sint))[c(2,1) ,1:3]
Tabla.DGS(I.EPC,"EPC", "No EPC")
Barplot.DGS(I.EPC,"EPC", "No EPC")
```



* Asociación entre los grupos de sintomatología y EPC: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`

### Sintomatologia vs gestación múltiple



```{r 22,fig.cap="\\s"}
taula=table(data.frame(Casos$Gestación.Múltiple,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$Gestación.Múltiple,"Gestación múltiple", "Gestación única")
Barplot.DGS(Casos$Gestación.Múltiple,"Gestación múltiple", "Gestación única")
```


* Asociación entre los grupos de sintomatología y gestación múltiple: test $\chi^2$ , p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`

### Sintomatologia vs paridad



```{r 23,fig.cap="\\s"}
taula=table(data.frame(Casos$NULIPARA,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$NULIPARA,"Multípara", "Nulípara")
Barplot.DGS(Casos$NULIPARA,"Multípara", "Nulípara")
```



* Asociación entre los grupos de sintomatología y paridad: test $\chi^2$ , p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`

### Sintomatología vs anomalía congénita





```{r 24, fig.cap="\\s"}
taula=table(data.frame(Casos$Diagnóstico.de.malformación.ecográfica._.semana.20._,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$Diagnóstico.de.malformación.ecográfica._.semana.20._,"Anomalías congénitas", "No anomalías congénitas")
Barplot.DGS(Casos$Diagnóstico.de.malformación.ecográfica._.semana.20._,"Anomalías congénitas", "No anomalías congénitas")
```



* Asociación entre los grupos de sintomatología y anomalía congénita: test $\chi^2$ de Montecarlo, p-valor `r round(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`

* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`

### Sintomatología vs retraso del crecimiento intrauterino 





```{r 25,fig.cap="\\s"}
taula=table(data.frame(Casos$Defecto.del.crecimiento.fetal..en.tercer.trimestre._.CIR._.,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$Defecto.del.crecimiento.fetal..en.tercer.trimestre._.CIR._.,"RCIU", "No RCIU")
Barplot.DGS(Casos$Defecto.del.crecimiento.fetal..en.tercer.trimestre._.CIR._.,"RCIU", "No RCIU")
```




* Asociación entre los grupos de sintomatología y retraso del crecimiento intrauterino : test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`

* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`

### Sintomatología vs diabetes gestacional 




```{r 26,fig.cap="\\s"}
taula=table(data.frame(Casos$Diabetes.gestacional,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$Diabetes.gestacional,"DG", "No DG")
Barplot.DGS(Casos$Diabetes.gestacional,"DG", "No DG")
```




* Asociación entre los grupos de sintomatología y diabetes gestacional: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`

* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`

### Sintomatología vs hipertensión gestacional



```{r 27,fig.cap="\\s"}
taula=table(data.frame(Casos$Hipertensión.gestacional,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$Hipertensión.gestacional,"HG", "No HG")
Barplot.DGS(Casos$Hipertensión.gestacional,"HG", "No HG")
```




* Asociación entre los grupos de sintomatología e hipertensión gestacional: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`

* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`

### Sintomatología vs rotura prematura de membranas


```{r 28,fig.cap="\\s"}
taula=table(data.frame(Casos$Bolsa.rota.anteparto,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$Bolsa.rota.anteparto,"RPM", "No RPM")
Barplot.DGS(Casos$Bolsa.rota.anteparto,"RPM", "No RPM")
```




* Asociación entre los grupos de sintomatología y rotura prematura de membranas: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`

### Sintomatología vs preeclampsia




```{r 29,fig.cap="\\s"}
taula=table(data.frame(Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL,Sint))[c(2,1) ,1:3]

Tabla.DGS(Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL,"PE", "No PE")
Barplot.DGS(Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL,"PE", "No PE")
```






* Asociación entre los grupos de sintomatología y preeclampsia: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`

### Sintomatología vs preeclampsia con criterios de gravedad




```{r}
n_PI=sum(Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL)
I=Casos[Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL==1,]$Preeclampsia.grave_HELLP_ECLAMPSIA
DF=data.frame(Factor=I,Síntomas=Sint[Casos$PREECLAMPSIA_ECLAMPSIA_TOTAL==1])

taula=table(DF)[c(2,1),1:3]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(as.vector(taula[,1]),
            round(100*as.vector(prop.table(taula[,1])),2),
            as.vector(taula[,2]),
            round(100*as.vector(prop.table(taula[,2])),2),
             as.vector(taula[,3]),
            round(100*as.vector(prop.table(taula[,3])),2)
           )
EEExt=rbind(EEExt)

rownames(EEExt)=c("PE con CG", "PE sin CG")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r 30,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=2),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(rownames(EEExt)[1:2] , 3),levels=rownames(EEExt)[1:2])
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y preeclampsia con CG en preeclampsia: test $\chi^2$, p-valor `r round(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,3)`

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`


### Sintomatología vs eventos hemorrágicos




```{r 31,fig.cap="\\s"}
taula=table(data.frame(Casos$EVENTOS_HEMORRAGICOS_TOTAL,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$EVENTOS_HEMORRAGICOS_TOTAL,"Eventos hemorrágicos", "No eventos hemorrágicos")
Barplot.DGS(Casos$EVENTOS_HEMORRAGICOS_TOTAL,"Eventos hemorrágicos", "No eventos hemorrágicos")
```




* Asociación entre los grupos de sintomatología y evento hemorrágico: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`

### Sintomatología vs hemorragia postparto



```{r 59,fig.cap="\\s"}
I=Casos$Hemorragia.postparto
I.sino=I
I.sino[!is.na(I.sino)& I.sino!="No"]="Sí"
taula=table(data.frame(I.sino,Sint))[c(2,1) ,1:3]

Tabla.DGS(I.sino,"HPP", "No HPP")
Barplot.DGS(I.sino,"HPP", "No HPP")
```






* Asociación entre los grupos de sintomatología y evento hemorrágico: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`



* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`



```{r}
I=Casos$Hemorragia.postparto
DF=data.frame(Factor=I,Síntomas=Sint)
taula=table(DF)[c(1,2,3,4) ,1:3]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1])))/n_AS,2),
            c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2])))/n_SL,2),
             c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3])))/n_NE,2)
           )
EEExt=rbind(EEExt,c(n_AS,100,n_SL,100,n_NE,100))

rownames(EEExt)=c("Histerectomía",       "Tto. médico",
  "Tto. Qx. conservador" , "No HPP","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r 32,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=4),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(rownames(EEExt)[1:4] , 3),levels=rownames(EEExt)[1:4])
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y el tipo de hemorragia postparto: test $\chi^2$ de Montecarlo, p-valor `r  round(chisq.test(taula[1:3,],simulate.p.value=TRUE,B=10000)$p.value,3)`




### Sintomatología vs eventos trombóticos




```{r 33,fig.cap="\\s"}
taula=table(data.frame(Casos$EVENTOS_TROMBO_TOTALES,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$EVENTOS_TROMBO_TOTALES,"Eventos trombóticos", "No eventos trombóticos")
Barplot.DGS(Casos$EVENTOS_TROMBO_TOTALES,"Eventos trombóticos", "No eventos trombóticos")
```



* Asociación entre los grupos de sintomatología y evento trombótico: test $\chi^2$ de Montecarlo, p-valor $`r signif(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,1)`$



* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor $`r signif(Prop.trend.test(taula[1,],colSums(taula)),1)`$

* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`

### Sintomatología vs UCi madre (Sí-No)


```{r 34,fig.cap="\\s"}
taula=table(data.frame(Casos$UCI,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$UCI,"UCI", "No UCI")
Barplot.DGS(Casos$UCI,"UCI", "No UCI")
```





* Asociación entre los grupos de sintomatología e ingreso en UCI de la madre: test $\chi^2$ de Montecarlo, p-valor $`r signif(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,1)`$



* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor $`r signif(Prop.trend.test(taula[1,],colSums(taula)),1)`$


* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`

### Sintomatología vs UCi madre (antes-después)


```{r}
UCI.I=sum(Casos$UCI,na.rm=TRUE)
I=Casos$UCI_ANTES.DESPUES.DEL.PARTO
DF=data.frame(Factor=I,Síntomas=Sint)
taula=table(DF)[c(2,1),1:3]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(as.vector(taula[,1]), round(100*as.vector(prop.table(taula[,1])),2),
            as.vector(taula[,2]), round(100*as.vector(prop.table(taula[,2])),2),
            as.vector(taula[,3]), round(100*as.vector(prop.table(taula[,3])),2)
           )

rownames(EEExt)=c("UCI antes del parto", "UCI después del parto")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r 35,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=2),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(rownames(EEExt)[1:2] , 3),levels=rownames(EEExt)[1:2])
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y el momento de ingreso en UCI:  test $\chi^2$ de Montecarlo, p-valor `r round(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,3)`



* Test de diferencia en la tendencia de la gravedad respecto del global de UCI: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`

### Sintomatología vs prematuridad



```{r 36,fig.cap="\\s"}
taula=table(data.frame(Casos$PREMATURO,Sint))[c(2,1) ,1:3]
Tabla.DGS(Casos$PREMATURO,"Prematuro", "A término")
Barplot.DGS(Casos$PREMATURO,"Prematuro", "A término")
```





* Asociación entre los grupos de sintomatología y prematures:  test $\chi^2$, p-valor $`r signif(chisq.test(taula)$p.value,1)`$


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor $`r signif(Prop.trend.test(taula[1,],colSums(taula)),1)`$


* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`

### Sintomatología vs APGAR


```{r}
I=c(Casos$APGAR.5...126,CasosGM$APGAR.5...150)
I[I==19]=NA
I=cut(I,breaks=c(-1,7,20),labels=c("0-7","8-10"))

SintN=c(Casos$SINTOMAS_DIAGNOSTICO,CasosGM$SINTOMAS_DIAGNOSTICO)

F_AS=table(SintN)[1]
F_SL=table(SintN)[2]
F_NE=table(SintN)[3]

DF=data.frame(Factor=I,Síntomas=SintN)
taula=table(DF)
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),F_AS-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),F_AS-sum(as.vector(taula[,1])))/F_AS,2),
            c(as.vector(taula[,2]),F_SL-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),F_SL-sum(as.vector(taula[,2])))/F_SL,2),
             c(as.vector(taula[,3]),F_NE-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),F_NE-sum(as.vector(taula[,3])))/F_NE,2)
           )
EEExt=rbind(EEExt,c(F_AS,100,F_SL,100,F_NE,100))

rownames(EEExt)=c("Apgar.5≤7", "Apgar.5≥8 ","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r 37,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=2),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(rownames(EEExt)[1:2] , 3),levels=rownames(EEExt)[1:2])
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y APGAR bajo: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`

* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`


### Sintomatología vs UCI neonato



```{r}
I=c(Casos[Casos$Feto.muerto.intraútero=="No",]$Ingreso.en.UCIN,CasosGM[CasosGM$Feto.vivo=="Sí",]$Ingreso.en.UCI)
SintN=c(Casos[Casos$Feto.muerto.intraútero=="No",]$SINTOMAS_DIAGNOSTICO,CasosGM[CasosGM$Feto.vivo=="Sí",]$SINTOMAS_DIAGNOSTICO)

DF=data.frame(Factor=I,Síntomas=SintN)
taula=table(DF)[c(2,1),c(1,2,3)]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),F_AS-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),F_AS-sum(as.vector(taula[,1])))/F_AS,2),
            c(as.vector(taula[,2]),F_SL-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),F_SL-sum(as.vector(taula[,2])))/F_SL,2),
             c(as.vector(taula[,3]),F_NE-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),F_NE-sum(as.vector(taula[,3])))/F_NE,2)
           )
EEExt=rbind(EEExt,c(F_AS,100,F_SL,100,F_NE,100))

rownames(EEExt)=c("UCIN", "No UCIN","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



```{r 38,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=2),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(rownames(EEExt)[1:2] , 3),levels=rownames(EEExt)[1:2])
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y ingreso en UCIN: test $\chi^2$, p-valor $`r signif(chisq.test(taula)$p.value,1)`$


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor $`r signif(Prop.trend.test(taula[1,],colSums(taula)),1)`$


* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`


### Sintomatología vs Fetos muertos anteparto 



```{r}
I1=Casos$Feto.muerto.intraútero
I1[I1=="Sí"]="Muerto"
I1[I1=="No"]="Vivo"
I2=CasosGM$Feto.vivo
I2[I2=="Sí"]="Vivo"
I2[I2=="No"]="Muerto"
I=c(I1,I2)
SintN1=Casos$SINTOMAS_DIAGNOSTICO
SintN2=CasosGM$SINTOMAS_DIAGNOSTICO
SintN=c(SintN1,SintN2)

DF=data.frame(Factor=I,Síntomas=SintN)
taula=table(DF)[c(1,2),c(1,2,3)]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),table(SintN)[1]-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),table(SintN)[1]-sum(as.vector(taula[,1])))/table(SintN)[1],2),
            c(as.vector(taula[,2]),table(SintN)[2]-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),table(SintN)[2]-sum(as.vector(taula[,2])))/table(SintN)[2],2),
             c(as.vector(taula[,3]),table(SintN)[3]-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),table(SintN)[3]-sum(as.vector(taula[,3])))/table(SintN)[3],2)
           )
EEExt=rbind(EEExt,c(table(SintN)[1],100,table(SintN)[2],100,table(SintN)[3],100))

rownames(EEExt)=c("Feto muerto anteparto", "Feto vivo","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling()
```



```{r 45,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=2),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(rownames(EEExt)[1:2] , 3),levels=rownames(EEExt)[1:2])
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y muerte antepartio: test $\chi^2$ de Montecarlo, p-valor `r round(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,4)`

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`




### Sintomatología vs inicio de parto



```{r}
I=Casos$Inicio.de.parto
DF=data.frame(Factor=I,Síntomas=Sint)
taula=table(DF)[c(2,3,1),1:3]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1])))/n_AS,2),
            c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2])))/n_SL,2),
             c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3])))/n_NE,2)
           )
EEExt=rbind(EEExt,c(n_AS,100,n_SL,100,n_NE,100))

rownames(EEExt)=c("Espontáneo", "Inducido","Cesárea programada","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


```{r 39,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=3),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(rownames(EEExt)[1:3] , 3),levels=rownames(EEExt)[1:3])
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("Inicio de parto")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y el inicio de parto: test $\chi^2$, p-valor $`r signif(chisq.test(taula)$p.value,1)`$

* Tabla de p-valores  ajustados por Bonferroni de  tests de diferencia en la tendencia de la gravedad en cada franja de edad respecto del global: 


```{r}
EE=taula
ppTR=rep(0,dim(EE)[1])
for (i in 1:dim(EE)[1]){
ppTR[i]=Prop.trend.test(EE[i,],colSums(EE))
}
ppTR=p.adjust(ppTR,method="bonferroni")
dt=data.frame(franja=c("Espontáneo", "Inducido","Cesárea programada"),ppTR)
names(dt)=c("Inicio de parto","p-valor trend test (ajustado)")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```




### Sintomatología vs tipo de parto



```{r}
I.In=Casos$Inicio.de.parto
I.In[I.In=="Cesárea"]="Cesárea programada"
I=Casos$Tipo.de.parto
I[I.In=="Cesárea programada"]="Cesárea programada"
I[I=="Cesárea"]="Cesárea urgente"

DF=data.frame(Factor=I,Síntomas=Sint)
taula=table(DF)[c(3,4,1,2),1:3]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),n_AS-sum(as.vector(taula[,1])))/n_AS,2),
            c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),n_SL-sum(as.vector(taula[,2])))/n_SL,2),
             c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),n_NE-sum(as.vector(taula[,3])))/n_NE,2)
           )
EEExt=rbind(EEExt,c(n_AS,100,n_SL,100,n_NE,100))

rownames(EEExt)=c("Eutócico", "Instrumental", "Cesárea programada", "Cesárea urgente","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



```{r 40,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=4),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(rownames(EEExt)[1:4] , 3),levels=rownames(EEExt)[1:4])
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("Tipo de parto")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y tipos de parto: test $\chi^2$, p-valor $`r signif(chisq.test(taula)$p.value,1)`$

* Asociación entre los grupos de sintomatología y tipos de parto diferentes de la cesárea programada: test $\chi^2$, p-valor `r round(chisq.test(taula[-3,])$p.value,3)`


* Tabla de p-valores  ajustados por Bonferroni de tests de diferencia en la tendencia de la gravedad en cada franja de edad respecto del global: 


```{r}
EE=taula
ppTR=rep(0,dim(EE)[1])
for (i in 1:dim(EE)[1]){
ppTR[i]=Prop.trend.test(EE[i,],colSums(EE))
}
ppTR=p.adjust(ppTR,method="bonferroni")
dt=data.frame(franja=c("Eutócico", "Instrumental", "Cesárea programada", "Cesárea urgente"),ppTR)
names(dt)=c("Tipo de parto", "p-valor trend test (ajustado)")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


### Edades gestacionales




```{r 41,fig.cap="\\s"}
I=Casos$EG_TOTAL_PARTO
Síntomas=ordered(Sint,levels=c("Asintomática" ,"Leve",      "Grave"  ))
data =data.frame(
  Síntomas,
  Edades=I
)

data %>%
  ggplot( aes(x=Síntomas, y=Edades, fill=Síntomas)) +
    geom_violin(width=1) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    theme(
      legend.position="none",
      plot.title = element_text(size=11)
    ) +
    xlab("")+
   ylab("Edades gestacionales (semanas)")+
  scale_fill_brewer(palette = "Dark2") 

```


```{r}
Dades=rbind(c(round(min(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1),round(max(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1), round(mean(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1),
              round(median(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1),
              round(quantile(I[data$Síntomas=="Asintomática"],c(0.25,0.75),na.rm=TRUE),1),
              round(sd(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1)),
   c(round(min(I[data$Síntomas=="Leve"],na.rm=TRUE),1),round(max(I[data$Síntomas=="Leve"],na.rm=TRUE),1), round(mean(I[data$Síntomas=="Leve"],na.rm=TRUE),1),
       round(median(I[data$Síntomas=="Leve"],na.rm=TRUE),1),
              round(quantile(I[data$Síntomas=="Leve"],c(0.25,0.75),na.rm=TRUE),1),round(sd(I[data$Síntomas=="Leve"],na.rm=TRUE),1)),         
  c(round(min(I[data$Síntomas=="Grave"],na.rm=TRUE),1),round(max(I[data$Síntomas=="Grave"],na.rm=TRUE),1), round(mean(I[data$Síntomas=="Grave"],na.rm=TRUE),1),round(median(I[data$Síntomas=="Grave"],na.rm=TRUE),1),
              round(quantile(I[data$Síntomas=="Grave"],c(0.25,0.75),na.rm=TRUE),1),round(sd(I[data$Síntomas=="Grave"],na.rm=TRUE),1))          )

colnames(Dades)=c("Edad gest. mínima","Edad gest.  máxima","Edad gest.  media",
                  "Edad gest. mediana", "1er cuartil", "3er cuartil","Desv. típica")
rownames(Dades)=c("Asintomática" ,"Leve",      "Grave"  )

Dades %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")


```

```{r,include=FALSE}

shapiro.test(I)$p.value
kruskal.test(Factor~Síntomas,data=DF)$p.value

pairwise.wilcox.test(I,Sint,p.adjust.method = "bonferroni")$p.value
```

* Ajuste de las edades gestacionales de cada nivel a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I[Sint=="Asintomática"])$p.value,1)`$, $`r signif(shapiro.test(I[Sint=="Leve"])$p.value,1)`$, $`r signif(shapiro.test(I[Sint=="Grave"])$p.value,1)`$, respectivamente

* Homocedasticidad: Test de Fligner-Killeen, p-valor $`r signif(fligner.test(I~Sint)$p.value,1)`$ 

* Edades gestacionales medias: test de Kruskal-Wallis, p-valor  $`r signif(kruskal.test(I~Síntomas,data=DF)$p.value,1)`$

* Contrastes posteriores de edades gestacionales medias por parejas:  tests de Mann-Whitney,p-valores ajustados por Bonferroni:

    * Asintomática vs Leve: `r round(pairwise.wilcox.test(I,Sint,p.adjust.method = "bonferroni")$p.value[1,1],3)`
    * Asintomática vs Grave: $`r signif(pairwise.wilcox.test(I,Sint,p.adjust.method = "bonferroni")$p.value[2,1],1)`$
    * Leve  vs Grave: $`r signif(pairwise.wilcox.test(I,Sint,p.adjust.method = "bonferroni")$p.value[2,2],1)`$

    



### Pesos hijos infectadas


```{r 42,fig.cap="\\s"}
SintN=c(Casos[Casos$Feto.muerto.intraútero=="No",]$SINTOMAS_DIAGNOSTICO,CasosGM[CasosGM$Feto.vivo=="Sí",]$SINTOMAS_DIAGNOSTICO)
Síntomas=SintN[!is.na(SintN)]

I=c(Casos[Casos$Feto.muerto.intraútero=="No",]$Peso._gramos_...125,CasosGM[CasosGM$Feto.vivo=="Sí",]$Peso._gramos_...148)
I=I[!is.na(SintN)]

data =data.frame(
  Síntomas,
  Pesos=I
)

data %>%
  ggplot( aes(x=Síntomas, y=Pesos, fill=Síntomas)) +
    geom_violin(width=1) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    theme(
      legend.position="none",
      plot.title = element_text(size=11)
    ) +
    xlab("")+
   ylab("Pesos (gramos)")+
  scale_fill_brewer(palette = "Dark2") 
```



```{r}
Dades=rbind(c(round(min(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1),round(max(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1), round(mean(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1),
              round(median(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1),
              round(quantile(I[data$Síntomas=="Asintomática"],c(0.25,0.75),na.rm=TRUE),1),
              round(sd(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1)),
   c(round(min(I[data$Síntomas=="Leve"],na.rm=TRUE),1),round(max(I[data$Síntomas=="Leve"],na.rm=TRUE),1), round(mean(I[data$Síntomas=="Leve"],na.rm=TRUE),1),
       round(median(I[data$Síntomas=="Leve"],na.rm=TRUE),1),
              round(quantile(I[data$Síntomas=="Leve"],c(0.25,0.75),na.rm=TRUE),1),round(sd(I[data$Síntomas=="Leve"],na.rm=TRUE),1)),         
  c(round(min(I[data$Síntomas=="Grave"],na.rm=TRUE),1),round(max(I[data$Síntomas=="Grave"],na.rm=TRUE),1), round(mean(I[data$Síntomas=="Grave"],na.rm=TRUE),1),round(median(I[data$Síntomas=="Grave"],na.rm=TRUE),1),
              round(quantile(I[data$Síntomas=="Grave"],c(0.25,0.75),na.rm=TRUE),1),round(sd(I[data$Síntomas=="Grave"],na.rm=TRUE),1))          )
colnames(Dades)=c("Peso. mínimo","Peso.  máximo","Peso.  medio","Peso mediano", "1er cuartil", "3er cuartil","Desv. típica")
rownames(Dades)=c("Asintomática" ,"Leve",      "Grave"  )

Dades %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")


```

```{r,include=FALSE}

shapiro.test(I)$p.value
kruskal.test(I~Síntomas)$p.value
```

* Ajuste de los pesos de cada nivel a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I[Sint=="Asintomática"])$p.value,1)`$, $`r signif(shapiro.test(I[Sint=="Leve"])$p.value,1)`$, $`r signif(shapiro.test(I[Sint=="Grave"])$p.value,1)`$, respectivamente

* Homocedasticidad: Test de Fligner-Killeen, p-valor `r round(fligner.test(I~Síntomas)$p.value,3)`


* Pesos medios: test de Kruskal-Wallis, p-valor  `r round(kruskal.test(I~Síntomas)$p.value,3)`


### Bajo peso



```{r}
I.cut=cut(I,breaks=c(0,2500,10000),labels=c(1,0),right=FALSE)

DF=data.frame(Factor=I.cut,Síntomas=Síntomas)
taula=table(DF)[,c(1,2,3)]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),length(I.cut[Síntomas=="Asintomática"])-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),length(I.cut[Síntomas=="Asintomática"])-sum(as.vector(taula[,1])))/length(I.cut[Síntomas=="Asintomática"]),2),
            c(as.vector(taula[,2]),length(I.cut[Síntomas=="Leve"])-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),length(I.cut[Síntomas=="Leve"])-sum(as.vector(taula[,2])))/length(I.cut[Síntomas=="Leve"]),2),
             c(as.vector(taula[,3]),length(I.cut[Síntomas=="Grave"])-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),length(I.cut[Síntomas=="Grave"])-sum(as.vector(taula[,3])))/length(I.cut[Síntomas=="Grave"]),2)
           )
EEExt=rbind(EEExt,c(length(I.cut[Síntomas=="Asintomática"]),100,length(I.cut[Síntomas=="Leve"]),100,length(I.cut[Síntomas=="Grave"]),100))

rownames(EEExt)=c("Bajo peso", "No bajo peso","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



```{r 86,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=2),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(rownames(EEExt)[1:2] , 3),levels=rownames(EEExt)[1:2])
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y bajo peso: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),3)`


* Potencia del test: `r round(pwr.chisq.test(w =sqrt(chisq.test(taula)$statistic/sum(taula)), N =sum(taula) , df =chisq.test(taula)$parameter, sig.level =0.05 )$power,3)`


<!--chapter:end:1.Descripciónglobal.Rmd-->

# Descripción de la muestra de la primera ola 


## Descripción global 


Hay `r n_I1` infectadas y `r n_NI1` no infectadas en la muestra de la primera ola.

### Edades


```{r}
I=Casos1w$Edad._años_
NI=Controls1w$Edad._años_
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
```


```{r 101,fig.cap="\\s"}
data =data.frame(
  name=c(rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Edades=c(I,NI)
  )

sample_size = data %>% group_by(name) %>% summarize(num=n())

data %>%
 left_join(sample_size) %>%
  mutate(myaxis = paste0(name, "\n", "n=", num)) %>%
  ggplot( aes(x=myaxis, y=Edades, fill=name)) +
    geom_violin(width=1) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    #theme_ipsum() +
    theme(
      legend.position="none",
      plot.title = element_text(size=11)
    ) +
    xlab("")+
  ylab("Edades (años)")+
scale_fill_hue(c = 100)
```


```{r}
Dades=rbind(c(min(I,na.rm=TRUE),max(I,na.rm=TRUE), round(mean(I,na.rm=TRUE),1),round(median(I,na.rm=TRUE),1),round(quantile(I,c(0.25,0.75),na.rm=TRUE),1), round(sd(I,na.rm=TRUE),1)),
            c(min(NI,na.rm=TRUE),max(NI,na.rm=TRUE), round(mean(NI,na.rm=TRUE),1),round(median(NI,na.rm=TRUE),1),round(quantile(NI,c(0.25,0.75),na.rm=TRUE),1),round(sd(NI,na.rm=TRUE),1)))

colnames(Dades)=c("Edad mínima","Edad máxima","Edad media", "Edad mediana", "1er cuartil", "3er cuartil", "Desv. típica")

rownames(Dades)=c("Infectadas", "No infectadas")

Dades %>%
  kbl() %>%
  kable_styling()
```



```{r,include=FALSE}
shapiro.test(I)$p.value
shapiro.test(NI)$p.value
```



```{r}
I.cut=cut(I,breaks=c(0,30,40,100),labels=c("18-30","31-40",">40"))
NI.cut=cut(NI,breaks=c(0,30,40,100),labels=c("18-30","31-40",">40"))
```


```{r}
EE=rbind(as.vector(table(I.cut)),as.vector(table(NI.cut)))
EEExt=rbind(c(as.vector(table(I.cut)),NA_I),
            round(100*c(as.vector(table(I.cut)),NA_I)/n_I1,1),
            c(as.vector(table(NI.cut)),NA_NI),
            round(100*c(as.vector(table(NI.cut)),NA_NI)/n_NI1,1)
            )
EEExt=cbind(EEExt,c(n_I1,100,n_NI1,100))



colnames(EEExt)=c("18-30","31-40",">40","Pérdidas","Total")
rownames(EEExt)=c("Infectadas (N)", "Infectadas (%)","No infectadas (N)", "No infectadas (%)")

t(EEExt) %>%
  kbl() %>%
  kable_styling()
```

```{r 102,fig.cap="\\s"}
df =data.frame(
  Factor=c(rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Edades=c( I.cut,NI.cut )
)

base=ordered(rep(c("18-30","31-40",">40"), each=2),levels=c("18-30", "31-40",   ">40"))
Grupo=rep(c("Infectada","No infectada") , length(levels(I.cut)))
valor=as.vector(prop.table(table(df), margin=1))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=Grupo, y=valor, x=base)) + 
  geom_bar(position="dodge", stat="identity")+
      #theme_ipsum() +
xlab("Grupos de edad")+
      #theme_ipsum() +
  ylab("")

```

* Ajuste de las edades de infectadas y no infectadas a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I)$p.value,1)`$ y $`r 
signif(shapiro.test(NI)$p.value,1)`$, respectivamente


* Desviaciones típicas: test de Fligner-Killeen, p-valor `r round(fligner.test(list(I,NI))$p.value,4)`

* Edades medias: test t, p-valor `r round(t.test(I,NI)$p.value,2)`, IC del 95% para la diferencia de medias [`r round(t.test(I,NI)$conf.int,2)`]

* Composiciones por edades de los grupos de casos y de controles: test $\chi^2$, p-valor `r round(chisq.test(EE)$p.value,4)`
. 

En la tabla que sigue:

* p-valor ajustado: p-valores de tests de Fisher bilateral ajustados por Bonferroni calculados para la muestra sin pérdidas
* OR: la odds ratio univariante estimada de infectarse relativa a la franja de dead
* IC: el intervalo de confianza del 95% para la OR

```{r}
pp=rep(0,dim(EE)[2])
for (i in 1:dim(EE)[2]){
pp[i]=prop.test(c(EE[1,i],sum(EE[1,-i])),
                c(sum(EE[,i]),sum(EE[,-i])))$p.value
}
pp=p.adjust(pp,method="bonferroni")
OR=rep(0,dim(EE)[2])
CI1=rep(0,dim(EE)[2])
CI2=rep(0,dim(EE)[2])

for (i in 1:dim(EE)[2]){
FT=fisher.test(rbind(c(EE[1,i],sum(EE[1,-i])),
                  c(EE[2,i],sum(EE[2,-i]))))
OR[i]=round(FT$estimate,2)
CI1[i]=round(FT$conf.int[1],2)
CI2[i]=round(FT$conf.int[2],2)
                }
dt=data.frame(franja=c("18-30","31-40",">40"),pp,OR,CI1,CI2)
names(dt)=c("Franja", "p-valor ajustado","OR","Extremo inferior de IC", "Extremo superior de IC")
dt %>%
  kbl() %>%
  kable_styling()
```




### Etnias

```{r}
I=Casos1w$Etnia
I[I=="Asia"]="Asiática"
I=factor(I)
NI=factor(Controls1w$Etnia)
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
```

```{r}
EE=rbind(as.vector(table(I)),
         as.vector(table(NI)))
EEExt=rbind(c(as.vector(table(I)),NA_I),
            round(100*c(as.vector(table(I)),NA_I)/n_I1,1),
            c(as.vector(table(NI)),NA_NI),
            round(100*c(as.vector(table(NI)),NA_NI)/n_NI1,1))
colnames(EEExt)=c("Árabe", "Asia", "Blanca", "Latinoamericana","Negra","Pérdidas")
rownames(EEExt)=Columnes

t(EEExt) %>%
  kbl() %>%
  kable_styling()
```


```{r 103,fig.cap="\\s"}
df =data.frame(
  Factor=c(rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Etnias=c(I,NI)
)
base=rep(levels(I) , each=2)
Grupo=rep(c("Infectada","No infectada") , length(levels(I)))
valor=as.vector(prop.table(table(df), margin=1))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=Grupo, y=valor, x=base)) + 
  geom_bar(position="dodge", stat="identity")+
      #theme_ipsum() +
xlab("Etnias")+
  ylab("")

```




```{r,include=FALSE}
chisq.test(EE)
```

* Composiciones por edades de los grupos de casos y de controles: test $\chi^2$, p-valor  $`r signif(chisq.test(EE)$p.value,1)`$


En la tabla que sigue:

* p-valor ajustado: p-valores de tests de Fisher bilateral ajustados por Bonferroni calculados para la muestra sin pérdidas
* OR: la odds ratio univariante estimada de infectarse relativa a la etnia
* IC: el intervalo de confianza del 95% para la OR

```{r}
pp=rep(0,dim(EE)[2])
OR=rep(0,dim(EE)[2])
CI1=rep(0,dim(EE)[2])
CI2=rep(0,dim(EE)[2])

for (i in 1:dim(EE)[2]){
FT=fisher.test(rbind(c(EE[1,i],sum(EE[1,-i])),
                  c(EE[2,i],sum(EE[2,-i]))))
pp[i]=FT$p.value
OR[i]=round(FT$estimate,2)
CI1[i]=round(FT$conf.int[1],2)
CI2[i]=round(FT$conf.int[2],2)
                  }
pp=p.adjust(pp,method="bonferroni")
dt=data.frame(franja=c("Árabe", "Asia", "Blanca", "Latinoamericana","Negra"),pp,OR,CI1,CI2)
names(dt)=c("Franja","p-valor ajustado","OR","Extremo inferior de IC", "Extremo superior de IC")
dt %>%
  kbl() %>%
  kable_styling()
```




### Hábito tabáquico

```{r}
I=Casos1w$FUMADORA_CAT
NI=Controls1w$Fumadora_cat
Tabla.DMG1(I,NI,"Fumadoras", "No fumadoras")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```




* Comparación de proporciones de fumadoras en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a ser fumadora, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]


### Obesidad 


```{r}
I=Casos1w$Obesidad
NI=Controls1w$Obesidad
Tabla.DMG1(I,NI,"Obesas","No obesas")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```



* Comparación de proporciones de obesas en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a ser obesa, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]


### Hipertensión pregestacional


```{r}
I=Casos1w$Hipertensión.pregestacional
NI=Controls1w$Hipertensión.pregestacional
Tabla.DMG1(I,NI,"HTA","No HTA")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```


* Comparación de proporciones de hipertensas en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a ser hipertensa, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]



### Diabetes Mellitus 

```{r}
I=Casos1w$DIABETES
NI=Controls1w$Diabetes
Tabla.DMG1(I,NI,"DM","No DM")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```



* Comparación de proporciones de diabéticas en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a ser diabética, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]


### Enfermedades cardiacas crónicas 

```{r}
I=Casos1w$Enfermedad.cardiaca.crónica
NI=Controls1w$ENF.CARDIACA.TODO
Tabla.DMG1(I,NI,"ECC","No ECC")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```



* Comparación de proporciones de ECC en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a tener ECC, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]



### Enfermedades pulmonares crónicas (incluyendo asma)

<!--

#### No Asma

```{r}
I=Casos1w$Enfermedad.pulmonar.crónica.no.asma
NI=Controls1w$Enfermedad.pulmonar.crónica.no.asma
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
#table(I)
#table(NI)
```


```{r}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
EEExt=rbind(c(as.vector(table(I))[2:1],NA_I),
            round(100*c(as.vector(table(I))[2:1],NA_I)/n_I1,1),
            c(as.vector(table(NI))[2:1],NA_NI),
            round(100*c(as.vector(table(NI))[2:1],NA_NI)/n_NI1,1))
rownames(EEExt)=Columnes
colnames(EEExt)=c("EPC", "No EPC","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling()
```


```{r}
FT=fisher.test(EE)
```

* test de Fisher, p-valor `r round(FT$p.value,3)`; 
* OR univariante estimada de infección relativa a tener EPC no asma `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]

#### Asma


```{r}
I=Casos1w$Diagnóstico.clínico.de.Asma
NI=Controls1w$Diagnóstico.clínico.de.Asma
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
#table(I)
#table(NI)
```


```{r}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
EEExt=rbind(c(as.vector(table(I))[2:1],NA_I),
            round(100*c(as.vector(table(I))[2:1],NA_I)/n_I1,1),
            c(as.vector(table(NI))[2:1],NA_NI),
            round(100*c(as.vector(table(NI))[2:1],NA_NI)/n_NI1,1))
rownames(EEExt)=Columnes
colnames(EEExt)=c("Asma", "No Asma","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling()
```


```{r}
FT=fisher.test(EE)
```

* test de Fisher, p-valor `r round(FT$p.value,3)`; 
* OR univariante estimada de infección relativa a tener asma, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]


#### Total

-->


```{r,warning=FALSE}
INA=Casos1w$Enfermedad.pulmonar.crónica.no.asma
NINA=Controls1w$Enfermedad.pulmonar.crónica.no.asma
NINA[NINA==0]="No"
NINA[NINA==1]="Sí"
IA=Casos1w$Diagnóstico.clínico.de.Asma
NIA=Controls1w$Diagnóstico.clínico.de.Asma
NIA[NIA==0]="No"
NIA[NIA==1]="Sí"

I=rep(NA,n_I1)
for (i in 1:n_I1){I[i]=max(INA[i],IA[i],na.rm=TRUE)}
NI=rep(NA,n_NI1)
for (i in 1:n_NI1){NI[i]=max(NINA[i],NIA[i],na.rm=TRUE)}
NI[NI==-Inf]=NA

Tabla.DMG1(I,NI,"EPC","No EPC")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```



* Comparación de proporciones de EPC en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a tener EPC, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]


### Paridad



```{r}
I=Casos1w$NULIPARA
NI=Controls1w$Nuliparous
Tabla.DMG1(I,NI,"Nuliparas", "Multiparas")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```



* Comparación de proporciones de nulíparas en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a ser nulípara, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]


## Embarazos



### Gestación múltiple


```{r}
I=Casos1w$Gestación.Múltiple
NI=Controls1w$Gestación.Múltiple
Tabla.DMG1(I,NI,"Gestación múltiple", "Gestación única")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
```



* Comparación de proporciones de gestaciones múltiples en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 
* OR univariante estimada de infección relativa a tener gestación múltiple, `r round(FT$estimate,2)`; 
* IC del 95% para esta OR, [`r round(FT$conf.int,2)`]



### Anomalías congénitas


```{r}
I=Casos1w$Diagnóstico.de.malformación.ecográfica._.semana.20._
NI=Controls1w$Diagnóstico.de.malformación.ecográfica._.semana.20._
Tabla.DMG1(I,NI,"Anomalías congénitas", "No anomalías congénitas")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgos de anomalía congénita en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de anomalía congénita relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]



 

### Retraso del crecimiento intrauterino 


```{r}
I=Casos1w$Defecto.del.crecimiento.fetal..en.tercer.trimestre._.CIR._.
NI=Controls1w$Defecto.del.crecimiento.fetal..en.tercer.trimestre._.CIR._.
Tabla.DMG1(I,NI,"RCIU", "No RCIU")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgos de retraso del crecimiento intrauterino  en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de retraso del crecimiento intrauterino  relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]

### Diabetes gestacional 

```{r}
I=Casos1w$Diabetes.gestacional
NI=Controls1w$Diabetes.gestacional
Tabla.DMG1(I,NI,"DG", "No DG")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgos de diabetes gestacional en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de diabetes gestacional relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]



### Hipertensión gestacional 


```{r}
I=Casos1w$Hipertensión.gestacional
NI=Controls1w$Hipertensión.gestacional
Tabla.DMG1(I,NI,"HG", "No HG")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])

FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgos de hipertensión gestacional en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de hipertensión gestacional relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]

### Preeclampsia 



```{r}
I=Casos1w$PREECLAMPSIA_ECLAMPSIA_TOTAL
NI=Controls1w$PREECLAMPSIA
Tabla.DMG1(I,NI,"PE", "No PE")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])

FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgos de preeclampsia en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de preeclampsia relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]

### Preeclampsia con criterios de gravedad




```{r}
n_PI=sum(Casos1w$PREECLAMPSIA_ECLAMPSIA_TOTAL)
n_PNI=sum(Controls1w$PREECLAMPSIA)
I=Casos1w[Casos1w$PREECLAMPSIA_ECLAMPSIA_TOTAL==1,]$Preeclampsia.grave_HELLP_ECLAMPSIA

NI1=Controls1w[Controls1w$PREECLAMPSIA==1,]$preeclampsia_severa
NI2=Controls1w[Controls1w$PREECLAMPSIA==1,]$Preeclampsia.grave.No.HELLP 
NI=rep(NA,length(NI1))
for (i in 1:length(NI1)){NI[i]=max(NI1[i],NI2[i],na.rm=TRUE)}
#table(I)
#table(NI)
```

```{r}
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
EEExt=rbind(c(as.vector(table(I))[2:1],NA_I),
            round(100*c(as.vector(table(I))[2:1],NA_I)/length(I),1),
            c(as.vector(table(NI))[2:1],NA_NI),
            round(100*c(as.vector(table(NI))[2:1],NA_NI)/length(NI),1))
rownames(EEExt)=Columnes

colnames(EEExt)=c("PE con CG", "PE sin CG","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling()
```

```{r,include=FALSE}
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgos de preeclampsia con CG en infectadas y no infectadas que dessrrollaron preeclampsia: test de Fisher bilateral, p-valor $`r round(FT$p.value,4)`$; 

* RA estimado de preeclampsia con CG relativo a infección en preeclámpsicas: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]



### Rotura prematura de membranas 



```{r}
I=Casos1w$Bolsa.rota.anteparto
NI=Controls1w$Bolsa.rota.anteparto
Tabla.DMG1(I,NI,"RPM", "No RPM")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])

FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgos de rotura prematura de membranas  en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de rotura prematura de membranas  relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]



### Edad gestacional en el momento del parto 



```{r}
I=Casos1w$EG_TOTAL_PARTO
NI=Controls1w$EDAD_GEST   
```


```{r}
Dades=rbind(c(min(I,na.rm=TRUE),max(I,na.rm=TRUE), round(mean(I,na.rm=TRUE),1),round(median(I,na.rm=TRUE),1),round(quantile(I,c(0.25,0.75),na.rm=TRUE),1), round(sd(I,na.rm=TRUE),1)),
            c(min(NI,na.rm=TRUE),max(NI,na.rm=TRUE), round(mean(NI,na.rm=TRUE),1),round(median(NI,na.rm=TRUE),1),round(quantile(NI,c(0.25,0.75),na.rm=TRUE),1),round(sd(NI,na.rm=TRUE),1)))

colnames(Dades)=c("Edad mínima","Edad máxima","Edad media", "Edad mediana", "1er cuartil", "3er cuartil", "Desv. típica")
rownames(Dades)=c("Infectadas", "No infectadas")

Dades %>%
  kbl() %>%
  kable_styling()


```

```{r 104,fig.cap="\\s"}
data =data.frame(
  name=c( rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Edades=c( I,NI )
)

data %>%
  ggplot( aes(x=name, y=Edades, fill=name)) +
    geom_violin(width=1) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    #theme_ipsum() +
    theme(
      legend.position="none",
      plot.title = element_text(size=11)
    ) +
    xlab("")+
  ylab("Edades gestacionales (semanas)")
```



```{r,include=FALSE}
shapiro.test(I)$p.value
shapiro.test(NI)$p.value
fligner.test(list(I,NI))
ttest=t.test(I,NI)
```

* Ajuste de las edades gestacionales de infectadas y no infectadas a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I)$p.value,1)`$ y $`r 
signif(shapiro.test(NI)$p.value,1)`$, respectivamente


* Edades medias: test t, p-valor $`r signif(ttest$p.value,1)`$, IC del 95% para la diferencia de medias [`r round(ttest$conf.int,2)`]

* Desviaciones típicas: test de Fligner-Killeen, p-valor $`r signif(fligner.test(list(I,NI))$p.value,1)`$


### Ingreso materno en  UCI



```{r}
I=Casos1w$UCI
NI=Controls1w$UCI...9
Tabla.DMG1(I,NI,"UCI", "No UCI")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])

FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgos de UCI en infectadas y no infectadas: test de Fisher bilateral, p-valor $`r signif(FT$p.value,1)`$; 

* RA estimado de UCI relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]

### Ingreso materno en UCI según el momento del parto o cesárea


```{r}
UCI.I=sum(Casos1w$UCI,na.rm=TRUE)
UCI.NI=sum(Controls1w$UCI...9,na.rm=TRUE)
I=Casos1w$UCI_ANTES.DESPUES.DEL.PARTO
NI=Controls1w$UCI.ANTES.DEL.PARTO  #Vacía

EE=rbind(as.vector(table(I)),
         c(0,UCI.NI))
EEExt=rbind(c(as.vector(table(I)),0),
            round(100*c(as.vector(table(I)),0)/UCI.I,1),
            c(0,UCI.NI,0),
            c(0,100,0))
rownames(EEExt)=Columnes

colnames(EEExt)=c("UCI antes del parto", "UCI después del parto","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling()
```


```{r,include=FALSE}
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo de UCI antes del parto en las ingresadas en UCI infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de UCI antes del parto en las ingresadas en UCI relativa a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: $`r round(PT$estimate[1]/PT$estimate[2],2)`$

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [$`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`$]


### Embarazos con algún feto muerto anteparto 


```{r}
I=Casos1w$Feto.muerto.intraútero
I[I=="Sí"]=1
I[I=="No"]=0
NI1=Controls1w$Feto.vivo...194
NI1[NI1=="Sí"]=0
NI1[NI1=="No"]=1
NI2=Controls1w$Feto.vivo...245
NI2[NI2=="Sí"]=0
NI2[NI2=="No"]=1
NI=NI1
for (i in 1:length(NI1)){NI[i]=max(NI1[i],NI2[i],na.rm=TRUE)}
```

```{r}
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
EEExt=rbind(c(as.vector(table(I))[2:1],NA_I),
            round(100*c(as.vector(table(I))[2:1],NA_I)/n_I1,1),
            c(as.vector(table(NI))[2:1],NA_NI),
            round(100*c(as.vector(table(NI))[2:1],NA_NI)/n_NI1,1))
rownames(EEExt)=Columnes

colnames(EEExt)=c("Algún feto muerto anteparto", "Ningún feto muerto anteparto","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling()
```


```{r,include=FALSE}
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo de algún feto muerto anteparto en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de feto muerto anteparto relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]



### Inicio del parto


```{r}
I=factor(Casos1w$Inicio.de.parto)
NI=Controls1w$Inicio.de.parto
NI[NI=="Cesárea programada"]="Cesárea"
NI=factor(NI)

NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
```

```{r}
EE=rbind(as.vector(table(I))[c(2,3,1)],
         as.vector(table(NI))[c(2,3,1)])
EEExt=rbind(c(as.vector(table(I))[c(2,3,1)],NA_I),
            round(100*c(as.vector(table(I))[c(2,3,1)],NA_I)/n_I1,1),
            c(as.vector(table(NI))[c(2,3,1)],NA_NI),
            round(100*c(as.vector(table(NI))[c(2,3,1)],NA_NI)/n_NI1,1))
colnames(EEExt)=c("Espontáneo", "Inducido", "Cesárea programada","Pérdidas")
rownames(EEExt)=Columnes

t(EEExt) %>%
  kbl() %>%
  kable_styling()
```


```{r 105,fig.cap="\\s"}
df =data.frame(
  Factor=c( rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Inicios=ordered(c( I,NI ),levels=c("Espontáneo","Inducido","Cesárea"))
)

base=ordered(rep(c("Espontáneo","Inducido","Cesárea"), each=2),levels=c("Espontáneo","Inducido","Cesárea"))
Grupo=rep(c("Infectada","No infectada") , 3)
valor=c(as.vector(prop.table(table(df),margin=1))                 )
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=Grupo, y=valor, x=base)) + 
  geom_bar(position="dodge", stat="identity")+  
  xlab("Inicios de parto")+
  ylab("")
```



```{r,include=FALSE}
FT=chisq.test(EE)
```

* Distribuciones de los inicios de parto en los grupos de infectadas y no infectadas: test $\chi^2$, p-valor $`r signif(chisq.test(EE)$p.value,1)`$


En la tabla que sigue:

* p-valor ajustado: p-valores de tests de Fisher bilateral ajustados por Bonferroni calculados para la muestra sin pérdidas
* RA y RR: riesgos absoluto y relativo estimados del inicio de parto relativos a la infección
* IC-RA e IC-RR: sus intervalos de confianza del 95% respectivos

```{r}
pp=rep(0,dim(EE)[2])
RA=rep(0,dim(EE)[2])
RR=rep(0,dim(EE)[2])
CIRA1=rep(0,dim(EE)[2])
CIRA2=rep(0,dim(EE)[2])
CIRR1=rep(0,dim(EE)[2])
CIRR2=rep(0,dim(EE)[2])

for (i in 1:dim(EE)[2]){
EE.temp=rbind(c(EE[1,i],sum(EE[1,-i])),
                  c(EE[2,i],sum(EE[2,-i])))
FT=fisher.test(EE.temp)
PT=prop.test(EE.temp[,1],rowSums(EE.temp))
pp[i]=FT$p.value
RA[i]=round(PT$estimate[1]-PT$estimate[2],3)
RR[i]=round(PT$estimate[1]/PT$estimate[2],3)
CIRA1[i]=round(PT$conf.int,4)[1]
CIRA2[i]=round(PT$conf.int,4)[2]
CIRR1[i]=round(RelRisk(EE.temp,conf.level=0.95,method="wald"),3)[2]
CIRR2[i]=round(RelRisk(EE.temp,conf.level=0.95,method="wald"),3)[3]
            }
pp=p.adjust(pp,method="bonferroni")
#> pp[c(2,3,1)]
#[1] 3.046147e-08 5.563602e-03 1.110478e-06
dt=data.frame(franja=c("Espontáneo", "Inducido", "Cesárea programada"),round(pp,16),RA,RR,CIRA1,CIRA2,CIRR1,CIRR2)
names(dt)=c("Inicio de parto","p-valor ajustado","RA", "RR", "Extr. inf. de IC-RA", "Extr. sup. de IC-RA", "Extr. inf. de IC-RR", "Extr. sup. de IC-RR")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


### Tipo de parto


```{r}
I.In=Casos1w$Inicio.de.parto
I.In[I.In=="Cesárea"]="Cesárea programada"
I=Casos1w$Tipo.de.parto
I[I.In=="Cesárea programada"]="Cesárea programada"
I[I=="Cesárea"]="Cesárea urgente"

NI.In=Controls1w$Inicio.de.parto
NI=Controls1w$Tipo.de.parto
NI[NI.In=="Cesárea programada"]="Cesárea programada"
NI[NI=="Cesárea"]="Cesárea urgente"

NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
```

```{r}
EE=rbind(as.vector(table(I)[c(3,4,1,2)]),
         as.vector(table(NI))[c(3,4,1,2)])
EEExt=rbind(c(as.vector(table(I))[c(3,4,1,2)],NA_I),
            round(100*c(as.vector(table(I))[c(3,4,1,2)],NA_I)/n_I1,1),
            c(as.vector(table(NI))[c(3,4,1,2)],NA_NI),
            round(100*c(as.vector(table(NI))[c(3,4,1,2)],NA_NI)/n_NI1,1))
colnames(EEExt)=c("Eutocico", "Instrumental", "Cesárea programada", "Cesárea urgente", "Pérdidas")
rownames(EEExt)=Columnes

t(EEExt) %>%
  kbl() %>%
  kable_styling()
```



```{r 106,fig.cap="\\s"}
df =data.frame(
  Factor=c( rep("Infectadas",length(I)), rep("No infectadas",length(NI))),
  Inicios=ordered(c( I,NI ),levels=c("Eutocico", "Instrumental", "Cesárea programada", "Cesárea urgente"))
)

base=ordered(rep(c("Eutocico", "Instrumental", "Cesárea prog.", "Cesárea urg."), each=2),levels=c("Eutocico", "Instrumental", "Cesárea prog.", "Cesárea urg."))
Grupo=rep(c("Infectada","No infectada") , 4)
valor=as.vector(prop.table(table(df), margin=1))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=Grupo, y=valor, x=base)) + 
  geom_bar(position="dodge", stat="identity")+  
  xlab("Tipos de parto")+
  ylab("")
```



```{r,include=FALSE}
FT=chisq.test(EE)
```

* Distribuciones de los tipos de parto en los grupos de infectadas y no infectadas: test $\chi^2$, p-valor $`r signif(chisq.test(EE)$p.value,1)`$


En la tabla que sigue:

* p-valor ajustado: p-valores de tests de Fisher bilateral ajustados por Bonferroni calculados para la muestra sin pérdidas
* RA y RR: riesgos absoluto y relativo estimados del tipo de parto relativos a la infección
* IC-RA e IC-RR: sus intervalos de confianza del 95% respectivos

```{r}
pp=rep(0,dim(EE)[2])
RA=rep(0,dim(EE)[2])
RR=rep(0,dim(EE)[2])
CIRA1=rep(0,dim(EE)[2])
CIRA2=rep(0,dim(EE)[2])
CIRR1=rep(0,dim(EE)[2])
CIRR2=rep(0,dim(EE)[2])

for (i in 1:dim(EE)[2]){
EE.temp=rbind(c(EE[1,i],sum(EE[1,-i])),
                  c(EE[2,i],sum(EE[2,-i])))
FT=fisher.test(EE.temp)
PT=prop.test(EE.temp[,1],rowSums(EE.temp))
pp[i]=FT$p.value
RA[i]=round(PT$estimate[1]-PT$estimate[2],3)
RR[i]=round(PT$estimate[1]/PT$estimate[2],3)
CIRA1[i]=round(PT$conf.int,4)[1]
CIRA2[i]=round(PT$conf.int,4)[2]
CIRR1[i]=round(RelRisk(EE.temp,conf.level=0.95,method="wald"),3)[2]
CIRR2[i]=round(RelRisk(EE.temp,conf.level=0.95,method="wald"),3)[3]
            }
pp=p.adjust(pp,method="bonferroni")
dt=data.frame(franja=c("Eutocico", "Instrumental", "Cesárea programada", "Cesárea urgente"),pp,RA,RR,CIRA1,CIRA2,CIRR1,CIRR2)
names(dt)=c("Tipo de parto","p-valor ajustado","RA", "RR", "Extr. inf. de IC-RA", "Extr. sup. de IC-RA", "Extr. inf. de IC-RR", "Extr. sup. de IC-RR")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```




### Prematurez 



```{r}
I=Casos1w$PREMATURO
NI=Controls1w$Preterm.deliveries
Tabla.DMG1(I,NI,"Prematuro", "A término")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])

FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgos de prematurez en infectadas y no infectadas: test de Fisher bilateral, p-valor $`r signif(FT$p.value,1)`$; 

* RA estimado de prematurez relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]




### Eventos trombóticos



```{r}
I=Casos1w$EVENTOS_TROMBO_TOTALES
NI1=Controls1w$DVT
NI2=Controls1w$PE
NI=rep(NA,n_NI1)
for (i in 1:n_NI1){NI[i]=max(NI1[i],NI2[i],na.rm=TRUE)}
NI[NI==-Inf]=NA
NI=factor(NI,levels=0:1)
Tabla.DMG1(I,NI,"Eventos trombóticos", "No eventos trombóticos")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])

FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgos de evento trombótico en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de evento trombótico relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: $`r PT$estimate[1]/PT$estimate[2]`$

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [$`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`$]



### Eventos hemorrágicos




```{r}
I=Casos1w$EVENTOS_HEMORRAGICOS_TOTAL
NI=Controls1w$eventos_hemorragicos
Tabla.DMG1(I,NI,"Eventos hemorrágicos", "No eventos hemorrágicos")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])

FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgos de evento hemorrágico en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de evento hemorrágico relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]

### Hemorragias potsparto


```{r}
I=Casos1w$Hemorragia.postparto
I.sino=I
I.sino[!is.na(I.sino)& I.sino!="No"]="Sí"
I=ordered(I,levels=names(table(I))[c(4,2,3,1)])


NI=Controls1w$Hemorragia.postparto
NI.sino=NI
NI.sino[!is.na(NI.sino)& NI.sino!="No"]="Sí"
NI=ordered(NI,levels=names(table(NI))[c(4,2,3,1)])
Tabla.DMG1(I.sino,NI.sino,"HPP", "No HPP")
```



```{r,include=FALSE}
EE=rbind(as.vector(table(I.sino))[2:1],
         as.vector(table(NI.sino))[2:1])

FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo de hemorragia postparto en infectadas y no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,4)`; 

* RA estimado de hemorragia postparto relativo a infección: `r round(PT$estimate[1]-PT$estimate[2],4)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="wald")[2:3],2)`]





```{r}
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
```

```{r}
EE=rbind(as.vector(table(I)),
         as.vector(table(NI)))
EEExt=rbind(c(as.vector(table(I)),NA_I),
            round(100*c(as.vector(table(I)),NA_I)/n_I1,1),
            c(as.vector(table(NI)),NA_NI),
            round(100*c(as.vector(table(NI)),NA_NI)/n_NI1,1))
colnames(EEExt)=c(names(table(I)), "Pérdidas")
rownames(EEExt)=Columnes

t(EEExt) %>%
  kbl() %>%
  kable_styling()
```


```{r 107,fig.cap="\\s"}
df =data.frame(
  Factor=c( rep("Infectadas",length(I[I!="No"])), rep("No infectadas",length(NI[NI!="No"]))),
  Hemos=ordered(c( I[I!="No"],NI[NI!="No"] ),levels=names(table(I))[-4])
)

base=ordered(rep(c("Tto. médico", "Tto. Qx conservador", "Histerectomía"), each=2),levels=c("Tto. médico", "Tto. Qx conservador", "Histerectomía"))
Grupo=rep(c("Infectada","No infectada") , 3)
valor=as.vector(prop.table(table(df), margin=1))
data <- data.frame(base,Grupo,valor)


ggplot(data, aes(fill=Grupo, y=valor, x=base)) + 
  geom_bar(position="dodge", stat="identity")+  
  xlab("Tratamientos de hemorragia postparto")+
  ylab("")
```



```{r,include=FALSE}
FT1=chisq.test(EE,simulate.p.value=TRUE,B=10000)
I=Casos1w$Hemorragia.postparto
I=I[I!="No"]
I=I[!is.na(I)]
NI=Controls1w$Hemorragia.postparto
NI=NI[NI!="No"]
NI=NI[!is.na(NI)]
EE=rbind(as.vector(table(I)),
         as.vector(table(NI)))
FT2=chisq.test(EE,simulate.p.value=TRUE,B=10000)
```

* Distribuciones de los tipos de hemorragia postparto (incluyendo Noes) en los grupos de infectadas y no infectadas: test $\chi^2$ de Montercarlo, p-valor `r round(FT1$p.value,2)`

* Distribuciones de los tipos de hemorragia postparto en los grupos de infectadas y no infectadas que tuvieron hemorragia postparto:  test $\chi^2$ de Montercarlo, p-valor `r round(FT2$p.value,2)`












## Neonatos



### Fetos muertos anteparto 



```{r}
I1=Casos1w$Feto.muerto.intraútero
I1[I1=="Sí"]="Muerto"
I1[I1=="No"]="Vivo"
I2=Casos1wGM$Feto.vivo
I2[I2=="Sí"]="Vivo"
I2[I2=="No"]="Muerto"
I=c(I1,I2)
n_I1FT=length(I)
n_VI=as.vector(table(I))[2]
```


```{r}
NI1=Controls1w$Feto.vivo...194
NI2=Controls1wGM$Feto.vivo...245
NI=c(NI1,NI2)
NI[NI=="Sí"]="Vivo"
NI[NI=="No"]="Muerto"
n_NI1FT=length(NI)
n_VNI=as.vector(table(NI))[2]
```


```{r}
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
EE=rbind(as.vector(table(I)),
         as.vector(table(NI)))
EEExt=rbind(c(as.vector(table(I)),NA_I,n_I1FT),
            round(100*c(as.vector(table(I)),NA_I,n_I1FT)/n_I1FT,1),
            c(as.vector(table(NI)),NA_NI,n_NI1FT),
            round(100*c(as.vector(table(NI)),NA_NI,n_NI1FT)/n_NI1FT,1))
rownames(EEExt)=Columnes

colnames(EEExt)=c("Feto muerto anteparto", "Feto vivo","Pérdidas", "Total Fetos")


t(EEExt) %>%
  kbl() %>%
  kable_styling()
```


```{r,include=FALSE}
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo de muerte anteparto en fetos de infectadas y de no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,3)`; 

* RA estimado de muerte anteparto relativo a infección de madre: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [$`r round(PT$conf.int,4)`$] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]



### Peso de neonatos al nacimiento


```{r}
I=c(Casos1w[Casos1w$Feto.muerto.intraútero=="No",]$Peso._gramos_...125,Casos1wGM[Casos1wGM$Feto.vivo=="Sí",]$Peso._gramos_...148)
NI=c(Controls1w[Controls1w$Feto.vivo...194=="Sí",]$Peso._gramos_...198,Controls1wGM[Controls1wGM$Feto.vivo...245=="Sí",]$Peso._gramos_...247)
```


```{r 108,fig.cap="\\s"}
data =data.frame(
  name=c(rep("Hijos de infectadas",length(I)), rep("Hijos de no infectadas",length(NI))),
  Pesos=c(I,NI)
  )

sample_size = data %>% group_by(name) %>% summarize(num=n())

data %>%
 left_join(sample_size) %>%
  mutate(myaxis = paste0(name, "\n", "n=", num)) %>%
  ggplot( aes(x=myaxis, y=Pesos, fill=name)) +
    geom_violin(width=0.9) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    #theme_ipsum() +
    theme(
      legend.position="none",
      plot.title = element_text(size=11)
    ) +
    xlab("")+
  ylab("Pesos (gramos)")
```




```{r}
Dades=rbind(c(min(I,na.rm=TRUE),max(I,na.rm=TRUE), round(mean(I,na.rm=TRUE),1),
               round(median(I,na.rm=TRUE),1),
              round(quantile(I,c(0.25,0.75),na.rm=TRUE),1),round(sd(I,na.rm=TRUE),1)),
            c(min(NI,na.rm=TRUE),max(NI,na.rm=TRUE), round(mean(NI,na.rm=TRUE),1),round(median(NI,na.rm=TRUE),1),
              round(quantile(NI,c(0.25,0.75),na.rm=TRUE),1),
              round(sd(NI,na.rm=TRUE),1)))


colnames(Dades)=c("Peso mínimo","Peso máximo","Peso medio","Peso mediano", "1er cuartil", "3er cuartil","Desv. típica")

rownames(Dades)=c("Infectadas", "No infectadas")

Dades %>%
  kbl() %>%
  kable_styling()
```


```{r,include=FALSE}
shapiro.test(I)$p.value
shapiro.test(NI)$p.value
fligner.test(list(I,NI))
ttest=t.test(I,NI)
```

* Ajuste de los pesos de hijos de infectadas y no infectadas a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I)$p.value,1)`$ y $`r 
signif(shapiro.test(NI)$p.value,1)`$, respectivamente

* Pesos medios: test t, p-valor `r round(ttest$p.value,4)`, IC del 95% para la diferencia de medias [`r round(ttest$conf.int,2)`] 

* Desviaciones típicas: test de Fligner-Killeen, p-valor  `r round(fligner.test(list(I,NI))$p.value,4)`


**Por lo que refiere a bajo peso:**


```{r}
I.cut=cut(I,breaks=c(0,2500,10000),labels=c(1,0),right=FALSE)
NI.cut=cut(NI,breaks=c(0,2500,10000),labels=c(1,0),right=FALSE)

n_I1U=length(I)
n_NI1U=length(NI)
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
```


```{r}
EE=rbind(as.vector(table(I.cut)),
         as.vector(table(NI.cut)))
EEExt=rbind(c(as.vector(table(I.cut)),NA_I),
            round(100*c(as.vector(table(I.cut)),NA_I)/n_I1U,1),
            c(as.vector(table(NI.cut)),NA_NI),
            round(100*c(as.vector(table(NI.cut)),NA_NI)/n_NI1U,1))
rownames(EEExt)=Columnes

colnames(EEExt)=c("Bajo peso", "No bajo peso ","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling()
```


```{r,include=FALSE}
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de bajo peso en hijos de madres infectadas y  no infectadas: test de Fisher bilateral, p-valor $`r signif(FT$p.value,1)`$; 

* RA estimado de bajo peso relativo a infección de madre: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]








###  Tests de Apgar



```{r}
I=c(Casos1w$APGAR.5...126,Casos1wGM$APGAR.5...150)
I.5=cut(I,breaks=c(-1,7,20),labels=c("0-7","8-10"))
NI=c(Controls1w$APGAR.5...200,Controls1wGM$APGAR.5...249)
NI.5=cut(NI,breaks=c(-1,7,20),labels=c("0-7","8-10"))
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
EE=rbind(as.vector(table(I.5)),
         as.vector(table(NI.5)))
EEExt=rbind(c(as.vector(table(I.5)),NA_I),
            round(100*c(as.vector(table(I.5)),NA_I)/length(I),1),
            c(as.vector(table(NI.5)),NA_NI),
            round(100*c(as.vector(table(NI.5)),NA_NI)/length(NI),1))
rownames(EEExt)=Columnes

colnames(EEExt)=c("Apgar.5≤7", "Apgar.5≥8 ","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling()
```


```{r,include=FALSE}
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo de Apgar.5≤7  en hijos de madres infectadas y  no infectadas: test de Fisher bilateral, p-valor `r round(FT$p.value,3)`; 

* RA estimado de Apgar.5≤7  relativo a infección de madre: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]



### Ingreso de los neonatos en UCIN



```{r}
I=c(Casos1w[Casos1w$Feto.muerto.intraútero=="No",]$Ingreso.en.UCIN,Casos1wGM[Casos1wGM$Feto.vivo=="Sí",]$Ingreso.en.UCI)
NI=c(Controls1w[Controls1w$Feto.vivo...194=="Sí",]$Ingreso.en.UCI...213,Controls1wGM[Controls1wGM$Feto.vivo...245=="Sí",]$Ingreso.en.UCI...260)
n_I1U=length(I)
n_NI1U=length(NI)
NA_I=length(I[is.na(I)])
NA_NI=length(NI[is.na(NI)])
```


```{r}
EE=rbind(as.vector(table(I))[2:1],
         as.vector(table(NI))[2:1])
EEExt=rbind(c(as.vector(table(I))[2:1],NA_I),
            round(100*c(as.vector(table(I))[2:1],NA_I)/n_I1U,1),
            c(as.vector(table(NI))[2:1],NA_NI),
            round(100*c(as.vector(table(NI))[2:1],NA_NI)/n_NI1U,1))
rownames(EEExt)=Columnes

colnames(EEExt)=c("UCIN", "No UCIN ","Pérdidas")


t(EEExt) %>%
  kbl() %>%
  kable_styling()
```


```{r,include=FALSE}
FT=fisher.test(EE)
PT=prop.test(EE[,1],rowSums(EE))
```

* Comparación de riesgo de ingreso en UCIN  en hijos de madres infectadas y  no infectadas: test de Fisher bilateral, p-valor $`r signif(FT$p.value,1)`$; 

* RA estimado de ingreso en UCIN relativo a infección de madre: `r round(PT$estimate[1]-PT$estimate[2],3)`; RR: `r round(PT$estimate[1]/PT$estimate[2],2)`

* IC 95% para el RA [`r round(PT$conf.int,4)`] y para el RR [`r round(RelRisk(EE,conf.level=0.95,method="score")[2:3],2)`]


## Descripción de casos por sintomatología



### Trimestre de infección

```{r}
Trim=Casos1w$Trim.Diag
Sint=Casos1w$SINTOMAS_DIAGNOSTICO
NA_T=length(Trim[is.na(Trim)])
NA_S=length(Sint[is.na(Sint)])

DF=data.frame(Trimestre=Trim,Síntomas=Sint)
taula=table(DF)
proptaula=round(100*prop.table(table(DF)),2)

EEExt=cbind(c(as.vector(taula[,1]),sum(taula[,1])),
            c(as.vector(proptaula[,1]), round(100*sum(taula[,1])/n_I1,2)),
            c(as.vector(taula[,2]),sum(taula[,2])),
            c(as.vector(proptaula[,2]), round(100*sum(taula[,2])/n_I1,2)),
            c(as.vector(taula[,3]),sum(taula[,3])),
            c(as.vector(proptaula[,3]), round(100*sum(taula[,3])/n_I1,2))
            )
rownames(EEExt)=c("1er trimestre", "2o trimestre", "3er trimestre","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling()
```



```{r 109,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=3),levels=c("Asintomática", "Leve", "Grave"))
Grupo=rep(c("1er trimestre", "2o trimestre", "3er trimestre") , 3)
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  xlab("Trimestre de infección")+
  ylab("")+
  scale_fill_brewer(palette = "Dark2") 
```



### Sintomatología vs edad



```{r}
I=Casos1w$Edad._años_
DF=data.frame(Edad=I,Sint=Casos1w$SINTOMAS_DIAGNOSTICO)



DF %>%
  ggplot( aes(x=Sint, y=Edad, fill=Sint)) +
    geom_violin(width=1) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    theme(
      legend.position="none",
      plot.title=element_text(size=11)
    ) +
    xlab("")+
  ylab("Edades (años)")+
 scale_fill_brewer(palette="Dark2")
```

```{r}
I1=I[Casos1w$SINTOMAS_DIAGNOSTICO=="Asintomática"]
I2=I[Casos1w$SINTOMAS_DIAGNOSTICO=="Leve"]
I3=I[Casos1w$SINTOMAS_DIAGNOSTICO=="Grave"]

Dades=rbind(c(round(min(I1,na.rm=TRUE),1),round(max(I1,na.rm=TRUE),1), round(mean(I1,na.rm=TRUE),1),round(median(I1,na.rm=TRUE),1),round(quantile(I1,c(0.25,0.75),na.rm=TRUE),1), round(sd(I1,na.rm=TRUE),1)),
            c(round(min(I2,na.rm=TRUE),1),round(max(I2,na.rm=TRUE),1), round(mean(I2,na.rm=TRUE),1),round(median(I2,na.rm=TRUE),1),round(quantile(I2,c(0.25,0.75),na.rm=TRUE),1), round(sd(I2,na.rm=TRUE),1)),
            c(round(min(I3,na.rm=TRUE),1),round(max(I3,na.rm=TRUE),1), round(mean(I3,na.rm=TRUE),1),round(median(I3,na.rm=TRUE),1),round(quantile(I3,c(0.25,0.75),na.rm=TRUE),1), round(sd(I3,na.rm=TRUE),1)))

colnames(Dades)=c("Edad mínima","Edad máxima","Edad  media", "Edad  mediana", "1er cuartil", "3er cuartil", "Desv. típica")
rownames(Dades)=c("Asintomática", "Leve","Grave")

Dades %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")


```


```{r,include=FALSE}

shapiro.test(I1)$p.value
shapiro.test(I2)$p.value
shapiro.test(I3)$p.value

kruskal.test(Edad~Sint,data=DF)$p.value

pairwise.wilcox.test(I,Sint,p.adjust.method = "bonferroni")$p.value
```

* Ajuste de las edades maternas a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I1)$p.value,1)`$, $`r 
signif(shapiro.test(I2)$p.value,1)`$ y `r 
round(shapiro.test(I3)$p.value,4)`, respectivamente




* Edades medias: test de Kruskal-Wallis, p-valor `r kruskal.test(Edad~Sint,data=DF)$p.value`


* Desviaciones típicas: test de Fligner-Killeen, p-valor  `r round(fligner.test(list(I,I2,I3))$p.value,3)`

* Contrastes pot hoc por parejas

```{r}
Contraste=c("Asíntomatica vs Leve","Asíntomatica vs Grave", "Leve vs Grave")

pvals=round(p.adjust(c(t.test(I1,I2,var.equal=TRUE)$p.value, t.test(I1,I3,var.equal=TRUE)$p.value,
            t.test(I2,I3,var.equal=TRUE)$p.value),,method="bonferroni"),4)
dades=data.frame(Contraste=Contraste,"p-valor"=pvals)
dades %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")

```




```{r}
I=Casos1w$Edad._años_
I.cut=cut(I,breaks=c(0,30,40,100),labels=c("18-30","31-40",">40"))

DF=data.frame(Edad=I.cut,Síntomas=Sint)
taula=table(DF)
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(as.vector(taula[,1]),
            as.vector(proptaula[,1]),
            as.vector(taula[,2]),
            as.vector(proptaula[,2]),
            as.vector(taula[,3]),
            as.vector(proptaula[,3])
            )
rownames(EEExt)=c("18-30", "31-40", ">40")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling()
```


```{r 110,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=3),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(c("18-30","31-40",">40") , 3),levels=c("18-30","31-40",">40"))
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  xlab("Edad")+
  ylab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y las franjas de edad: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`

* Tabla de p-valores  ajustados por Bonferroni de  tests de diferencia en la tendencia de la gravedad en cada franja de edad respecto del global: 


```{r}
EE=taula
ppTR=rep(0,dim(EE)[1])
for (i in 1:dim(EE)[1]){
ppTR[i]=Prop.trend.test(EE[i,],colSums(EE))
}
ppTR=p.adjust(ppTR,method="bonferroni")
dt=data.frame(franja=c("18-30","31-40",">40"),ppTR)
names(dt)=c("Franja de edad", "p-valor trend test (ajustado)")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



### Sintomatología vs etnia 



```{r}
I=Casos1w$Etnia

DF=data.frame(Etnia=I,Síntomas=Sint)
taula=table(DF)[c(1,2,3,4,5),]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(as.vector(taula[,1]),
            as.vector(proptaula[,1]),
            as.vector(taula[,2]),
            as.vector(proptaula[,2]),
            as.vector(taula[,3]),
            as.vector(proptaula[,3])
            )
rownames(EEExt)=c("Árabe", "Asia", "Blanca", "Latinoamericana","Negra")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling()
```


```{r 111,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=5),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(c("Árabe", "Asia", "Blanca", "Latinoamericana","Negra") , 3),levels=c("Árabe", "Asia", "Blanca", "Latinoamericana","Negra"))
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  xlab("Etnia")+
  ylab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y las etnias: test $\chi^2$, p-valor $`r signif(chisq.test(taula)$p.value,1)`$

* Tabla de p-valores  ajustados por Bonferroni de tests de diferencia en la tendencia de la gravedad en cada franja de edad respecto del global: 


```{r}
EE=taula
ppTR=rep(0,dim(EE)[1])
for (i in 1:dim(EE)[1]){
ppTR[i]=Prop.trend.test(EE[i,],colSums(EE))
}
ppTR=p.adjust(ppTR,method="bonferroni")
dt=data.frame(franja=c("Árabe", "Asia", "Blanca", "Latinoamericana","Negra"),ppTR)
names(dt)=c("Etnia", "p-valor trend test (ajustado)")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



### Sintomatología vs estatus de fumadora


```{r 112,fig.cap="\\s"}
I=Casos1w$FUMADORA_CAT
taula=table(data.frame(I,Sint))[c(2,1) ,]
Tabla.DGSW(I,"Fumadoras", "No fumadoras")
Barplot.DGSW(I,"Fumadoras", "No fumadoras")
```



* Asociación entre los grupos de sintomatología y el hábito tabáquico: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`

### Sintomatología vs obesidad


```{r 113,fig.cap="\\s"}
I=Casos1w$Obesidad
taula=table(data.frame(I,Sint))[c(2,1) ,]
Tabla.DGSW(I,"Obesas", "No obesas")
Barplot.DGSW(I,"Obesas", "No obesas")
```





### Sintomatología vs hipertensión




```{r 114,fig.cap="\\s"}
I=Casos1w$Hipertensión.pregestacional
taula=table(data.frame(I,Sint))[c(2,1) ,]
Tabla.DGSW(I,"HTA", "No HTA")
Barplot.DGSW(I,"HTA", "No HTA")
```




* Asociación entre los grupos de sintomatología y la hipertensión: test $\chi^2$ de Montecarlo, p-valor `r round(chisq.test(taula, simulate.p.value=TRUE,B=10000)$p.value,3)`

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


### Sintomatología vs diabetes





```{r 115,fig.cap="\\s"}
I=Casos1w$DIABETES
taula=table(data.frame(I,Sint))[c(2,1) ,]
Tabla.DGSW(I,"DM", "No DM")
Barplot.DGSW(I,"DM", "No DM")
```



* Asociación entre los grupos de sintomatología y la diabetes: test $\chi^2$ de Montecarlo, p-valor `r round(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`

### Sintomatología vs cardiopatía





```{r 116,fig.cap="\\s"}
I=Casos1w$Enfermedad.cardiaca.crónica
taula=table(data.frame(I,Sint))[c(2,1) ,]
Tabla.DGSW(I,"ECC", "No ECC")
Barplot.DGSW(I,"ECC", "No ECC")
```


* Asociación entre los grupos de sintomatología y  ECC: test $\chi^2$ de Montecarlo, p-valor `r round(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`



### Sintomatología vs enfermedad pulmonar crónica 







```{r 117,fig.cap="\\s"}
INA=Casos1w$Enfermedad.pulmonar.crónica.no.asma
IA=Casos1w$Diagnóstico.clínico.de.Asma
I=rep(NA,length(Sint))
for (i in 1:length(Sint)){I[i]=max(INA[i],IA[i],na.rm=TRUE)}
taula=table(data.frame(I,Sint))[c(2,1) ,]
Tabla.DGSW(I,"EPC", "No EPC")
Barplot.DGSW(I,"EPC", "No EPC")
```



* Asociación entre los grupos de sintomatología y EPC: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


### Sintomatología vs gestación múltiple



```{r 167,fig.cap="\\s"}
I=Casos1w$Gestación.Múltiple
taula=table(data.frame(I,Sint))[c(2,1) ,]
Tabla.DGSW(I,"Gestación múltiple", "Gestación única")
Barplot.DGSW(I,"Gestación múltiple", "Gestación única")
```

* Asociación entre los grupos de sintomatología y EPC: test $\chi^2$, p-valor `r round(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`

### Sintomatología vs paridad



```{r 168,fig.cap="\\s"}
I=Casos1w$NULIPARA
taula=table(data.frame(I,Sint))[c(2,1) ,]
Tabla.DGSW(I,"Multiparas", "Nuliparas")
Barplot.DGSW(I,"Multiparas", "Nuliparas")
```

* Asociación entre los grupos de sintomatología y EPC: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`



### Sintomatología vs anomalía congénita





```{r 118,fig.cap="\\s"}
I=Casos1w$Diagnóstico.de.malformación.ecográfica._.semana.20._
taula=table(data.frame(I,Sint))[c(2,1) ,]
Tabla.DGSW(I,"Anomalías congénitas", "No anomalías congénitas")
Barplot.DGSW(I,"Anomalías congénitas", "No anomalías congénitas")
```



* Asociación entre los grupos de sintomatología y anomalía congénita: test $\chi^2$ de Montecarlo, p-valor `r round(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


### Sintomatología vs retraso del crecimiento intrauterino 




```{r 119,fig.cap="\\s"}
I=Casos1w$Defecto.del.crecimiento.fetal..en.tercer.trimestre._.CIR._.
taula=table(data.frame(I,Sint))[c(2,1) ,]
Tabla.DGSW(I,"RCIU", "No RCIU")
Barplot.DGSW(I,"RCIU", "No RCIU")
```




* Asociación entre los grupos de sintomatología y retraso del crecimiento intrauterino : test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`

### Sintomatología vs diabetes gestacional 

```{r 120,fig.cap="\\s"}
I=Casos1w$Diabetes.gestacional
taula=table(data.frame(I,Sint))[c(2,1) ,]
Tabla.DGSW(I,"DG", "No DG")
Barplot.DGSW(I,"DG", "No DG")
```



* Asociación entre los grupos de sintomatología y diabetes gestacional: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


### Sintomatología vs hipertensión gestacional





```{r 121,fig.cap="\\s"}
I=Casos1w$Hipertensión.gestacional
taula=table(data.frame(I,Sint))[c(2,1) ,]
Tabla.DGSW(I,"HG", "No HG")
Barplot.DGSW(I,"HG", "No HG")
```




* Asociación entre los grupos de sintomatología e hipertensión gestacional: test $\chi^2$ de Montecarlo, p-valor `r round(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`

### Sintomatología vs rotura prematura de membranas







```{r 122,fig.cap="\\s"}
I=Casos1w$Bolsa.rota.anteparto
taula=table(data.frame(I,Sint))[c(2,1) ,]
Tabla.DGSW(I,"RPM", "No RPM")
Barplot.DGSW(I,"RPM", "No RPM")
```

* Asociación entre los grupos de sintomatología y rotura prematura de membranas: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`

### Sintomatología vs preeclamspia






```{r 123,fig.cap="\\s"}
I=Casos1w$PREECLAMPSIA_ECLAMPSIA_TOTAL
taula=table(data.frame(I,Sint))[c(2,1) ,]
Tabla.DGSW(I,"PE", "No PE")
Barplot.DGSW(I,"PE", "No PE")
```



* Asociación entre los grupos de sintomatología y preeclampsia: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


### Sintomatología vs preeclampsia con CG




```{r}
n_PI=sum(Casos1w$PREECLAMPSIA_ECLAMPSIA_TOTAL)
I=Casos1w[Casos1w$PREECLAMPSIA_ECLAMPSIA_TOTAL==1,]$Preeclampsia.grave_HELLP_ECLAMPSIA
DF=data.frame(Factor=I,Síntomas=Sint[Casos1w$PREECLAMPSIA_ECLAMPSIA_TOTAL==1])

taula=table(DF)[c(2,1),]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(as.vector(taula[,1]),
            as.vector(proptaula[,1]),
            as.vector(taula[,2]),
            as.vector(proptaula[,2]),
            as.vector(taula[,3]),
            as.vector(proptaula[,3])
            )
rownames(EEExt)=c("PE con CG", "PE sin CG")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling()
```


```{r 124,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=2),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(rownames(EEExt) , 3),levels=rownames(EEExt))
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y preeclampsia con criterios de gravedad en preeclampsia: test $\chi^2$ de Montecarlo, p-valor `r round(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,3)`


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


### Sintomatología vs eventos hemorrágicos








```{r 125,fig.cap="\\s"}
I=Casos1w$EVENTOS_HEMORRAGICOS_TOTAL
taula=table(data.frame(I,Sint))[c(2,1) ,]
Tabla.DGSW(I,"Eventos hemorrágicos", "No eventos hemorrágicos")
Barplot.DGSW(I,"Eventos hemorrágicos", "No eventos hemorrágicos")
```


* Asociación entre los grupos de sintomatología y evento hemorrágico: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`

### Sintomatología vs hemorragia postparto




```{r 146,fig.cap="\\s"}
I=Casos1w$Hemorragia.postparto
I.sino=I
I.sino[!is.na(I.sino)& I.sino!="No"]="Sí"
taula=table(data.frame(I.sino,Sint))[c(2,1) ,]
Tabla.DGSW(I.sino,"HPP", "No HPP")
Barplot.DGSW(I.sino,"HPP", "No HPP")
```


* Asociación entre los grupos de sintomatología y la presencia de hemorragia postparto: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`




```{r}
DF=data.frame(Factor=I,Síntomas=Sint)
taula=table(DF)[c(1,2,3) ,]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(as.vector(taula[,1]),
            as.vector(proptaula[,1]),
            as.vector(taula[,2]),
            as.vector(proptaula[,2]),
            as.vector(taula[,3]),
            as.vector(proptaula[,3])
            )
rownames(EEExt)=c("Histerectomía",       "Tto. médico",
  "Tto. Qx. conservador")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling()
```


```{r 126,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=3),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(rownames(EEExt) , 3),levels=rownames(EEExt))
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y el tipo de hemorragia postparto: test $\chi^2$ de Montecarlo, p-valor `r  round(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,3)`






### Sintomatología vs eventos trombóticos





```{r 127,fig.cap="\\s"}
I=Casos1w$EVENTOS_TROMBO_TOTALES
taula=table(data.frame(I,Sint))[c(2,1) ,]
Tabla.DGSW(I,"Eventos trombóticos", "No eventos trombóticos")
Barplot.DGSW(I,"Eventos trombóticos", "No eventos trombóticos")
```



* Asociación entre los grupos de sintomatología y evento trombótico: test $\chi^2$ de Montecarlo, p-valor $`r signif(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,1)`$

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


### Sintomatología vs UCi madre (Sí-No)





```{r 128,fig.cap="\\s"}
I=Casos1w$UCI
taula=table(data.frame(I,Sint))[c(2,1) ,]
Tabla.DGSW(I,"UCI", "No UCI")
Barplot.DGSW(I,"UCI", "No UCI")
```


* Asociación entre los grupos de sintomatología e ingreso en UCI de la madre: test $\chi^2$, p-valor $`r signif(chisq.test(taula)$p.value,1)`$


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


### Sintomatología vs UCi madre (antes-después)


```{r}
UCI.I=sum(Casos1w$UCI,na.rm=TRUE)
I=Casos1w$UCI_ANTES.DESPUES.DEL.PARTO
DF=data.frame(Factor=I,Síntomas=Sint)
taula=table(DF)[c(2,1),]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(as.vector(taula[,1]),
            as.vector(proptaula[,1]),
            as.vector(taula[,2]),
            as.vector(proptaula[,2]),
            as.vector(taula[,3]),
            as.vector(proptaula[,3])
            )
rownames(EEExt)=c("UCI antes del parto", "UCI después del parto")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling()
```


```{r 129,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=2),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(rownames(EEExt) , 3),levels=rownames(EEExt))
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y el momento de ingreso en UCI:  test $\chi^2$ de Montecarlo, p-valor `r round(chisq.test(taula,simulate.p.value=TRUE,B=10000)$p.value,3)`

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`


### Sintomatología vs prematurez



```{r 130,fig.cap="\\s"}
I=Casos1w$PREMATURO
taula=table(data.frame(I,Sint))[c(2,1) ,]
Tabla.DGSW(I,"Prematuro", "A término")
Barplot.DGSW(I,"Prematuro", "A término")
```



* Asociación entre los grupos de sintomatología y el momento de ingreso en UCI:  test $\chi^2$, p-valor $`r signif(chisq.test(taula)$p.value,1)`$


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`

### Sintomatología vs APGAR


```{r}
I=c(Casos1w$APGAR.5...126,Casos1wGM$APGAR.5...150)
I=cut(I,breaks=c(-1,7,20),labels=c("0-7","8-10"))

SintN=c(Casos1w$SINTOMAS_DIAGNOSTICO,Casos1wGM$SINTOMAS_DIAGNOSTICO)

DF=data.frame(Factor=I,Síntomas=SintN)
taula=table(DF)[c(2,1),]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(as.vector(taula[,1]),
            as.vector(proptaula[,1]),
            as.vector(taula[,2]),
            as.vector(proptaula[,2]),
            as.vector(taula[,3]),
            as.vector(proptaula[,3])
            )
rownames(EEExt)=c("Apgar.5≤7", "Apgar.5≥8 ")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling()
```


```{r 131,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=2),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(rownames(EEExt) , 3),levels=rownames(EEExt))
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y APGAR bajo: test $\chi^2$, p-valor `r round(chisq.test(taula)$p.value,3)`

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`



### Sintomatología vs UCI neonato



```{r}
I=c(Casos1w[Casos1w$Feto.muerto.intraútero=="No",]$Ingreso.en.UCIN,Casos1wGM[Casos1wGM$Feto.vivo=="Sí",]$Ingreso.en.UCI)
SintN=c(Casos1w[Casos1w$Feto.muerto.intraútero=="No",]$SINTOMAS_DIAGNOSTICO,Casos1wGM[Casos1wGM$Feto.vivo=="Sí",]$SINTOMAS_DIAGNOSTICO)

DF=data.frame(Factor=I,Síntomas=SintN)
taula=table(DF)[c(2,1),]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(as.vector(taula[,1]),
            as.vector(proptaula[,1]),
            as.vector(taula[,2]),
            as.vector(proptaula[,2]),
            as.vector(taula[,3]),
            as.vector(proptaula[,3])
            )
rownames(EEExt)=c("UCIN", "No UCIN")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling()
```



```{r 132,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=2),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(rownames(EEExt) , 3),levels=rownames(EEExt))
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y ingreso en UCIN: test $\chi^2$, p-valor $`r signif(chisq.test(taula)$p.value,1)`$

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`



### Sintomatología vs Fetos muertos anteparto 



```{r}
I1=Casos1w$Feto.muerto.intraútero
I1[I1=="Sí"]="Muerto"
I1[I1=="No"]="Vivo"
I2=Casos1wGM$Feto.vivo
I2[I2=="Sí"]="Vivo"
I2[I2=="No"]="Muerto"
I=c(I1,I2)
SintN1=Casos1w$SINTOMAS_DIAGNOSTICO
SintN2=Casos1wGM$SINTOMAS_DIAGNOSTICO
SintN=c(SintN1,SintN2)

DF=data.frame(Factor=I,Síntomas=SintN)
taula=table(DF)[c(1,2),]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(as.vector(taula[,1]),
            as.vector(proptaula[,1]),
            as.vector(taula[,2]),
            as.vector(proptaula[,2]),
            as.vector(taula[,3]),
            as.vector(proptaula[,3])
            )
rownames(EEExt)=c("Feto muerto anteparto", "Feto vivo")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling()
```



```{r 145,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=2),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(rownames(EEExt) , 3),levels=rownames(EEExt))
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y muerte fetal: test $\chi^2$, p-valor $`r signif(chisq.test(taula)$p.value,1)`$

* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor `r round(Prop.trend.test(taula[1,],colSums(taula)),4)`



### Sintomatología vs inicio de parto



```{r}
I=Casos1w$Inicio.de.parto
DF=data.frame(Factor=I,Síntomas=Sint)
taula=table(DF)[c(2,3,1),]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(as.vector(taula[,1]),
            as.vector(proptaula[,1]),
            as.vector(taula[,2]),
            as.vector(proptaula[,2]),
            as.vector(taula[,3]),
            as.vector(proptaula[,3])
            )
rownames(EEExt)=c("Espontáneo", "Inducido","Cesárea programada")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling()
```


```{r 133,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=3),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(rownames(EEExt) , 3),levels=rownames(EEExt))
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("Inicio de parto")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y el inicio de parto: test $\chi^2$, p-valor $`r signif(chisq.test(taula)$p.value,1)`$

* Tabla de p-valores  ajustados por Bonferroni de tests de diferencia en la tendencia de la gravedad en cada franja de edad respecto del global: 


```{r}
EE=taula
ppTR=rep(0,dim(EE)[1])
for (i in 1:dim(EE)[1]){
ppTR[i]=Prop.trend.test(EE[i,],colSums(EE))
}
ppTR=p.adjust(ppTR,method="bonferroni")
dt=data.frame(franja=c("Espontáneo", "Inducido","Cesárea programada"),ppTR)
names(dt)=c("Inicio de parto", "p-valor trend test (ajustado)")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```




### Sintomatología vs tipo de parto



```{r}
I.In=Casos1w$Inicio.de.parto
I.In[I.In=="Cesárea"]="Cesárea programada"
I=Casos1w$Tipo.de.parto
I[I.In=="Cesárea programada"]="Cesárea programada"
I[I=="Cesárea"]="Cesárea urgente"

DF=data.frame(Factor=I,Síntomas=Sint)
taula=table(DF)[c(3,4,1,2),]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(as.vector(taula[,1]),
            as.vector(proptaula[,1]),
            as.vector(taula[,2]),
            as.vector(proptaula[,2]),
            as.vector(taula[,3]),
            as.vector(proptaula[,3])
            )
rownames(EEExt)=c("Eutocico", "Instrumental", "Cesárea programada", "Cesárea urgente")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling()
```



```{r 134,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=4),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(rownames(EEExt) , 3),levels=rownames(EEExt))
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("Tipo de parto")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y tipos de parto: test $\chi^2$, p-valor `r signif(chisq.test(taula)$p.value,1)`

* Tabla de p-valores  ajustados por Bonferroni de  tests de diferencia en la tendencia de la gravedad en cada franja de edad respecto del global: 


```{r}
EE=taula
ppTR=rep(0,dim(EE)[1])
for (i in 1:dim(EE)[1]){
ppTR[i]=Prop.trend.test(EE[i,],colSums(EE))
}
ppTR=p.adjust(ppTR,method="bonferroni")
dt=data.frame(franja=c("Eutocico", "Instrumental", "Cesárea programada", "Cesárea urgente"),ppTR)
names(dt)=c("Tipo de parto", "p-valor trend test (ajustado)")
dt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```




### Edades gestacionales infectadas 1a ola




```{r 135,fig.cap="\\s"}
I=Casos1w$EG_TOTAL_PARTO
Síntomas=ordered(Sint,levels=c("Asintomática" ,"Leve",      "Grave"  ))
data =data.frame(
  Síntomas,
  Edades=I
)

data %>%
  ggplot( aes(x=Síntomas, y=Edades, fill=Síntomas)) +
    geom_violin(width=1) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    #theme_ipsum() +
    theme(
      legend.position="none",
      plot.title = element_text(size=11)
    ) +
    xlab("")+
   ylab("Edades gestacionales (semanas)")+
  scale_fill_brewer(palette = "Dark2") 

```


```{r}
Dades=rbind(c(round(min(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1),round(max(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1), round(mean(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1),
              round(median(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1),
              round(quantile(I[data$Síntomas=="Asintomática"],c(0.25,0.75),na.rm=TRUE),1),
              round(sd(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1)),
   c(round(min(I[data$Síntomas=="Leve"],na.rm=TRUE),1),round(max(I[data$Síntomas=="Leve"],na.rm=TRUE),1), round(mean(I[data$Síntomas=="Leve"],na.rm=TRUE),1),
       round(median(I[data$Síntomas=="Leve"],na.rm=TRUE),1),
              round(quantile(I[data$Síntomas=="Leve"],c(0.25,0.75),na.rm=TRUE),1),round(sd(I[data$Síntomas=="Leve"],na.rm=TRUE),1)),         
  c(round(min(I[data$Síntomas=="Grave"],na.rm=TRUE),1),round(max(I[data$Síntomas=="Grave"],na.rm=TRUE),1), round(mean(I[data$Síntomas=="Grave"],na.rm=TRUE),1),round(median(I[data$Síntomas=="Grave"],na.rm=TRUE),1),
              round(quantile(I[data$Síntomas=="Grave"],c(0.25,0.75),na.rm=TRUE),1),round(sd(I[data$Síntomas=="Grave"],na.rm=TRUE),1))          )

colnames(Dades)=c("Edad gest. mínima","Edad gest.  máxima","Edad gest.  media",
                  "Edad gest. mediana", "1er cuartil", "3er cuartil","Desv. típica")
rownames(Dades)=c("Asintomática" ,"Leve",      "Grave"  )

Dades %>%
  kbl() %>%
  kable_styling()


```

```{r,include=FALSE}

shapiro.test(I)$p.value
kruskal.test(Factor~Síntomas,data=DF)$p.value

pairwise.wilcox.test(I,Sint,p.adjust.method = "bonferroni")$p.value
```

* Ajuste de las edades gestacionales de cada nivel a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I[Sint=="Asintomática"])$p.value,1)`$, $`r signif(shapiro.test(I[Sint=="Leve"])$p.value,1)`$, $`r signif(shapiro.test(I[Sint=="Grave"])$p.value,1)`$, respectivamente

* Homocedasticidad: Test de Fligner-Killeen, p-valor $`r signif(fligner.test(I~Sint)$p.value,1)`$ 

* Edades gestacionales medias: test de Kruskal-Wallis, p-valor  $`r signif(kruskal.test(I~Síntomas,data=DF)$p.value,1)`$

* Contrastes posteriores de edades gestacionales medias por parejas:  tests de Mann-Whitney,p-valores ajustados por Bonferroni:

    * Asintomática vs Leve: $`r signif(pairwise.wilcox.test(I,Sint,p.adjust.method = "bonferroni")$p.value[1,1],1)`$
    * Asintomática vs Grave: $`r signif(pairwise.wilcox.test(I,Sint,p.adjust.method = "bonferroni")$p.value[2,1],1)`$
    * Leve  vs Grave: `r round(pairwise.wilcox.test(I,Sint,p.adjust.method = "bonferroni")$p.value[2,2],3)`

    



### Pesos  hijos infectadas 1a ola


```{r 136,fig.cap="\\s"}
SintN=c(Casos1w[Casos1w$Feto.muerto.intraútero=="No",]$SINTOMAS_DIAGNOSTICO,Casos1wGM[Casos1wGM$Feto.vivo=="Sí",]$SINTOMAS_DIAGNOSTICO)
Síntomas=ordered(SintN[!is.na(SintN)],levels=c("Asintomática" ,"Leve",      "Grave"  ))
Síntomas=SintN[!is.na(SintN)]

I=c(Casos1w[Casos1w$Feto.muerto.intraútero=="No",]$Peso._gramos_...125,Casos1wGM[Casos1wGM$Feto.vivo=="Sí",]$Peso._gramos_...148)
I=I[!is.na(SintN)]

data =data.frame(
  Síntomas,
  Pesos=I
)

data %>%
  ggplot( aes(x=Síntomas, y=Pesos, fill=Síntomas)) +
    geom_violin(width=1) +
    geom_boxplot(width=0.1, color="black", alpha=0.2,outlier.fill="black",
               outlier.size=1) +
    #theme_ipsum() +
    theme(
      legend.position="none",
      plot.title = element_text(size=11)
    ) +
    xlab("")+
   ylab("Pesos (gramos)")+
  scale_fill_brewer(palette = "Dark2") 
```



```{r}
Dades=rbind(c(round(min(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1),round(max(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1), round(mean(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1),
              round(median(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1),
              round(quantile(I[data$Síntomas=="Asintomática"],c(0.25,0.75),na.rm=TRUE),1),
              round(sd(I[data$Síntomas=="Asintomática"],na.rm=TRUE),1)),
   c(round(min(I[data$Síntomas=="Leve"],na.rm=TRUE),1),round(max(I[data$Síntomas=="Leve"],na.rm=TRUE),1), round(mean(I[data$Síntomas=="Leve"],na.rm=TRUE),1),
       round(median(I[data$Síntomas=="Leve"],na.rm=TRUE),1),
              round(quantile(I[data$Síntomas=="Leve"],c(0.25,0.75),na.rm=TRUE),1),round(sd(I[data$Síntomas=="Leve"],na.rm=TRUE),1)),         
  c(round(min(I[data$Síntomas=="Grave"],na.rm=TRUE),1),round(max(I[data$Síntomas=="Grave"],na.rm=TRUE),1), round(mean(I[data$Síntomas=="Grave"],na.rm=TRUE),1),round(median(I[data$Síntomas=="Grave"],na.rm=TRUE),1),
              round(quantile(I[data$Síntomas=="Grave"],c(0.25,0.75),na.rm=TRUE),1),round(sd(I[data$Síntomas=="Grave"],na.rm=TRUE),1))          )
colnames(Dades)=c("Peso. mínimo","Peso.  máximo","Peso.  medio","Peso mediano", "1er cuartil", "3er cuartil","Desv. típica")
rownames(Dades)=c("Asintomática" ,"Leve",      "Grave"  )

Dades %>%
  kbl() %>%
  kable_styling()


```

```{r,include=FALSE}

shapiro.test(I)$p.value
kruskal.test(I~Síntomas)$p.value
```

* Ajuste de los pesos de cada nivel a distribuciones normales: test de Shapiro-Wilks, p-valores $`r signif(shapiro.test(I[SintN=="Asintomática"])$p.value,1)`$, $`r signif(shapiro.test(I[SintN=="Leve"])$p.value,1)`$, $`r signif(shapiro.test(I[SintN=="Grave"])$p.value,1)`$, respectivamente

* Homocedasticidad: Test de Fligner-Killeen, p-valor $`r signif(fligner.test(I~Síntomas)$p.value,1)`$ 


* Pesos medios: test de Kruskal-Wallis, p-valor  `r round(kruskal.test(I~Síntomas)$p.value,3)`

Bajo peso:


```{r}
I.cut=cut(I,breaks=c(0,2500,10000),labels=c(1,0),right=FALSE)

DF=data.frame(Factor=I.cut,Síntomas=Síntomas)
taula=table(DF)[,c(1,2,3)]
proptaula=round(100*prop.table(taula,margin=2),2)

EEExt=cbind(c(as.vector(taula[,1]),length(I.cut[Síntomas=="Asintomática"])-sum(as.vector(taula[,1]))),
            round(100*c(as.vector(taula[,1]),length(I.cut[Síntomas=="Asintomática"])-sum(as.vector(taula[,1])))/length(I.cut[Síntomas=="Asintomática"]),2),
            c(as.vector(taula[,2]),length(I.cut[Síntomas=="Leve"])-sum(as.vector(taula[,2]))),
            round(100*c(as.vector(taula[,2]),length(I.cut[Síntomas=="Leve"])-sum(as.vector(taula[,2])))/length(I.cut[Síntomas=="Leve"]),2),
             c(as.vector(taula[,3]),length(I.cut[Síntomas=="Grave"])-sum(as.vector(taula[,3]))),
            round(100*c(as.vector(taula[,3]),length(I.cut[Síntomas=="Grave"])-sum(as.vector(taula[,3])))/length(I.cut[Síntomas=="Grave"]),2)
           )
EEExt=rbind(EEExt,c(length(I.cut[Síntomas=="Asintomática"]),100,length(I.cut[Síntomas=="Leve"]),100,length(I.cut[Síntomas=="Grave"]),100))

rownames(EEExt)=c("Bajo peso", "No bajo peso","Pérdidas","Total")
colnames(EEExt)=Columnes.Sint

EEExt %>%
  kbl() %>%
  kable_styling() %>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



```{r 186,fig.cap="\\s"}
Síntomas=ordered(rep(c("Asintomática", "Leve", "Grave"), each=2),levels=c("Asintomática", "Leve", "Grave"))
Grupo=ordered(rep(rownames(EEExt)[1:2] , 3),levels=rownames(EEExt)[1:2])
valor=as.vector(prop.table(taula, margin=1))
data <- data.frame(Grupo,Síntomas,valor)

ggplot(data, aes(fill=Síntomas, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  scale_fill_brewer(palette = "Dark2") 
```

* Asociación entre los grupos de sintomatología y bajo peso: test $\chi^2$, p-valor $`r signif(chisq.test(taula)$p.value,1)`$


* Test de diferencia en la tendencia de la gravedad respecto del global: p-valor $`r signif(Prop.trend.test(taula[1,],colSums(taula)),1)`$


<!--chapter:end:2.1aola.Rmd-->

# Grupos Robson


## Muestra global




```{r}
Ola=factor(c(rep("1a ola",n_I1+n_NI1), rep("2a ola",n_I2+n_NI2)))
Grupos=c(Casos1w$Robson,Controls1w$Robson,Casos2w$Robson,Controls2w$Robson)
tabla=data.frame(Robson=c(1:10,"Pérdidas"),
                table(Ola,Grupos)[1,c(2:11,1)],
table(Ola,Grupos)[2,c(2:11,1)])

row.names(tabla)=c()
names(tabla)=c("Grupo Robson","1a ola","2a ola")

tabla %>%  
  kbl() %>%
  kable_styling()
```


```{r ,fig.cap="\\s"}
Tipo=factor(rep(c("1a ola","2a ola"), each=10))
Grupo=factor(rep(1:10 , 2))
valor=as.vector(c(prop.table(table(c(Casos1w$Robson,Controls1w$Robson))[c(2:11)]),prop.table(table(c(Casos2w$Robson,Controls2w$Robson))[c(2:11)])))
data=data.frame(Grupo,Tipo,valor)

ggplot(data, aes(fill=Tipo, y=valor, x=Grupo)) + 
  geom_bar(position="dodge", stat="identity")+
  ylab("")+
  xlab("")+
  ggtitle("Distribución de grupos Robson en las dos olas")+
  scale_fill_brewer(palette = "Pastel2") 
```

```{r,include=FALSE}
A=rbind(table(c(Casos1w$Robson,Controls1w$Robson))[c(2:11)],table(c(Casos2w$Robson,Controls2w$Robson))[c(2:11)])
CT=chisq.test(A,simulate.p.value = TRUE)$p.value
```

Diferencia en la distribución de grupos Robson en las dos olas: Test $\chi^2$ de Montecarlo (hay muy pocas gestantes del grupo 9), p-valor `r round(CT,3)`. No hay evidencia de diferencia en la distribución de los grupos en las dos olas.




### Infectadas

```{r}
TRCa=table(Casos$Robson,Casos$Cesárea) 

DFTRCa=data.frame(Robson=c(1:10,"Pérdidas"),Gestantes=as.vector(table(Casos$Robson)[c(2:11,1)]),Cesáreas=TRCa[c(2:11,1),2], Porcentaje=round(100*prop.table(TRCa,margin=1)[c(2:11,1),2],2))
row.names(DFTRCa)=c()

DFTRCa %>%  
  kbl() %>%
  kable_styling()
```




```{r ,fig.cap="\\s"}
Tipo=factor(rep(c("Cesárea","No cesárea"), each=10))
Grupo=factor(rep(1:10 , 2))
valor=as.vector(TRCa[c(2:11),2:1])
data=data.frame(Grupo,Tipo,valor)

ggplot(data, aes(fill=Tipo, y=valor, x=Grupo)) + 
  geom_bar(position="stack", stat="identity")+
  ylab("")+
  xlab("")+
  ggtitle("Cesáreas en grupos Robson de infectadas")+
  scale_fill_brewer(palette = "Pastel1") 
```


### No infectadas

```{r}
TRCo=table(Controls$Robson,Controls$Cesárea) 
DFTRCo=data.frame(Robson=c(1:10,"Pérdidas"),Gestantes=as.vector(table(Controls$Robson)[c(2:11,1)]),Cesáreas=TRCo[c(2:11,1),2], Porcentaje=round(100*prop.table(TRCo,margin=1)[c(2:11,1),2],2))
row.names(DFTRCo)=c()
DFTRCo %>%  
  kbl() %>%
  kable_styling()
```



```{r ,fig.cap="\\s"}
Tipo=factor(rep(c("Cesárea","No cesárea"), each=10))
Grupo=factor(rep(1:10 , 2))
valor=as.vector(TRCo[c(2:11),2:1])
data=data.frame(Grupo,Tipo,valor)

ggplot(data, aes(fill=Tipo, y=valor, x=Grupo)) + 
  geom_bar(position="stack", stat="identity")+
  ylab("")+
  xlab("")+
  ggtitle("Cesáreas en grupos Robson de no infectadas")+
  scale_fill_brewer(palette = "Pastel1") 
```

### Diferencias?



```{r,include=FALSE}
A=rbind(table(Casos$Robson)[c(2:11)],table(Controls$Robson)[c(2:11)])
CT=chisq.test(A,simulate.p.value = TRUE)$p.value
```

Diferencia en la distribución de grupos Robson entre casos y controles: Test $\chi^2$ de Montecarlo (hay muy pocas gestantes del grupo 9), p-valor $`r round(CT,5)`$. 




Qué grupos tienen proporciones de cesáreas en infectadas o no infectadas significativamente diferentes? Ninguno:


```{r}
TablaRobsonGlobal(TRCa,TRCo,"global")
```

### Grupos sintomáticos


```{r}
TCaAsin=table(Casos$Robson[Casos$SINTOMAS_CAT==1],Casos$Cesárea[Casos$SINTOMAS_CAT==1])[2:11,2:1]
TCaSL=table(Casos$Robson[Casos$SINTOMAS_CAT==2],Casos$Cesárea[Casos$SINTOMAS_CAT==2])[2:11,2:1]
TCaNeu=table(Casos$Robson[Casos$SINTOMAS_CAT==3],Casos$Cesárea[Casos$SINTOMAS_CAT==3])[2:11,2:1]
dades=data.frame(1:10,
rowSums(TCaAsin),TCaAsin[,1],round(100*prop.table(TCaAsin,margin=1)[,1],2),
rowSums(TCaSL),TCaSL[,1],round(100*prop.table(TCaSL,margin=1)[,1],2),
rowSums(TCaNeu),TCaNeu[,1],round(100*prop.table(TCaNeu,margin=1)[,1],2))
      names(dades)=c("Grupo Robson", "Inf. Asintomática", "Cesáreas", "Porcentaje", 
                     "Inf. leve", "Cesáreas", "Porcentaje",
                     "Inf. grave", "Cesáreas", "Porcentaje")
dades %>%
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")



```


En la lista que sigue, los p-valores son los del contraste si las proporciones de cesáreas en los grupos 1,2,3,4,8 y 10 son las mismas o no en los dos grupos sintomáticos comparados:





```{r}
pp=c()
EE=dades[c(1:4,8,10),c(2,3,5,6,8,9)]
pp[1]=Prop.trend.test(EE[,2],EE[,1])
pp[2]=Prop.trend.test(EE[,2],EE[,1])
pp[3]=Prop.trend.test(EE[,4],EE[,3])
```

* Asintomática contra Leve: $`r signif(pp[1],1)`$
* Asintomática contra Grave: $`r signif(pp[2],1)`$
* Leve contra Grave: $`r signif(pp[3],1)`$


Qué pasa si agrupamos Asintomática+Leve contra Grave? Hay diferencia en la 10

```{r}
Casos$SintGrave=NA
Casos$SintGrave[Casos$SINTOMAS_CAT==1 |Casos$SINTOMAS_CAT==2]=0
Casos$SintGrave[Casos$SINTOMAS_CAT==3]=1

TCaSL=table(Casos$Robson[Casos$SintGrave==0],Casos$Cesárea[Casos$SintGrave==0])
TCaSG=table(Casos$Robson[Casos$SintGrave==1],Casos$Cesárea[Casos$SintGrave==1])

EE1=t(TCaSL)[2:1,2:11]
EE2=t(TCaSG)[2:1,2:11]
OR=rep(0,10)
pp=rep(0,10)
for (i in 1:10){
FT=fisher.test(cbind(EE1[,i],EE2[,i]))
OR[i]=FT$estimate
pp[i]=FT$p.value       }

dt=data.frame(1:10,colSums(EE1),EE1[1,],round(100*prop.table(EE1,margin=2)[1,],2),colSums(EE2),EE2[1,],round(100*prop.table(EE2,margin=2)[1,],2),round(OR,2),round(pp,3))
names(dt)=c("Grupo Robson", "Inf. Asintomática o leve", "Cesáreas", "Porcentaje",  "Inf. Grave", "Cesáreas", "Porcentaje","OR","p-valor test de Fisher")
dt %>%
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")



```





## 1^a^  ola

### Global

```{r}
TRC1w=table(c(Casos1w$Robson,Controls1w$Robson),c(Casos1w$Cesárea,Controls1w$Cesárea)) 
DFTRC1w=data.frame(Robson=c(1:10,"Pérdidas"),Gestantes=as.vector(table(c(Casos1w$Robson,Controls1w$Robson))[c(2:11,1)]),Cesáreas=TRC1w[c(2:11,1),2], Porcentaje=round(100*prop.table(TRC1w,margin=1)[c(2:11,1),2],2))
row.names(DFTRC1w)=c()

DFTRC1w %>%  
  kbl() %>%
  kable_styling()
```




```{r ,fig.cap="\\s"}
Tipo=factor(rep(c("Cesárea","No cesárea"), each=10))
Grupo=factor(rep(1:10 , 2))
valor=as.vector(TRC1w[c(2:11),2:1])
data=data.frame(Grupo,Tipo,valor)

ggplot(data, aes(fill=Tipo, y=valor, x=Grupo)) + 
  geom_bar(position="stack", stat="identity")+
  ylab("")+
  xlab("")+
  ggtitle("Cesáreas en grupos Robson en la 1a ola")+
  scale_fill_brewer(palette = "Pastel1") 
```

### Infectadas

```{r}
TRCa1w=table(Casos1w$Robson,Casos1w$Cesárea) 
DFTRCa1w=data.frame(Robson=c(1:10,"Pérdidas"),Gestantes=as.vector(table(Casos1w$Robson)[c(2:11,1)]),Cesáreas=TRCa1w[c(2:11,1),2], Porcentaje=round(100*prop.table(TRCa1w,margin=1)[c(2:11,1),2],2))
row.names(DFTRCa1w)=c()

DFTRCa1w %>%  
  kbl() %>%
  kable_styling()
```




```{r ,fig.cap="\\s"}
Tipo=factor(rep(c("Cesárea","No cesárea"), each=10))
Grupo=factor(rep(1:10 , 2))
valor=as.vector(TRCa1w[c(2:11),2:1])
data=data.frame(Grupo,Tipo,valor)

ggplot(data, aes(fill=Tipo, y=valor, x=Grupo)) + 
  geom_bar(position="stack", stat="identity")+
  ylab("")+
  xlab("")+
  ggtitle("Cesáreas en grupos Robson en las infectadas de la 1a ola")+
  scale_fill_brewer(palette = "Pastel1") 
```

### No infectadas

```{r}
TRCo1w=table(Controls1w$Robson,Controls1w$Cesárea) 
DFTRCo1w=data.frame(Robson=c(1:10,"Pérdidas"),Gestantes=as.vector(table(Controls1w$Robson)[c(2:11,1)]),Cesáreas=TRCo1w[c(2:11,1),2], Porcentaje=round(100*prop.table(TRCo1w,margin=1)[c(2:11,1),2],2))
row.names(DFTRCo1w)=c()

DFTRCo1w %>%  
  kbl() %>%
  kable_styling()
```




```{r ,fig.cap="\\s"}
Tipo=factor(rep(c("Cesárea","No cesárea"), each=10))
Grupo=factor(rep(1:10 , 2))
valor=as.vector(TRCo1w[c(2:11),2:1])
data=data.frame(Grupo,Tipo,valor)

ggplot(data, aes(fill=Tipo, y=valor, x=Grupo)) + 
  geom_bar(position="stack", stat="identity")+
  ylab("")+
  xlab("")+
  ggtitle("Cesáreas en grupos Robson en las no infectadas de la 1a ola")+
  scale_fill_brewer(palette = "Pastel1") 
```
### Diferencias?


Qué grupos tienen proporciones de cesáreas significativamente diferentes entre infectadas y no infectadas? Ninguno:


```{r}
TablaRobsonGlobal(TRCa1w,TRCo1w,"global")
```

## 2^a^  ola

### Global

```{r}
TRC2w=table(c(Casos2w$Robson,Controls2w$Robson),c(Casos2w$Cesárea,Controls2w$Cesárea)) 
DFTRC2w=data.frame(Robson=c(1:10,"Pérdidas"),Gestantes=as.vector(table(c(Casos2w$Robson,Controls2w$Robson))[c(2:11,1)]),Cesáreas=TRC2w[c(2:11,1),2], Porcentaje=round(100*prop.table(TRC2w,margin=1)[c(2:11,1),2],2))
row.names(DFTRC2w)=c()

DFTRC2w %>%  
  kbl() %>%
  kable_styling()
```




```{r ,fig.cap="\\s"}
Tipo=factor(rep(c("Cesárea","No cesárea"), each=10))
Grupo=factor(rep(1:10 , 2))
valor=as.vector(TRC2w[c(2:11),2:1])
data=data.frame(Grupo,Tipo,valor)

ggplot(data, aes(fill=Tipo, y=valor, x=Grupo)) + 
  geom_bar(position="stack", stat="identity")+
  ylab("")+
  xlab("")+
  ggtitle("Cesáreas en grupos Robson en la 2a ola")+
  scale_fill_brewer(palette = "Pastel1") 
```


### Infectadas

```{r}
TRCa2w=table(Casos2w$Robson,Casos2w$Cesárea) 
DFTRCa2w=data.frame(Robson=c(1:10,"Pérdidas"),Gestantes=as.vector(table(Casos2w$Robson)[c(2:11,1)]),Cesáreas=TRCa2w[c(2:11,1),2], Porcentaje=round(100*prop.table(TRCa2w,margin=1)[c(2:11,1),2],2))
row.names(DFTRCa2w)=c()

DFTRCa2w %>%  
  kbl() %>%
  kable_styling()
```




```{r ,fig.cap="\\s"}
Tipo=factor(rep(c("Cesárea","No cesárea"), each=10))
Grupo=factor(rep(1:10 , 2))
valor=as.vector(TRCa2w[c(2:11),2:1])
data=data.frame(Grupo,Tipo,valor)

ggplot(data, aes(fill=Tipo, y=valor, x=Grupo)) + 
  geom_bar(position="stack", stat="identity")+
  ylab("")+
  xlab("")+
  ggtitle("Cesáreas en grupos Robson en las infectadas de la 2a ola")+
  scale_fill_brewer(palette = "Pastel1") 
```

### No infectadas

```{r}
TRCo2w=table(Controls2w$Robson,Controls2w$Cesárea) 
DFTRCo2w=data.frame(Robson=c(1:10,"Pérdidas"),Gestantes=as.vector(table(Controls2w$Robson)[c(2:11,1)]),Cesáreas=TRCo2w[c(2:11,1),2], Porcentaje=round(100*prop.table(TRCo2w,margin=1)[c(2:11,1),2],2))
row.names(DFTRCo2w)=c()

DFTRCo2w %>%  
  kbl() %>%
  kable_styling()
```




```{r ,fig.cap="\\s"}
Tipo=factor(rep(c("Cesárea","No cesárea"), each=10))
Grupo=factor(rep(1:10 , 2))
valor=as.vector(TRCo2w[c(2:11),2:1])
data=data.frame(Grupo,Tipo,valor)

ggplot(data, aes(fill=Tipo, y=valor, x=Grupo)) + 
  geom_bar(position="stack", stat="identity")+
  ylab("")+
  xlab("")+
  ggtitle("Cesáreas en grupos Robson en las no infectadas de la 2a ola")+
  scale_fill_brewer(palette = "Pastel1") 
```

### Diferencias?


```{r,eval=FALSE,include=FALSE}
#Test de Cochran-Mantel-Haenszel

data2w=data.frame(Tipo=c(rep("I",n_I2),rep("NI",n_NI2)),Cesarea=c(Casos2w$Cesárea,Controls2w$Cesárea),Robson=c(Casos2w$Robson,Controls2w$Robson))
data2w=droplevels(data2w[data2w$Robson!="0",])
mantelhaen.test(table(data2w))
```

Qué grupos tienen proporciones de cesáreas significativamente diferentes?  Ninguno:


```{r}
TablaRobsonGlobal(TRCa2w,TRCo2w,"2a ola")
```


## Contrastes entre olas

### En el global

Qué grupos tienen proporciones de cesáreas significativamente diferentes en las dos olas?  Ninguno:

```{r}
EE1=t(TRC1w)[2:1,2:11]
EE2=t(TRC2w)[2:1,2:11]
OR=rep(0,10)
pp=rep(0,10)
for (i in 1:10){
FT=fisher.test(cbind(EE1[,i],EE2[,i]))
OR[i]=FT$estimate
pp[i]=FT$p.value       }

dt=data.frame(1:10,colSums(EE1),EE1[1,],round(100*prop.table(EE1,margin=2)[1,],2),colSums(EE2),EE2[1,],round(100*prop.table(EE2,margin=2)[1,],2),round(OR,2),round(pp,3))
names(dt)=c("Grupo Robson", "1a ola", "Cesáreas", "Porcentaje",  "2a ola", "Cesáreas", "Porcentaje","OR","p-valor test de Fisher")
dt %>%
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")
```

### Entre infectadas

Qué grupos tienen proporciones de cesáreas significativamente diferentes en las infectadas en las dos olas? Ninguno:


```{r}
EE1=t(TRCa1w)[2:1,2:11]
EE2=t(TRCa2w)[2:1,2:11]
OR=rep(0,10)
pp=rep(0,10)
for (i in 1:10){
FT=fisher.test(cbind(EE1[,i],EE2[,i]))
OR[i]=FT$estimate
pp[i]=FT$p.value       }

dt=data.frame(1:10,colSums(EE1),EE1[1,],round(100*prop.table(EE1,margin=2)[1,],2),colSums(EE2),EE2[1,],round(100*prop.table(EE2,margin=2)[1,],2),round(OR,2),round(pp,3))
names(dt)=c("Grupo Robson", "Inf. 1a ola", "Cesáreas", "Porcentaje",  "Inf. 2a ola", "Cesáreas", "Porcentaje","OR","p-valor test de Fisher")
dt %>%
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")
```








## Grupos sintomáticos y olas


### Global


```{r}
TRCaS=table(Casos$Robson,Casos$SINTOMAS_DIAGNOSTICO)[c(2:11,1),]
pTRCaS=round(100*prop.table(table(Casos$Robson,Casos$SINTOMAS_DIAGNOSTICO),margin=1)[c(2:11,1),],2)
DFTRCaS=data.frame(
  Robson=c(1:10,"Pérdidas"),
Tot=as.vector(table(Casos$Robson)[c(2:11,1)]),
Asint=TRCaS[,1],
pAsint=pTRCaS[,1],
SL=TRCaS[,2],
pSL=pTRCaS[,2],
Neum=TRCaS[,3],
pNeum=pTRCaS[,3])
row.names(DFTRCaS)=c()
names(DFTRCaS)=c("Grupo Robson", "Total infectadas", "Asintomática", "%", "Leve", "%", "Grave", "%")

DFTRCaS %>%  
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")

```







```{r ,fig.cap="\\s"}
Tipo=factor(rep(c("Asintomática","Leve", "Grave"), each=10))
Grupo=factor(rep(1:10 , 3))
valor=as.vector(TRCaS[1:10,])
data=data.frame(Grupo,Tipo,valor)

ggplot(data, aes(fill=Tipo, y=valor, x=Grupo)) + 
  geom_bar(position="stack", stat="identity")+
  ylab("")+
  xlab("")+
  ggtitle("Grupos sintomáticos en grupos Robson en las infectadas")+
  scale_fill_brewer(palette = "Dark2") 
```




En la tabla que sigue, para cada grupo Robson, el p-valor es del contraste $\chi^2$ de si la distribución de los síntomas de las infectadas de ese grupo es igual o diferente de la distribución de los síntomas de las infectadas. Como ves, las distribuciones de síntomas en los grupos 1 y 10 son significativamente diferentes del global.


```{r}
pp=c()
for (i in c(1:10)){
pp[i]=chisq.test(TRCaS[i,],p=prop.table(colSums(TRCaS)),simulate.p.value=TRUE,B=10000)$p.value
}
tabla=data.frame(
Robson=rep(1:10),
round(pp,4)
)
names(tabla)=c("Grupo Robson","p-valor")
row.names(tabla)=c()

tabla %>%  
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")

```




### Comparando olas

```{r}
TRCa1wS=table(Casos1w$Robson,Casos1w$SINTOMAS_DIAGNOSTICO)[c(2:11,1),]
pTRCa1wS=round(100*prop.table(table(Casos1w$Robson,Casos1w$SINTOMAS_DIAGNOSTICO),margin=1)[c(2:11,1),],2)
pTRCa1wS[9,]=c(0,0,0)
TRCa2wS=table(Casos2w$Robson,Casos2w$SINTOMAS_DIAGNOSTICO)[c(2:11,1),] 
pTRCa2wS=round(100*prop.table(table(Casos2w$Robson,Casos2w$SINTOMAS_DIAGNOSTICO),margin=1)[c(2:11,1),],2)
DFTRCaWS=data.frame(
  Robson=c(1:10,"Pérdidas"),
Tot1w=as.vector(table(Casos1w$Robson)[c(2:11,1)]),
Asint1w=TRCa1wS[,1],
pAsint1w=pTRCa1wS[,1],
SL1w=TRCa1wS[,2],
pSL1w=pTRCa1wS[,2],
Neum1w=TRCa1wS[,3],
pTRCa1wS[,3],
Tot2w=as.vector(table(Casos2w$Robson)[c(2:11,1)]),
Asint2w=TRCa2wS[,1],
pAsint2w=pTRCa2wS[,1],
SL2w=TRCa2wS[,2],
pSL2w=pTRCa2wS[,2],
Neum2w=TRCa2wS[,3],
pTRCa2wS[,3])
row.names(DFTRCaWS)=c()
names(DFTRCaWS)=c("Grupo Robson", "Total infectadas 1a ola", "Asintomática 1a ola", "%", "Leve 1a ola", "%", "Grave 1a ola", "%","Total infectadas 2a ola", "Asintomática 2a ola", "%", "Leve 2a ola", "%", "Grave 2a ola", "%")

DFTRCaWS %>%  
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")
```







```{r ,fig.cap="\\s"}
Tipo=factor(rep(c("Asintomática","Leve", "Grave"), each=10))
Grupo=factor(rep(1:10 , 3))
valor=as.vector(TRCa1wS[1:10,])
data=data.frame(Grupo,Tipo,valor)

ggplot(data, aes(fill=Tipo, y=valor, x=Grupo)) + 
  geom_bar(position="stack", stat="identity")+
  ylab("")+
  xlab("")+
  ggtitle("Grupos sintomáticos en grupos Robson en las infectadas de la 1a ola")+
  scale_fill_brewer(palette = "Dark2") 
```



```{r ,fig.cap="\\s"}
Tipo=ordered(rep(c("Asintomática","Leve", "Grave"), each=10),levels=c("Asintomática","Leve", "Grave"))
Grupo=factor(rep(1:10 , 3))
valor=as.vector(TRCa2wS[1:10,])
data=data.frame(Grupo,Tipo,valor)

ggplot(data, aes(fill=Tipo, y=valor, x=Grupo)) + 
  geom_bar(position="stack", stat="identity")+
  ylab("")+
  xlab("")+
  ggtitle("Grupos sintomáticos en grupos Robson en las infectadas de la 2a ola")+
  scale_fill_brewer(palette = "Dark2") 
```

```{r ,fig.cap="\\s"}

Tipo=ordered(rep(c("Asintomática","Leve", "Grave"), 20),levels=c("Asintomática","Leve", "Grave"))
Grupo=ordered(rep(c(sort(c(paste(1:9, "\n 1a\n ola"),paste(1:9, "\n 2a\n ola")) ),"10 \n 1a\n ola", "10 \n 2a\n ola"),each=3),levels=
               c(sort(c(paste(1:9, "\n 1a\n ola"),paste(1:9, "\n 2a\n ola")) ),"10 \n 1a\n ola", "10 \n 2a\n ola"))
valor=c()
for (i in 1:10){
  valor=c(valor,pTRCa1wS[i,],  pTRCa2wS[i,])
}
data=data.frame(Grupo,Tipo,valor)

ggplot(data, aes(fill=Tipo, y=valor, x=Grupo)) + 
  geom_bar(position="stack", stat="identity")+
  ylab("")+
  xlab("")+
  ggtitle("Distribuciones en grupos sintomáticos de los grupos Robson de  infectadas en ambas olas")+
  scale_fill_brewer(palette = "Dark2") 
```

```{r ,fig.cap="\\s"}

Tipo=ordered(rep(c("Asintomática","Leve", "Grave"), 20),levels=c("Asintomática","Leve", "Grave"))
Grupo=ordered(rep(c(sort(c(paste(1:9, "\n 1a\n ola"),paste(1:9, "\n 2a\n ola")) ),"10 \n 1a\n ola", "10 \n 2a\n ola"),each=3),levels=
               c(sort(c(paste(1:9, "\n 1a\n ola"),paste(1:9, "\n 2a\n ola")) ),"10 \n 1a\n ola", "10 \n 2a\n ola"))
valor=c()
for (i in 1:10){
  valor=c(valor,TRCa1wS[i,],  TRCa2wS[i,])
}
data=data.frame(Grupo,Tipo,valor)

ggplot(data, aes(fill=Tipo, y=valor, x=Grupo)) + 
  geom_bar(position="stack", stat="identity")+
  ylab("")+
  xlab("")+
  ggtitle("Frecuencias de grupos sintomáticos en los grupos Robson de  infectadas en ambas olas")+
  scale_fill_brewer(palette = "Dark2") 
```


En la tabla que sigue, para cada grupo y cada ola, el p-valor es del contraste $\chi^2$ de si la distribución de los síntomas de las infectadas de ese grupo y esa ola es igual o diferente de la distribución de los síntomas de las infectadas de ese grupo en el total de las dos olas.

```{r}
pp=c()
for (i in c(1:8,10)){
pp[i]=chisq.test(TRCa1wS[i,],p=prop.table(TRCa1wS+TRCa2wS,margin=1)[i,],simulate.p.value=TRUE,B=10000)$p.value
}
for (i in c(11:18,20)){
pp[i]=chisq.test(TRCa2wS[i-10,],p=prop.table(TRCa1wS[i-10,]+TRCa2wS[i-10,]),simulate.p.value=TRUE,B=10000)$p.value
}
tabla=data.frame(
Robson=rep(1:10,2),
Ola=rep(1:2,each=10),
round(pp,4)
)
names(tabla)=c("Grupo Robson","Ola","p-valor")
row.names(tabla)=c()

tabla %>%  
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")

```


### Enter cesáreas



Dejo de tener en cuenta los grupos 5,6,7,9, donde las cesáreas fueron constantes.


```{r}
TRCa1wSC=table(Casos1w$Cesárea,Casos1w$SINTOMAS_DIAGNOSTICO,Casos1w$Robson)[2:1,,c(2:11,1)]
pTRCa1wSC=round(100*prop.table(TRCa1wSC,margin=c(2,3)),2)
TRCa2wSC=table(Casos2w$Cesárea,Casos2w$SINTOMAS_DIAGNOSTICO,Casos2w$Robson)[2:1,,c(2:11,1)] 
pTRCa2wSC=round(100*prop.table(TRCa2wSC,margin=c(2,3)),2)

DFTRCaWSC=data.frame(
Robson=c(1:10,"Pérdidas"),
Asint1w=TRCa1wS[,1],
pAsint1w=pTRCa1wSC[1,1,],
SL1w=TRCa1wS[,2],
pSL1w=pTRCa1wSC[1,2,],
Neum1w=TRCa1wS[,3],
pNeum1w=pTRCa1wSC[1,3,],
Asint2w=TRCa2wS[,1],
pAsint2w=pTRCa2wSC[1,1,],
SL2w=TRCa2wS[,2],
pSL2w=pTRCa2wSC[1,2,],
Neum2w=TRCa2wS[,3],
pNeum2w=pTRCa2wSC[1,3,]
)
DFTRCaWSC=DFTRCaWSC[c(1:4,8,10),]
row.names(DFTRCaWSC)=c()

names(DFTRCaWSC)=c("Grupo Robson", "Asintomática 1a ola", "% cesáreas en Asintomática 1a ola", "Leve 1a ola", "% cesáreas en Leve 1a ola", "Graves 1a ola", "% cesáreas en Grave 1a ola",  "Asintomática 2a ola","% cesáreas en Asintomática 2a ola", "Leve 2a ola", "% cesáreas en Leve 2a ola", "Graves 2a ola", "% cesáreas en Grave 2a ola")

DFTRCaWSC %>%  
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")


```



En la tabla que sigue, para cada grupo y cada ola, el p-valor es del contraste de si la distribución de cesáreas en los grupos sintomáticos de las infectadas de ese grupo y esa ola es igual o diferente de la distribución de cesáreas en los grupos sintomáticos de las infectadas de ese grupo en el total de las dos olas.
Si no puedes rechazar que sean iguales, tampoco puedes rechazar que haya diferencia entre olas. Parece que hay diferencia en el grupo 10. 



```{r}
pp=c()
for(i in c(1:4,8,10)){
EEw=TRCa1wSC[,,i]
EE=TRCa1wSC[,,i]+TRCa2wSC[,,i]
pp[i]=Prop.trend.test(EEw[1,],colSums(EEw))
}
for(i in c(11:14,18,20)){
EEw=TRCa2wSC[,,i-10]
EE=TRCa1wSC[,,i-10]+TRCa2wSC[,,i-10]
pp[i]=Prop.trend.test(EEw[1,],colSums(EEw))
}
pp=pp[!is.na(pp)]

tabla=data.frame(
Robson=rep(c(1:4,8,10),2),
Ola=rep(1:2,each=6),
round(pp,4)
)
names(tabla)=c("Grupo Robson","Ola","p-valor")
row.names(tabla)=c()

tabla %>%  
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")

```


En la tabla que sigue, para cada grupo Robson y para cada sintomático:

* OR: la OR de cesárea relativa a ser de la 1a ola
* p-valor: el p-valor del test de Fisher bilateral para comparar las proporciones de cesáreas en ese grupo Robson y ese grupo sintomático entre las dos olas



```{r}
ppA=c()
ppSL=c()
ppN=c()
ORA=c()
ORSL=c()
ORN=c()
for(i in c(1:4,8,10)){
EE1w=TRCa1wSC[,,i]
EE2w=TRCa2wSC[,,i]
ORA[i]=fisher.test(cbind(EE1w[,1],EE2w[,1]))$estimate
ORSL[i]=fisher.test(cbind(EE1w[,2],EE2w[,2]))$estimate
ORN[i]=fisher.test(cbind(EE1w[,3],EE2w[,3]))$estimate

ppA[i]=fisher.test(cbind(EE1w[,1],EE2w[,1]))$p.value
ppSL[i]=fisher.test(cbind(EE1w[,2],EE2w[,2]))$p.value
ppN[i]=fisher.test(cbind(EE1w[,3],EE2w[,3]))$p.value
}
ppA=ppA[!is.na(ppA)]
ppSL=ppSL[!is.na(ppSL)]
ppN=ppN[!is.na(ppN)]

ORA=ORA[!is.na(ORA)]
ORSL=ORSL[!is.na(ORSL)]
ORN=ORN[!is.na(ORN)]


tabla=data.frame(
Robson=c(1:4,8,10),
round(ORA,4),
round(ppA,4),
round(ORSL,4),
round(ppSL,4),
round(ORN,4),
round(ppN,4)
)
names(tabla)=c("Grupo Robson", "OR Asintomática", "p-valor Asintomática","OR Leve","p-valor Leve","OR Grave","p-valor Grave")
row.names(tabla)=c()

tabla %>%  
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")

```




## Antepartos contra peripartos

```{r}
Casos$Sint=Casos$SINTOMAS_CAT
#Momento del diagnóstico
Casos$PreP=NA
Casos$PreP[round((Casos$EG_TOTAL_PARTO-Casos$EDAD.GEST.TOTAL)*7)>2]="Anteparto"  
Casos$PreP[round((Casos$EG_TOTAL_PARTO-Casos$EDAD.GEST.TOTAL)*7)<=2]="Periparto"
#
CasosPerileve=Casos
CasosPerileve=CasosPerileve[CasosPerileve$Sint==1|CasosPerileve$Sint==2,]
CasosPerileve=CasosPerileve[CasosPerileve$PreP!="Anteparto",]
CasosPerileve=droplevels(CasosPerileve)
CasosPeriGraves=Casos
CasosPeriGraves=CasosPeriGraves[CasosPeriGraves$Sint==3,]
CasosPeriGraves=CasosPeriGraves[CasosPeriGraves$PreP!="Anteparto",]
CasosPeriGraves=droplevels(CasosPeriGraves)
CasosPeriGraves$Robson=factor(CasosPeriGraves$Robson,levels=0:10)
```


```{r}
TRcaPreP=table(Casos$Robson[Casos$PreP=="Anteparto"],Casos$Cesárea[Casos$PreP=="Anteparto"])
TRcaPeriP=table(Casos$Robson[Casos$PreP=="Periparto"],Casos$Cesárea[Casos$PreP=="Periparto"])
TRCaPL=table(CasosPerileve$Robson,CasosPerileve$Cesárea) 
TRCaPG=table(CasosPeriGraves$Robson,CasosPeriGraves$Cesárea) 
```




```{r ,fig.cap="\\s"}
Tipo=factor(rep(c("Cesárea","No cesárea"), each=10))
Grupo=factor(rep(1:10 , 2))
valor=as.vector(TRCaPL[c(2:11),2:1])
data=data.frame(Grupo,Tipo,valor)

ggplot(data, aes(fill=Tipo, y=valor, x=Grupo)) + 
  geom_bar(position="stack", stat="identity")+
  ylab("")+
  xlab("")+
  ggtitle("Cesáreas en grupos Robson de infectadas periparto Asintomática o leve")+
  scale_fill_brewer(palette = "Pastel1") 
```


```{r ,fig.cap="\\s"}
Tipo=factor(rep(c("Cesárea","No cesárea"), each=10))
Grupo=factor(rep(1:10 , 2))
valor=as.vector(TRCaPG[c(2:11),2:1])
data=data.frame(Grupo,Tipo,valor)

ggplot(data, aes(fill=Tipo, y=valor, x=Grupo)) + 
  geom_bar(position="stack", stat="identity")+
  ylab("")+
  xlab("")+
  ggtitle("Cesáreas en grupos Robson de infectadas periparto graves")+
  scale_fill_brewer(palette = "Pastel1") 
```

```{r}
TRCo=table(Controls$Robson,Controls$Cesárea) 
```




### Diferencias?


Qué grupos tienen proporciones de cesáreas significativamente diferentes en las infectadas anteparto y periparto? Algunos!


```{r}
EE1=t(TRcaPreP)[2:1,2:11]
EE2=t(TRcaPeriP)[2:1,2:11]
OR=rep(0,10)
pp=rep(0,10)
for (i in 1:10){
FT=fisher.test(cbind(EE1[,i],EE2[,i]))
OR[i]=FT$estimate
pp[i]=FT$p.value       }

dt=data.frame(1:10,colSums(EE1),EE1[1,],round(100*prop.table(EE1,margin=2)[1,],2),colSums(EE2),EE2[1,],round(100*prop.table(EE2,margin=2)[1,],2),round(OR,2),round(pp,3))
names(dt)=c("Grupo Robson", "Inf. anteparto", "Cesáreas", "Porcentaje",  "Inf. periparto", "Cesáreas", "Porcentaje","OR","p-valor test de Fisher")
dt %>%
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


Qué grupos tienen proporciones de cesáreas en infectadas periparto no graves o no infectadas significativamente diferentes? Ninguno:


```{r}
TablaRobsonGlobal(TRCaPL,TRCo,"Peripartos asintomáticos o leve","")
```
Qué grupos tienen proporciones de cesáreas en infectadas periparto graves o no infectadas significativamente diferentes? Algunos!


```{r}
TablaRobsonGlobal(TRCaPG,TRCo,"Peripartos Graves","")
```

Qué grupos tienen proporciones de cesáreas en infectadas periparto no graves o graves significativamente diferentes? Bastantes!


```{r}
EE1=t(TRCaPG)[2:1,2:11]
EE2=t(TRCaPL)[2:1,2:11]
OR=rep(0,10)
pp=rep(0,10)
for (i in 1:10){
FT=fisher.test(cbind(EE1[,i],EE2[,i]))
OR[i]=FT$estimate
pp[i]=FT$p.value       }

dt=data.frame(1:10,colSums(EE1),EE1[1,],round(100*prop.table(EE1,margin=2)[1,],2),colSums(EE2),EE2[1,],round(100*prop.table(EE2,margin=2)[1,],2),round(OR,2),round(pp,3))
names(dt)=c("Grupo Robson", "Periparto Grave", "Cesáreas", "Porcentaje",  "Periparto no Grave", "Cesáreas", "Porcentaje","OR","p-valor test de Fisher")
dt %>%
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")
```



```{r}
CasosPrep=droplevels(Casos[Casos$PreP=="Anteparto",])
CasosPeri=droplevels(Casos[Casos$PreP=="Periparto",])
```




```{r}
TRCa1wS=table(CasosPrep$Robson,CasosPrep$SINTOMAS_DIAGNOSTICO)[c(2:11,1),]
pTRCa1wS=round(100*prop.table(table(CasosPrep$Robson,CasosPrep$SINTOMAS_DIAGNOSTICO),margin=1)[c(2:11,1),],2)
TRCa2wS=table(CasosPeri$Robson,CasosPeri$SINTOMAS_DIAGNOSTICO)[c(2:11,1),] 
pTRCa2wS=round(100*prop.table(table(CasosPeri$Robson,CasosPeri$SINTOMAS_DIAGNOSTICO),margin=1)[c(2:11,1),],2)
DFTRCaWS=data.frame(
  Robson=c(1:10,"Pérdidas"),
Tot1w=as.vector(table(CasosPrep$Robson)[c(2:11,1)]),
Asint1w=TRCa1wS[,1],
pAsint1w=pTRCa1wS[,1],
SL1w=TRCa1wS[,2],
pSL1w=pTRCa1wS[,2],
Neum1w=TRCa1wS[,3],
pTRCa1wS[,3],
Tot2w=as.vector(table(CasosPeri$Robson)[c(2:11,1)]),
Asint2w=TRCa2wS[,1],
pAsint2w=pTRCa2wS[,1],
SL2w=TRCa2wS[,2],
pSL2w=pTRCa2wS[,2],
Neum2w=TRCa2wS[,3],
pTRCa2wS[,3])
row.names(DFTRCaWS)=c()
names(DFTRCaWS)=c("Grupo Robson", "Total infectadas anteparto", "Asintomática prepartp", "%", "Leve anteparto", "%", "Grave anteparto", "%","Total infectadas periparto", "Asintomática periparto", "%", "Leve periparto", "%", "Grave peripartoa", "%")

DFTRCaWS %>%  
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")
```







```{r ,fig.cap="\\s"}
Tipo=factor(rep(c("Asintomática","Leve", "Grave"), each=10))
Grupo=factor(rep(1:10 , 3))
valor=as.vector(TRCa1wS[1:10,])
data=data.frame(Grupo,Tipo,valor)

ggplot(data, aes(fill=Tipo, y=valor, x=Grupo)) + 
  geom_bar(position="stack", stat="identity")+
  ylab("")+
  xlab("")+
  ggtitle("Grupos sintomáticos en grupos Robson en las infectadas anteparto")+
  scale_fill_brewer(palette = "Dark2") 
```



```{r ,fig.cap="\\s"}
Tipo=ordered(rep(c("Asintomática","Leve", "Grave"), each=10),levels=c("Asintomática","Leve", "Grave"))
Grupo=factor(rep(1:10 , 3))
valor=as.vector(TRCa2wS[1:10,])
data=data.frame(Grupo,Tipo,valor)

ggplot(data, aes(fill=Tipo, y=valor, x=Grupo)) + 
  geom_bar(position="stack", stat="identity")+
  ylab("")+
  xlab("")+
  ggtitle("Grupos sintomáticos en grupos Robson en las infectadas periparto")+
  scale_fill_brewer(palette = "Dark2") 
```




En la tabla que sigue, para cada grupo y cada momento de diagnóatico, el p-valor es del contraste $\chi^2$ de si la distribución de los síntomas de las infectadas de ese grupo y ese momento es igual o diferente de la distribución de los síntomas de las infectadas de ese grupo en el total de las dos olas.

```{r}
pp=c()
for (i in c(1:8,10)){
pp[i]=chisq.test(TRCa1wS[i,],p=prop.table(TRCa1wS+TRCa2wS,margin=1)[i,],simulate.p.value=TRUE,B=10000)$p.value
}
for (i in c(11:18,20)){
pp[i]=chisq.test(TRCa2wS[i-10,],p=prop.table(TRCa1wS[i-10,]+TRCa2wS[i-10,]),simulate.p.value=TRUE,B=10000)$p.value
}
tabla=data.frame(
Robson=rep(1:10,2),
Ola=rep(c("Preparto","Periparto"),each=10),
round(pp,4)
)
names(tabla)=c("Grupo Robson","Diagnóstico","p-valor")
row.names(tabla)=c()

tabla %>%  
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")

```


### Enter cesáreas

Dejo de tener en cuenta los grupos 5,6,7,9, donde las cesáreas fueron constantes.


```{r}
TRCa1wSC=table(CasosPrep$Cesárea,CasosPrep$SINTOMAS_DIAGNOSTICO,CasosPrep$Robson)[2:1,,c(2:11,1)]
pTRCa1wSC=round(100*prop.table(TRCa1wSC,margin=c(2,3)),2)
TRCa2wSC=table(CasosPeri$Cesárea,CasosPeri$SINTOMAS_DIAGNOSTICO,CasosPeri$Robson)[2:1,,c(2:11,1)] 
pTRCa2wSC=round(100*prop.table(TRCa2wSC,margin=c(2,3)),2)

DFTRCaWSC=data.frame(
Robson=c(1:10,"Pérdidas"),
Asint1w=TRCa1wS[,1],
pAsint1w=pTRCa1wSC[1,1,],
SL1w=TRCa1wS[,2],
pSL1w=pTRCa1wSC[1,2,],
Neum1w=TRCa1wS[,3],
pNeum1w=pTRCa1wSC[1,3,],
Asint2w=TRCa2wS[,1],
pAsint2w=pTRCa2wSC[1,1,],
SL2w=TRCa2wS[,2],
pSL2w=pTRCa2wSC[1,2,],
Neum2w=TRCa2wS[,3],
pNeum2w=pTRCa2wSC[1,3,]
)
DFTRCaWSC=DFTRCaWSC[c(1:4,8,10),]
row.names(DFTRCaWSC)=c()

names(DFTRCaWSC)=c("Grupo Robson", "Asintomática anteparto", "% cesáreas en Asintomática anteparto", "Leve anteparto", "% cesáreas en Leve anteparto", "Graves anteparto", "% cesáreas en Grave anteparto",  "Asintomática periparto","% cesáreas en Asintomática periparto", "Leve periparto", "% cesáreas en Leve periparto", "Graves periparto", "% cesáreas en Grave periparto")

DFTRCaWSC %>%  
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")


```



En la tabla que sigue, para cada grupo y cada momento, el p-valor es del contraste de si la distribución de cesáreas en los grupos sintomáticos de las infectadas de ese grupo y ese momento es igual o diferente de la distribución de cesáreas en los grupos sintomáticos de las infectadas.


```{r}
pp=c()
for(i in c(1:4,8,10)){
EEw=TRCa1wSC[,,i]
EE=TRCa1wSC[,,i]+TRCa2wSC[,,i]
pp[i]=Prop.trend.test(EEw[1,],colSums(EEw))
}
for(i in c(11:14,18,20)){
EEw=TRCa2wSC[,,i-10]
EE=TRCa1wSC[,,i-10]+TRCa2wSC[,,i-10]
pp[i]=Prop.trend.test(EEw[1,],colSums(EEw))
}
pp=pp[!is.na(pp)]

tabla=data.frame(
Robson=rep(c(1:4,8,10),2),
Ola=rep(c("Preparto","Periparto"),each=6),
round(pp,4)
)
names(tabla)=c("Grupo Robson","Diagnóstico","p-valor")
row.names(tabla)=c()

tabla %>%  
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")

```


En la tabla que sigue, para cada grupo Robson y para cada sintomático:

* OR: la OR de cesárea relativa a ser anteparto
* p-valor: el p-valor del test de Fisher bilateral para comparar las proporciones de cesáreas en ese grupo Robson y ese grupo sintomático entre los dos momentos de diagnóstico



```{r}
ppA=c()
ppSL=c()
ppN=c()
ORA=c()
ORSL=c()
ORN=c()
for(i in c(1:4,8,10)){
EE1w=TRCa1wSC[,,i]
EE2w=TRCa2wSC[,,i]
ORA[i]=fisher.test(cbind(EE1w[,1],EE2w[,1]))$estimate
ORSL[i]=fisher.test(cbind(EE1w[,2],EE2w[,2]))$estimate
ORN[i]=fisher.test(cbind(EE1w[,3],EE2w[,3]))$estimate

ppA[i]=fisher.test(cbind(EE1w[,1],EE2w[,1]))$p.value
ppSL[i]=fisher.test(cbind(EE1w[,2],EE2w[,2]))$p.value
ppN[i]=fisher.test(cbind(EE1w[,3],EE2w[,3]))$p.value
}
ppA=ppA[!is.na(ppA)]
ppSL=ppSL[!is.na(ppSL)]
ppN=ppN[!is.na(ppN)]

ORA=ORA[!is.na(ORA)]
ORSL=ORSL[!is.na(ORSL)]
ORN=ORN[!is.na(ORN)]


tabla=data.frame(
Robson=c(1:4,8,10),
round(ORA,4),
round(ppA,4),
round(ORSL,4),
round(ppSL,4),
round(ORN,4),
round(ppN,4)
)
names(tabla)=c("Grupo Robson", "OR Asintomática", "p-valor Asintomática","OR Leve","p-valor Leve","OR Grave","p-valor Grave")
row.names(tabla)=c()

tabla %>%  
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")

```


```{r}
TCaAsin=table(Casos$Robson[Casos$SINTOMAS_CAT==1],Casos$Cesárea[Casos$SINTOMAS_CAT==1])[2:11,2:1]
TCaSL=table(Casos$Robson[Casos$SINTOMAS_CAT==2],Casos$Cesárea[Casos$SINTOMAS_CAT==2])[2:11,2:1]
TCaNeu=table(Casos$Robson[Casos$SINTOMAS_CAT==3],Casos$Cesárea[Casos$SINTOMAS_CAT==3])[2:11,2:1]
dades=data.frame(1:10,
rowSums(TCaAsin),TCaAsin[,1],round(100*prop.table(TCaAsin,margin=1)[,1],2),
rowSums(TCaSL),TCaSL[,1],round(100*prop.table(TCaSL,margin=1)[,1],2),
rowSums(TCaNeu),TCaNeu[,1],round(100*prop.table(TCaNeu,margin=1)[,1],2))
      names(dades)=c("Grupo Robson", "Inf. Asintomática", "Cesáreas", "Porcentaje", 
                     "Inf. Leve", "Cesáreas", "Porcentaje",
                     "Inf. Grave", "Cesáreas", "Porcentaje")
dades %>%
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")



```


En la lista que sigue, los p-valores son los del contraste si las proporciones de cesáreas en los grupos 1,2,3,4,8 y 10 son las mismas o no en los dos grupos sintomáticos comparados:





```{r}
pp=c()
EE=dades[c(1:4,8,10),c(2,3,5,6,8,9)]
pp[1]=Prop.trend.test(EE[,2],EE[,1])
pp[2]=Prop.trend.test(EE[,2],EE[,1])
pp[3]=Prop.trend.test(EE[,4],EE[,3])
```

* Asintomática contra Leve: $`r signif(pp[1],1)`$
* Asintomática contra Grave: $`r signif(pp[2],1)`$
* Leve contra Grave: $`r signif(pp[3],1)`$



## Bonus Track

Datos sobre un hospital valenciano de 2010 a 2018 (https://doi.org/10.3390/ijerph17051575)

```{r}
DatosAnteriores=data.frame(matrix(c(638,	5529	,921,	2527	,338,	5283	,402,	1578	,23,	118	,304,	320	,136,	158	,133,	229	,35,	35	,222,	729),nrow=10,byrow=T))
names(DatosAnteriores)=c("Cesáreas","Gestantes")
DatosAnteriores$Robson=1:10
DatosAnteriores=DatosAnteriores[,c(3,2,1)]
DatosAnteriores$Porcentaje=round(100*DatosAnteriores$Cesáreas/DatosAnteriores$Gestantes,2)

DatosAnteriores %>%  
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


Se ajustan vuestros grupos Robson a esa distribución? 

```{r}
Ant=as.vector(prop.table(DatosAnteriores$Gestantes))
Aqui=as.vector(prop.table(table(c(Casos$Robson,Controls$Robson))[2:11]))
AquiC=as.vector(prop.table(table(c(Controls$Robson))[2:11]))
Distrs=data.frame(Robson=1:10,round(100*Ant,2),round(100*Aqui,2),round(100*AquiC,2))
names(Distrs)=c("Robson","Anterior (%)", "Vuestra global (%)", "Vuestra controles (%)")
Distrs %>%  
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")
```


Global: No
```{r}
chisq.test(table(c(Casos$Robson,Controls$Robson))[2:11],p=prop.table(DatosAnteriores$Gestantes))
```

Vuestros controles: No

```{r}
chisq.test(table(Controls$Robson)[2:11],p=prop.table(DatosAnteriores$Gestantes),simulate.p.value = TRUE, B=5000)
```


En qué grupos los porcentajes de cesáreas en vuestra muestra fueron diferentes del histórico? En la tabla que sigue

* OR Odds ratio de cesárea en (ese grupo) en la muestra actual respecto del histórico

* p-valor: p-valor del test de Fisher comparando ese grupo en el actual y el histórico

```{r}
TTG=table(c(Casos$Cesárea,Controls$Cesárea),c(Casos$Robson,Controls$Robson))[2:1,2:11]
TTCa=table(c(Casos$Cesárea),c(Casos$Robson))[2:1,2:11]
TTGC=table(c(Controls$Cesárea),c(Controls$Robson))[2:1,2:11]
TTAnt=rbind(DatosAnteriores$Cesáreas,DatosAnteriores$Gestantes-DatosAnteriores$Cesáreas)
ppG=rep(0,10)
ppCa=rep(0,10)
ppC=rep(0,10)
ORG=rep(0,10)
ORC=rep(0,10)
ORCa=rep(0,10)

for (i in 1:10){
FTG=fisher.test(cbind(TTG[,i], TTAnt[,i]))
FTCG=fisher.test(cbind(TTGC[,i], TTAnt[,i]))
FTCa=fisher.test(cbind(TTCa[,i], TTAnt[,i]))
ppG[i]=FTG$p.value
ppC[i]=FTCG$p.value
ppCa[i]=FTCG$p.value
ORCa[i]=FTG$estimate

ORG[i]=FTG$estimate
ORC[i]=FTCG$estimate
}

tabla=data.frame(1:10,round(ORG,2),round(ppG,4),round(ORC,2),round(ppC,4),round(ORCa,2),round(ppCa,4))
names(tabla)=c("Robson", "OR global", "p-valor global", "OR controles", "p-valor controles", "OR casos", "p-valor casos")

tabla %>%  
  kbl() %>%
  kable_styling()%>%     
  scroll_box(width="100%", box_css="border: 0px;")

```

<!--chapter:end:7.Robson.Rmd-->

