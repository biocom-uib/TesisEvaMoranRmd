"0","# y és el vector discret de les probabilitats poblacionals possibles p"
"0","# eliminam p=0 i p=1 perquè aleshores els resultats d'una mostra són segurs"
"0","y=10^(-6)*(1:(10^6-1))  "
"0","#"
"0","CP=function(n,cl=0.95){"
"0","# Calcula els CI de Clopper-Pearson per a tots els resultats possibles 0...n"
"0","CIs=epitools::binom.exact(0:n,n,conf.level=cl)[,c(1,4,5)] "
"0","# PP dóna 1 si la p pertany a l'interval x"
"0","PP=function(p,x){"
"0","  ifelse(x[1]<=p & p<=x[2],1,0)"
"0","}"
"0","# Donat p, Pert(p)=sum_{j=0}^n P(j èxits)*PP(p,IC per a j èxits)"
"0","Pert=function(p){"
"0","  sum(dbinom(CIs[,1],n,p)*PP(p,CIs[,2:3]))"
"0","}"
"0","z=sapply(y,Pert)"
"0","return(z)"
"0","}"
